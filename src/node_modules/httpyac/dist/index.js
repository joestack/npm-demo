"use strict";var Gu=Object.create;var vr=Object.defineProperty;var Ku=Object.getOwnPropertyDescriptor;var Wu=Object.getOwnPropertyNames;var Qu=Object.getPrototypeOf,zu=Object.prototype.hasOwnProperty;var gt=(t,e)=>{for(var r in e)vr(t,r,{get:e[r],enumerable:!0})},ti=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let s of Wu(e))!zu.call(t,s)&&s!==r&&vr(t,s,{get:()=>e[s],enumerable:!(o=Ku(e,s))||o.enumerable});return t};var T=(t,e,r)=>(r=t!=null?Gu(Qu(t)):{},ti(e||!t||!t.__esModule?vr(r,"default",{value:t,enumerable:!0}):r,t)),Ju=t=>ti(vr({},"__esModule",{value:!0}),t);var gn={};gt(gn,{AbstractRequestClient:()=>te,ExecuteHook:()=>Qe,HookCancel:()=>Vt,HttpSymbol:()=>v,HttpSymbolKind:()=>U,LogLevel:()=>ht,OnRequestHook:()=>Ue,OnResponseHook:()=>Ge,OnStreaming:()=>Ke,ParseEndRegionHook:()=>Mt,ParseHook:()=>$t,ParseMetaDataHook:()=>It,ProtoDefinition:()=>Bt,ProvideAssertValue:()=>Dt,ProvideEnvironmentsHook:()=>jt,ProvideVariablesHook:()=>_t,RepeatOrder:()=>Rr,ReplaceVariableHook:()=>Ft,RequestClientEvent:()=>Oe,ResponseLoggingHook:()=>We,TestResultStatus:()=>me,VariableType:()=>ie,cli:()=>ei,createEmptyProcessorContext:()=>br,getEnvironments:()=>Bc,getVariables:()=>wu,io:()=>D,send:()=>Jn,store:()=>As,testSymbols:()=>ne,utils:()=>f});module.exports=Ju(gn);var ei={};gt(ei,{createProgram:()=>Uu,execute:()=>uf,initFileProvider:()=>Hi,initIOProvider:()=>Ss});var Bu=require("commander"),Nu=require("path");var f={};gt(f,{ENVIRONMENT_NONE:()=>li,HandlebarsSingleLine:()=>Jt,OAuth2Regex:()=>bs,RegionSeparator:()=>st,addHttpFileRequestClientHooks:()=>zt,addSkippedTestResult:()=>qe,addTestResultToHttpRegion:()=>je,assertHasNoResponseBody:()=>ns,assertHasResponseBody:()=>ss,assertHeaderContains:()=>os,assertHeaderEquals:()=>rs,assertMaxTotalTime:()=>ts,assertResponseBodyEquals:()=>is,assertStatusEquals:()=>es,cleanVariables:()=>qr,cloneRequest:()=>ni,cloneResponse:()=>$e,createResponseProxy:()=>Tr,decodeJWT:()=>et,defaultConfigFiles:()=>Cr,deleteHeader:()=>Ee,deleteVariableInContext:()=>ot,distinct:()=>Xu,ensureString:()=>xe,equalsPath:()=>ls,errorToString:()=>Ie,executeGlobalScripts:()=>kt,executeRequestClientFactory:()=>cs,expandVariable:()=>Hr,extensionName:()=>as,findHttpRegionInContext:()=>Ct,findRootDir:()=>wr,findRootDirOfFile:()=>kr,getBufferEncoding:()=>Rt,getDisplayName:()=>Qt,getHeader:()=>E,getHeaderArray:()=>O,getHeaderBoolean:()=>B,getHeaderNumber:()=>bt,getHeaderString:()=>j,getHttpyacConfig:()=>ds,getMarkdownSyntax:()=>yi,getPartOfBody:()=>Yo,getPlugins:()=>us,getRegionDescription:()=>fs,importHttpFileInContext:()=>Zt,isBufferEncoding:()=>ii,isError:()=>ce,isHttpRegionSendContext:()=>Rs,isHttpRegionsSendContext:()=>ks,isHttpRequest:()=>V,isHttpRequestMethod:()=>tp,isHttpResponse:()=>xt,isMimeTypeCSS:()=>Wo,isMimeTypeFormUrlEncoded:()=>Ye,isMimeTypeHtml:()=>Ko,isMimeTypeImage:()=>Zu,isMimeTypeJSON:()=>Ut,isMimeTypeJavascript:()=>Go,isMimeTypeMarkdown:()=>Gt,isMimeTypeMultiPartFormData:()=>Qo,isMimeTypeMultiPartMixed:()=>zo,isMimeTypeNewlineDelimitedJSON:()=>Jo,isMimeTypePdf:()=>Yu,isMimeTypeXml:()=>Xe,isOpenIdInformation:()=>Lr,isProcessorContext:()=>ve,isPromise:()=>St,isString:()=>m,isStringEmpty:()=>ze,isUndefined:()=>be,iterateDirectoryTree:()=>Pr,iterateUntilRoot:()=>_e,joinMarkdown:()=>Ar,knownMetaData:()=>ki,logResponse:()=>se,mergeRawHttpHeaders:()=>np,mergeResponses:()=>Sr,parseComments:()=>nt,parseContentType:()=>Ze,parseDefaultHeadersFactory:()=>Xt,parseError:()=>Wt,parseFileImport:()=>Yt,parseHandlebarsString:()=>K,parseHandlebarsSymbols:()=>Ce,parseInlineResponse:()=>de,parseJson:()=>Kt,parseMimeType:()=>Nt,parseQueryLineFactory:()=>vs,parseRequestHeaderFactory:()=>Pt,parseRequestLineFactory:()=>ue,parseSubsequentLines:()=>wt,parseUrlLineFactory:()=>xs,promiseQueue:()=>ws,randomArrayValue:()=>Ps,randomData:()=>er,randomEmail:()=>Or,randomText:()=>He,repeat:()=>ps,replaceFilePath:()=>le,replaceInvalidChars:()=>tt,replaceVariables:()=>M,report:()=>x,requestLoggerFactory:()=>Xo,resolveClientCertificates:()=>ai,setVariableInContext:()=>_,shortenFileName:()=>ip,shrinkCloneResponse:()=>Zo,sleep:()=>Se,stateGenerator:()=>Je,stringifySafe:()=>k,testFactory:()=>tr,testFactoryAsync:()=>Cs,toAbsoluteFilename:()=>z,toBoolean:()=>G,toBufferLike:()=>ae,toEnvironmentKey:()=>J,toHttpString:()=>kp,toHttpStringHeader:()=>gs,toHttpStringRequest:()=>gi,toHttpStringResponse:()=>fi,toMarkdown:()=>wp,toMarkdownHeader:()=>hs,toMarkdownMeta:()=>vi,toMarkdownRequest:()=>bi,toMarkdownResponse:()=>hi,toMarkdownTestResults:()=>xi,toMarkdownTimings:()=>Ri,toMultiLineArray:()=>Pe,toMultiLineString:()=>F,toNumber:()=>S,toQueryParams:()=>N,toString:()=>b,unsetVariableInContext:()=>mp,useDefaultOnError:()=>rt});function Xu(t){function e(r,o,s){return s.indexOf(r)===o}return t.filter(e)}var X=T(require("chalk")),si=require("util");var D={};gt(D,{Logger:()=>yt,completionItemProvider:()=>I,fileProvider:()=>g,httpClientProvider:()=>oe,javascriptProvider:()=>H,log:()=>p,userInteractionProvider:()=>q});var I={emptyLineProvider:[],variableProvider:[],requestHeaderProvider:[]};var g={EOL:`\r
`,exists:()=>{throw new Error("Not Implemented")},dirname:()=>{throw new Error("Not Implemented")},hasExtension:()=>{throw new Error("Not Implemented")},isAbsolute:()=>{throw new Error("Not Implemented")},joinPath:()=>{throw new Error("Not Implemented")},readFile:()=>{throw new Error("Not Implemented")},readBuffer:()=>{throw new Error("Not Implemented")},writeBuffer:()=>{throw new Error("Not Implemented")},readdir:()=>{throw new Error("Not Implemented")},fsPath:ri,toString:ri};function ri(t){return typeof t=="string"?t:t.toString()}var oe={};var H={require:{},evalExpression:async function(e,r){return r.variables[e]}};var ee=require("hookpoint"),$t=class extends ee.LastOutHook{constructor(){super(e=>!!e),this.id="ParseHook"}},It=class extends ee.LastOutHook{constructor(){super(e=>!!e),this.id="ParseMetaDataHook"}},Dt=class extends ee.LastOutHook{constructor(){super(e=>e!==!1),this.id="ProvideAssertValue"}},Mt=class extends ee.SeriesHook{constructor(){super(),this.id="ParseEndRegionHook"}},_t=class extends ee.SeriesHook{constructor(){super(),this.id="ProvideVariablesHook"}},jt=class extends ee.SeriesHook{constructor(){super(),this.id="ProvideEnvironmentsHook"}},Ft=class extends ee.WaterfallHook{constructor(){super(e=>e===void 0),this.id="ReplaceVariableHook"}},Ue=class extends ee.SeriesHook{constructor(){super(),this.id="BeforeRequestHook"}},Ge=class extends ee.SeriesHook{constructor(){super(),this.id="AfterRequestHook"}},Ke=class extends ee.SeriesHook{constructor(){super(),this.id="OnStreaming"}},We=class extends ee.SeriesHook{constructor(){super(),this.id="ResponseLoggingHook"}},Qe=class extends ee.SeriesHook{constructor(){super(e=>!e),this.id="ExecuteHook"}};var oi=require("hookpoint"),Vt=oi.HookCancel;var v=class{constructor(e){this.name=e.name||"symbol",this.description=e.description,this.kind=e.kind,this.startLine=e.startLine,this.startOffset=e.startOffset,this.endLine=e.endLine,this.endOffset=e.endOffset,this.children=e.children,this.source=e.source}getSymbolsForLine(e){let r=[];if((this.startLine<=e||this.endLine>=e)&&(r.push(this),this.children))for(let o of this.children)r.push(...o.getSymbolsForLine(e));return r}filter(e){let r=[];if(e(this)&&r.push(this),this.children)for(let o of this.children)r.push(...o.filter(e));return r}};var U=(y=>(y.request="request",y.requestLine="requestLine",y.requestHeader="requestHeader",y.requestBody="requestBody",y.response="response",y.gql="gql",y.proto="proto",y.script="script",y.metaData="metaData",y.comment="comment",y.url="url",y.operator="operator",y.key="key",y.value="value",y.variable="variable",y.path="path",y.variableDefinition="variableDefinition",y.text="text",y))(U||{});var ht=(i=>(i[i.trace=1]="trace",i[i.debug=2]="debug",i[i.warn=5]="warn",i[i.info=10]="info",i[i.error=100]="error",i[i.none=1e3]="none",i))(ht||{});var Bt=class{constructor(e){this.fileName=e}};var Rr=(r=>(r[r.sequential=0]="sequential",r[r.parallel=1]="parallel",r))(Rr||{});var Oe=class extends Event{constructor(r,o){super(r);this.detail=o}},te=class{constructor(){this.eventEmitter=new EventTarget}addEventListener(e,r){this.eventEmitter.addEventListener(e,o=>this.isRequestClientEvent(o)?r(o):void 0)}removeEventListener(e,r){this.eventEmitter.removeEventListener(e,o=>this.isRequestClientEvent(o)?r(o):void 0)}isRequestClientEvent(e){return e instanceof Oe}onMessage(e,r){this.eventEmitter.dispatchEvent(new Oe("message",[e,r]))}onProgress(e){this.eventEmitter.dispatchEvent(new Oe("progress",e))}onMetaData(e,r){this.eventEmitter.dispatchEvent(new Oe("metaData",[e,r]))}onDisconnect(){this.eventEmitter.dispatchEvent(new Oe("disconnect",void 0))}triggerEnd(){this.eventEmitter.dispatchEvent(new Oe("end",void 0))}};var ne={ok:"\u2713",error:"\u2716",skipped:"\u25CB"};var me=(s=>(s.SUCCESS="SUCCESS",s.FAILED="FAILED",s.SKIPPED="SKIPPED",s.ERROR="ERROR",s))(me||{});var ie=(s=>(s.variable="Variable",s.url="Url",s.body="Body",s.filePath="FilePath",s))(ie||{});var yt=class{constructor(e){this.options=e}collectMessages(){this.collectCache=[],this.priorityCache=[]}flush(){this.priorityCache=this.flushCache(this.priorityCache),this.collectCache=this.flushCache(this.collectCache)}flushCache(e){if(e){for(let r of e)r();return[]}}writeLog(e,r,o,s){var n,i;if(!((n=this.options)!=null&&n.level)||e>=this.options.level){let a=()=>o(...s);(i=this.options)!=null&&i.logMethod&&(a=()=>{var l,d;return(d=(l=this.options)==null?void 0:l.logMethod)==null?void 0:d.call(l,e,...s)}),r?r.push(a):a()}}info(...e){this.writeLog(10,this.collectCache,console.info,e)}log(...e){this.writeLog(10,this.collectCache,console.log,e)}trace(...e){this.writeLog(1,this.collectCache,this.options.noTrace?console.debug:console.trace,e)}debug(...e){this.writeLog(2,this.collectCache,console.debug,e)}error(...e){this.writeLog(100,this.collectCache,console.error,e)}warn(...e){this.writeLog(5,this.collectCache,console.warn,e)}logPriority(...e){this.writeLog(10,this.priorityCache,console.info,e)}clear(){console.clear()}},p=new yt({level:5,noTrace:!0});var q={isTrusted:()=>!0,showNote:async function(){throw new Error("Not Implemented")},showInputPrompt:async function(){throw new Error("Not Implemented")},showListPrompt:async function(){throw new Error("Not Implemented")}};function F(t){return t.join(g.EOL)}function Pe(t){return t.split(/\r?\n/gu)}function be(t){return typeof t>"u"}function m(t){return typeof t=="string"}function ze(t){return typeof t=="string"&&/^(\s*)?$/u.test(t)}function Je(t=30){let e="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-._~",r=[];for(let o=t;o>0;--o)r.push(e[Math.floor(Math.random()*e.length)]);return r.join("")}function b(t){if(m(t))return t;if(typeof t=="number")return`${t}`;if(t instanceof Date)return t.toISOString();if(t instanceof Error)return t.message;if(Buffer.isBuffer(t))return t.toString("utf-8");if(Array.isArray(t)&&t.every(e=>Buffer.isBuffer(e))){let e=t.map(r=>Buffer.isBuffer(r)&&r.toString("utf8"));return k(e)}if(t)return k(t)}function k(t,e=0){try{return JSON.stringify(t,null,e)}catch(r){return p.debug("JSON.stringify error",r),JSON.stringify(t,(()=>{let s=new WeakSet;return(n,i)=>{if(typeof i=="object"&&i!==null){if(s.has(i))return;s.add(i)}return i}})(),e)}}function xe(t){return typeof t>"u"||t===null||m(t)?t:`${t}`}function G(t,e=!1){var s;if(typeof t=="boolean")return t;if(typeof t=="number")return!!t;let r=(s=xe(t))==null?void 0:s.trim();if(!r)return e;if(/^true$/iu.test(r))return!0;if(/^false$/iu.test(r))return!1;let o=parseFloat(r);return isNaN(o)?e:!!o}function S(t){if(typeof t=="number")return t;let e=xe(t);if(e){let r=Number.parseFloat(e.trim());if(!Number.isNaN(r))return r}}function ae(t){return Buffer.isBuffer(t)?t:b(t)}function Nt(t){var n,i;let[e,...r]=t.split(";").map(a=>a.trim()),o=(n=r.find(a=>a.startsWith("charset=")))==null?void 0:n.split("=")[1],s=(i=r.find(a=>a.startsWith("boundary=")))==null?void 0:i.split("=")[1];return{mimeType:e,contentType:t,charset:o,boundary:s}}function Ut(t){return!!t&&(t.mimeType==="application/json"||t.mimeType==="text/json"||t.mimeType.indexOf("+json")>=0||t.mimeType.indexOf("x-amz-json")>=0)}function Go(t){return(t==null?void 0:t.mimeType)==="application/javascript"||(t==null?void 0:t.mimeType)==="text/x-javascript"}function Xe(t){return!!t&&(t.mimeType==="application/xml"||t.mimeType==="text/xml"||t.mimeType.indexOf("+xml")>=0)}function Ko(t){return(t==null?void 0:t.mimeType)==="text/html"}function Wo(t){return(t==null?void 0:t.mimeType)==="text/css"}function Gt(t){return(t==null?void 0:t.mimeType)==="text/markdown"}function Qo(t){return(t==null?void 0:t.mimeType)==="multipart/form-data"}function zo(t){return(t==null?void 0:t.mimeType)==="multipart/mixed"}function Jo(t){return(t==null?void 0:t.mimeType)==="application/x-ndjson"}function Ye(t){return(t==null?void 0:t.mimeType)==="application/x-www-form-urlencoded"}function Yu(t){return(t==null?void 0:t.mimeType)==="application/pdf"}function Zu(t){return t?["image/jpeg","image/gif","image/webp","image/png","image/bmp"].indexOf(t.mimeType)>=0:!1}function tp(t){return t?["ACL","BASELINE-CONTROL","CHECKIN","CHECKOUT","CONNECT","COPY","DELETE","GET","GRAPHQL","HEAD","LOCK","MERGE","MKACTIVITY","MKCALENDAR","MKCOL","MKWORKSPACE","MOVE","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PUT","REPORT","SEARCH","TRACE","UNLOCK","VERSION-CONTROL"].includes(t.toUpperCase()):!1}function V(t){return(t==null?void 0:t.protocol)==="HTTP"}function Ee(t,...e){if(t)for(let r of e){let o=Object.entries(t).find(([s])=>s.toLowerCase()===r.toLowerCase());o&&o.length>1&&delete t[o[0]]}}function j(t,e){let r=E(t,e);if(m(r))return r}function B(t,e,r=!1){let o=E(t,e);return G(o,r)}function E(t,e){if(t){let r=Object.entries(t).find(([o])=>o.toLowerCase()===e.toLowerCase());if(r&&r.length>1)return r[1]}}function bt(t,e){let r=E(t,e);return S(r)}function O(t,e,r=[]){let o=E(t,e);return o?m(o)?[o]:o:r}function Ze(t){let e=E(t,"content-type");if(m(e))return Nt(e)}function et(t){try{let e=t.split(".");if(e.length!==3)return null;let r=e[1];switch(r=r.replace(/-/gu,"+"),r=r.replace(/_/gu,"/"),r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:return null}let o=new si.TextDecoder().decode(Buffer.from(r,"base64"));return JSON.parse(o)}catch(e){return p.warn(e),null}}function N(t){return Object.entries(t).filter(([,e])=>!!e).map(([e,r])=>Array.isArray(r)?r.map(o=>`${e}=${encodeURIComponent(o||"")}`).join("&"):`${e}=${encodeURIComponent(r||"")}`).join("&")}function Xo(t,e,r){return async function(s,n){var l,d,u,c,h,R,w,$,Q,C,y;let i=e;if(r&&(n!=null&&n.testResults)&&n.testResults.some(L=>["FAILED","ERROR"].includes(L.status))&&(i=r),!i||i.onlyFailed&&(!(n!=null&&n.testResults)||n.testResults.every(L=>L.status==="SUCCESS")))return;if(t(""),t("---------------------"),t(""),(l=n==null?void 0:n.metaData)!=null&&l.title||(d=n==null?void 0:n.metaData)!=null&&d.name||(u=n==null?void 0:n.metaData)!=null&&u.description){let L=((c=n==null?void 0:n.metaData)==null?void 0:c.title)||((h=n==null?void 0:n.metaData)==null?void 0:h.name);L&&t(X.default`{gray === ${L} ===}`),(R=n==null?void 0:n.metaData)!=null&&R.description&&t(X.default`{gray ${n.metaData.description}}`),t("")}let a=(s==null?void 0:s.request)||(n==null?void 0:n.request);if(a&&(i.useShort?t(X.default`{yellow ${(a==null?void 0:a.method)||"GET"}} {gray ${(a==null?void 0:a.url)||"?"}}`):i.requestOutput&&rp(a,{headers:i.requestHeaders,bodyLength:i.requestBodyLength}).forEach(L=>t(L))),s)if(i.useShort)t(X.default`{gray =>} {cyan.bold ${s.statusCode}} ({yellow ${((w=s.timings)==null?void 0:w.total)||"?"} ms}, {yellow ${(($=s.meta)==null?void 0:$.size)||"?"}})`);else{let L=[];if(i.responseHeaders&&(L.length>0&&L.push(""),L.push(...op(s))),i.timings&&(L.length>0&&L.push(""),L.push(...sp(s))),m(s.body)&&i.responseBodyLength!==void 0){let Z=s.body;i.responseBodyPrettyPrint&&s.prettyPrintBody&&(Z=s.prettyPrintBody),Z=Yo(Z,i.responseBodyLength),Z&&(L.length>0&&L.push(""),L.push(Z))}t(F(L))}if(n!=null&&n.testResults)for(let L of n.testResults){let Z=X.default`{green ${ne.ok} ${L.message||"Test passed"}}`;if(L.status==="SKIPPED")Z=X.default`{yellow ${ne.skipped} Test skipped}`;else if(["ERROR","FAILED"].includes(L.status)){let ye=L.error?` (${(Q=L.error)==null?void 0:Q.displayMessage})`:"";Z=X.default`{red ${ne.error} ${L.message||"Test failed"}${ye}}`,!(e!=null&&e.useShort)&&((C=L.error)!=null&&C.error.stack)&&(Z=[Z,(y=L.error)==null?void 0:y.error.stack].join(`\r
`))}t(Z)}}}function Yo(t,e){let r=t;if(!(typeof e>"u"||e<0))return e>0&&(r=t.slice(0,Math.min(t.length,e)),t.length>=e&&(r+=`... (${t.length-e} characters more)`)),r}function rp(t,e){var o,s,n,i;let r=[];return r.push(X.default`{cyan.bold ${t.method} ${t.url}}`),t.headers&&e.headers&&r.push(...Object.entries(t.headers).map(([a,l])=>X.default`{yellow ${a}}: ${l}`).sort()),V(t)&&((s=(o=t.options)==null?void 0:o.https)!=null&&s.certificate||(i=(n=t.options)==null?void 0:n.https)!=null&&i.pfx)&&r.push(X.default`{yellow client-cert}: true`),m(t.body)&&e.bodyLength!==void 0&&(r.push(""),r.push(X.default`{gray ${Yo(t.body,e.bodyLength)}}`)),r}function op(t){let e=[];return e.push(X.default`{cyan.bold ${t.protocol}} {cyan.bold ${t.statusCode}} {bold ${t.statusMessage?` - ${t.statusMessage}`:""}}`),t.headers&&e.push(...Object.entries(t.headers).filter(([r])=>!r.startsWith(":")).map(([r,o])=>X.default`{yellow ${r}}: ${o}`).sort()),e}function sp(t){let e=[];return t.timings&&(e.push(X.default`{cyan.bold Timings}:`),e.push(...Object.entries(t.timings).filter(([,r])=>!!r).map(([r,o])=>X.default`{yellow ${r}}: ${o}`).sort())),e}function ni(t){return{url:t.url,method:t.method,body:t.body,contentType:t.contentType&&{...t.contentType},headers:t.headers&&{...t.headers},supportsStreaming:t.supportsStreaming}}function xt(t){let e=t;return!!(e!=null&&e.statusCode)}function Zo(t){let e=$e(t);return delete e.rawBody,delete e.prettyPrintBody,delete e.request,e}function $e(t){return{name:t.name,protocol:t.protocol,statusCode:t.statusCode,statusMessage:t.statusMessage,httpVersion:t.httpVersion,headers:t.headers,body:t.body,rawHeaders:t.rawHeaders,rawBody:t.rawBody,parsedBody:t.parsedBody,prettyPrintBody:t.prettyPrintBody,contentType:t.contentType,timings:t.timings&&{...t.timings},meta:t.meta,tags:t.tags,request:t.request&&ni(t.request)}}function np(t){let e={};for(let r=0;r<t.length;r+=2){let o=t[r],s=t[r+1];if(typeof s>"u")continue;let n=o.toLowerCase();e[n]=e[n]||[],e[n].push(s)}return e}function vt(t,e){if(!t)throw new Error(e)}function es(t,e){vt(t.statusCode===e,`response status is ${t.statusCode} (expected: ${e})`)}function ts(t,e){var r,o;vt((r=t.timings)!=null&&r.total?t.timings.total<e:!0,`total time is ${(o=t.timings)==null?void 0:o.total} (expected max ${e})`)}function rs(t,e,r){let o=E(t.headers,e);vt(o===r,`response header ${e} is ${o} (expected: ${r})`)}function os(t,e,r){let o=E(t.headers,e);(m(o)||Array.isArray(o))&&vt(!!o.indexOf(r),`response header contains ${r}`)}function ss(t){console.assert(!!t.body,"response body exists")}function ns(t){vt(!t.body,"response body does not exists")}function is(t,e){vt(t.body===e,`response body equals ${e}`)}function ii(t){return["ascii","utf8","utf-8","utf16le","ucs2","ucs-2","base64","latin1","binary","hex"].indexOf(t)>=0}function Rt(t){return t&&ii(t)?t:"utf8"}async function z(t,e){if(t){if(await g.isAbsolute(t)&&await g.exists(t))return t;if(e&&m(t)){let r=g.joinPath(e,t);if(await g.exists(r))return r}}}function as(t){let e=g.toString(t),r=e.lastIndexOf(".");if(r>0&&r<e.length-2)return e.slice(r+1)}function tt(t){return t.replace(/[/\\?%*:|"<>\s()@\-~,=$]/gu,"_").split("_").filter(r=>r.length>0).join("_")}function ip(t,e=50){let r=[],o=0;for(let n of t.split("_").reverse())n.length+o<e?(r.push(n),o+=n.length+1):r.length===0&&r.push(n);let s=r.reverse().join("_");return s.slice(Math.max(s.length-e,0))}async function kr(t,e,...r){let o=t,s=g.fsPath(t);!await g.isAbsolute(t)&&e&&s&&(o=g.joinPath(e,s));let n=g.dirname(o);return await wr(n,...r)}async function wr(t,...e){return Pr(t,async r=>{let o=await g.readdir(r);if(o.some(s=>e.indexOf(s)>=0))return!0;for(let s of e)if(o.some(n=>s.startsWith(n))&&await g.exists(g.joinPath(r,s)))return!0;return!1})}async function _e(t,e,r){return Pr(t,async o=>(await r(o),!!e&&ls(e,o)))}async function Pr(t,e){if(t){if(await e(t))return t;if(!ls(g.dirname(t),t))return Pr(g.dirname(t),e)}}function ls(t,e){return!!t&&!!e&&g.toString(t)===g.toString(e)}async function ds(t,e){let r;return e&&(r=await ap(e),r||(r=await lp(t,e)),r&&await ai(r,e)),r}var Cr=[".httpyac.js",".httpyac.cjs",".httpyac.config.js",".httpyac.config.cjs","httpyac.config.js","httpyac.config.cjs",".httpyac.json","httpyac.config.json"];async function ap(t){let e;for(let r of Cr){let o=r&&g.joinPath(t,r);if(o&&await g.exists(o)){e=g.fsPath(o);break}}if(e){let r=g.fsPath(t);if(r&&H.loadModule){let o=H.loadModule(e,r,!0);return typeof o=="function"?o():o}}}async function lp(t,e){let r=[];if(await _e(t,e,async o=>{var n;let s=(n=await Kt(g.joinPath(o,"package.json")))==null?void 0:n.httpyac;s&&r.push(s)}),r.length>0)return Object.assign({},...r.reverse())}async function Kt(t){try{if(await g.exists(t)){let e=await g.readFile(t,"utf-8");return JSON.parse(e)}}catch{p.debug(`json parse of ${t} failed`)}}async function ai(t,e){if(t.clientCertificates)for(let[,r]of Object.entries(t.clientCertificates))r.cert&&(r.cert=await z(r.cert,e)||r.cert),r.key&&(r.key=await z(r.key,e)||r.key),r.pfx&&(r.pfx=await z(r.pfx,e)||r.pfx)}async function us(t){let e=await dp(t),r={};if(e!=null&&e.json){let o=[...Object.keys(e.json.dependencies||{}),...Object.keys(e.json.devDependencies||{})].filter(up);for(let s of o){let n=g.fsPath(e.dir);if(n&&H.loadModule){let i=H.loadModule(s,n);i&&(r[s]=i)}}}return r}async function dp(t){let e=await wr(t,"package.json");if(e)return{dir:e,json:await Kt(g.joinPath(e,"package.json"))}}function up(t){return/^(httpyac-|@[\w-]+(\.)?[\w-]+\/httpyac-)plugin-/u.test(t)}var li="__NONE__";function J(t){return t&&t.length>0?t.sort().join(","):li}function ce(t){if(!t)return!1;if(t instanceof Error)return!0;let e=t;return!!e.message&&!!e.stack&&!!e.name}function Wt(t){var e;if(t.stack){let r=/^(?<error>.*):\s*(?<message>.*)\r?\n\s*at (?<file>.*):(?<line>\d*):(?<offset>\d*)/mu.exec(t.stack);if(r&&((e=r.groups)!=null&&e.error))return{error:t,errorType:r.groups.error,message:r.groups.message,file:r.groups.file,line:r.groups.line,offset:r.groups.offset,displayMessage:`${r.groups.error}: ${r.groups.message} - ${r.groups.file}:${r.groups.line}:${r.groups.offset}`}}return{error:t,displayMessage:t.message}}function Ie(t){return ce(t)?k({message:t.message,name:t.name,stack:t.stack}):b(t)}async function rt(t,e){try{return await t}catch(r){return p.warn("promise has read error",r),e}}var ci=require("hookpoint");var ms=require("hookpoint");function x(t,e){var r,o;p.debug(e),(o=(r=t.progress)==null?void 0:r.report)==null||o.call(r,{message:e})}async function ps(t,e){var n,i;let r=[],o=1;(n=e.repeat)!=null&&n.count&&e.isMainContext&&(o=e.repeat.count);for(let a=0;a<o;a++)r.push(t);let s=[];if(((i=e.repeat)==null?void 0:i.type)===1){let a=await Promise.all(r.map(l=>l()));for(let l of a)l&&a.push(l)}else for(let a of r){let l=await a();l&&s.push(l)}return Sr(s)}function Sr(t){if(t.length>1){let e=$e(t[0]);delete e.prettyPrintBody,delete e.rawBody,delete e.meta,delete e.timings;let r={responses:[],statusCount:{},count:t.length},o=[];for(let s of t){s.statusCode>e.statusCode&&(e.statusCode=s.statusCode,e.statusMessage=s.statusMessage);let n=`${s.statusCode}`;r.statusCount[n]?r.statusCount[n]+=1:r.statusCount[n]=1,s.timings&&o.push(s.timings),delete s.prettyPrintBody,delete s.parsedBody,delete s.rawBody,r.responses.push($e(s)),o.length>0&&(e.timings=pp(o))}return e.parsedBody=r,e.body=k(r,2),e}return t.pop()}function pp(t){let e=[],r=[],o=[],s=[],n=[],i=[],a=[],l=[];for(let u of t)e.push(u.dns||0),r.push(u.download||0),o.push(u.firstByte||0),s.push(u.request||0),n.push(u.tcp||0),i.push(u.tls||0),a.push(u.total||0),l.push(u.wait||0);let d=u=>{let c=u.filter(h=>h>0);if(c.length>0)return c.reduce((h,R)=>h+R,0)/c.length};return{dns:d(e),download:d(r),firstByte:d(o),request:d(s),tcp:d(n),tls:d(i),total:d(a),wait:d(l)}}var di=require("hookpoint");async function M(t,e,r){var o,s;return(s=(o=r.progress)==null?void 0:o.isCanceled)!=null&&s.call(o)?(p.trace("process canceled by user"),di.HookCancel):await r.httpFile.hooks.replaceVariable.trigger(t,e,r)}async function le(t,e,r){var s,n,i,a;let o=await M(t,"FilePath",e);if(m(o)){let l=await z(o,g.dirname(e.httpFile.fileName));if(l)return await r(l);let d=`file not found: ${t}`;(n=(s=q).showWarnMessage)==null||n.call(s,d),p.warn(d)}else{let l=`file replace made file invalid: ${t} <> ${o}`;(a=(i=q).showWarnMessage)==null||a.call(i,l),p.warn(l)}}function Hr(t,e){if(t&&m(t)){let r=t,o,s=/\{{2}\s*([a-zA-Z0-9_]+)\s*\}{2}/gu;for(;(o=s.exec(r))!==null;){let[n,i]=o,a=Hr(e[i],e);e[i]=a,r=r.replace(n,()=>`${a}`)}return r}return t}function _(t,e){if(t){let r=qr(t);Object.assign(e.variables,r);let o=J(e.activeEnvironment);e.httpRegion.variablesPerEnv[o]||(e.httpRegion.variablesPerEnv[o]={}),Object.assign(e.httpRegion.variablesPerEnv[o],r)}}function qr(t){return Object.fromEntries(Object.entries(t).filter(([e])=>!H.isAllowedKeyword||H.isAllowedKeyword(e)))}function ot(t,e){delete e.variables[t];let r=J(e.activeEnvironment);e.httpRegion.variablesPerEnv[r]&&delete e.httpRegion.variablesPerEnv[r][t]}function mp(t,e){let r=J(e.activeEnvironment),o=e.httpRegion.variablesPerEnv[r];for(let s of Object.keys(t))delete e.variables[s],o&&delete o[s]}var pi=require("uuid");function cs(t,e){return async function(r){var s;let{request:o}=r;if(o!=null&&o.url){if(!await bp(r))return!1;let n=t(o,r);_({$requestClient:n},r),r.requestClient=n;let i=fp(n,r),a=((s=n.getSessionId)==null?void 0:s.call(n))||(0,pi.v4)(),l=Rp(e,a,o,()=>{n.disconnect(new Error("user cancellation"))});try{let d=[];gp(n,r),hp(n,r,d),yp(n,r,d),x(r,n.reportMessage);let u=await n.connect(l.connection);p.debug(`requestClient ${o.url} connect`),l.connectionCount++,u!==l.connection&&(l.connection=u),await Promise.all([ps(()=>n.send(),r),xp(r).then(()=>{var R;(R=n.streamEnded)==null||R.call(n)})]);let c=await Promise.all(d),h=Sr(cp(...c));return h&&!await vp(h,r)?!1:(l.connectionCount--,ui(e,l)&&(p.debug(`requestClient ${o.url} disconnect`),n.disconnect()),!0)}catch(d){throw l.connectionCount--,ui(e,l)&&((r.scriptConsole||p).error(r.request),p.debug(`requestClient ${o.url} disconnect`),ce(d)?n.disconnect(d):n.disconnect(new Error(b(d)))),d}finally{n.triggerEnd(),i==null||i(),delete r.requestClient,ot("$requestClient",r)}}return!1}}function cp(...t){let e=[];for(let r of t)r&&e.push(r);return e}function fp(t,e){var r,o;if((r=e.progress)!=null&&r.register)return(o=e.progress)==null?void 0:o.register(()=>t.disconnect(new Error("user cancellation")))}function gp(t,e){var r;if(e.isMainContext&&((r=e.progress)!=null&&r.report)){let o=0;t.addEventListener("progress",s=>{var a;let n=s.detail,i=n-o;if(o=n,(a=e.progress)!=null&&a.report){p.trace(`progress to ${n}`);let l=e.progress.divider||1;e.progress.report({message:"request progress",increment:i/l*100})}})}}function hp(t,e,r){t.addEventListener("message",o=>{let[s,n]=o.detail;p.debug(s,(n==null?void 0:n.message)||(n==null?void 0:n.body)),r.push(Promise.resolve(n)),t.supportsStreaming&&!e.httpRegion.metaData.noStreamingLog&&e.logStream&&r.push(e.logStream(s,{...n}))})}function yp(t,e,r){t.addEventListener("metaData",o=>{let[s,n]=o.detail;p.debug(`event ${s} for ${n.protocol}`,(n==null?void 0:n.message)||(n==null?void 0:n.body)),e.httpRegion.metaData.metaDataLogging&&e.logStream&&r.push(e.logStream(s,n))})}async function bp(t){let e=t.hooks.onRequest;return t.progress&&e.addInterceptor(mi(()=>{var r;return!!((r=t.progress)!=null&&r.isCanceled())})),t.request&&await e.trigger(t.request,t)!==ms.HookCancel}async function xp(t){let e=t.hooks.onStreaming;t.progress&&e.addInterceptor(mi(()=>{var r;return!!((r=t.progress)!=null&&r.isCanceled())})),await e.trigger(t)}async function vp(t,e){return await e.hooks.onResponse.trigger(Tr(t),e)===ms.HookCancel?!1:(e.httpRegion.response=t,!0)}function mi(t){return{id:"isCanceled",async beforeTrigger(){return!t()},async afterTrigger(){return!t()}}}function Tr(t){return new Proxy(t,{set(...r){let[o,s,n]=r,i=Reflect.set(...r);return s==="body"&&(delete o.prettyPrintBody,delete o.parsedBody,delete o.rawBody,typeof n=="string"&&(o.rawBody=Buffer.from(n))),i}})}function Rp(t,e,r,o){let s=t.getUserSession(e);if(s!=null&&s.connection)return s;let n={id:e,description:"Pending Connection",details:{method:r.method,url:r.url},title:`${r.method} ${r.url}`,type:"Stream",connectionCount:0,delete:o};return t.setUserSession(n),n}function ui(t,e){return e.connectionCount<=0&&(delete e.delete,t.removeUserSession(e.id)),e.connectionCount===0}function Qt(t,e="global"){var r,o,s,n;if(t){if(m(t.metaData.title))return t.metaData.title;if(m(t.metaData.name))return t.metaData.name;if((r=t.request)!=null&&r.url){let i=t.request.url.indexOf("?");i<0&&(i=t.request.url.length);let a=((n=(s=(o=t.symbol.children)==null?void 0:o.find)==null?void 0:s.call(o,l=>l.kind==="requestLine"))==null?void 0:n.startLine)||t.symbol.startLine;return`${t.request.method} ${t.request.url.slice(0,i)} (line: ${a+1})`}}return e}function fs(t,e="-"){var r;return m(t.metaData.description)?t.metaData.description:(r=t.request)!=null&&r.url?`${t.request.method} ${t.request.url}`:e}async function se(t,e){let r;t&&(r=$e(t),await e.hooks.responseLogging.trigger(Tr(r),e)===ci.HookCancel)||!e.httpRegion.metaData.noLog&&e.logResponse&&await e.logResponse(r,e.httpRegion)}async function kt(t){for(let e of t.httpFile.globalHttpRegions)if(!await e.execute(t))return!1;return!0}function zt(t,e){return{onRequest:e.hooks.onRequest.merge(...e.globalHttpRegions.map(r=>r.hooks.onRequest),t.onRequest),onResponse:e.hooks.onResponse.merge(t.onResponse,...e.globalHttpRegions.map(r=>r.hooks.onResponse)),onStreaming:e.hooks.onStreaming.merge(t.onStreaming,...e.globalHttpRegions.map(r=>r.hooks.onStreaming)),responseLogging:e.hooks.responseLogging.merge(t.responseLogging,...e.globalHttpRegions.map(r=>r.hooks.responseLogging))}}function kp(t,e){let r=[];return t.request&&(r.push(...gi(t.request,{body:!!(e!=null&&e.requestBody)})),r.push("")),r.push(...fi(t,{prettyPrint:!!(e!=null&&e.prettyPrint),body:!!(e!=null&&e.responseBody)})),F(r)}function fi(t,e){let r=[];return r.push(`${t.protocol} ${t.statusCode} ${t.statusMessage?` - ${t.statusMessage}`:""}`),t.headers&&r.push(...gs(t.headers)),e!=null&&e.body&&m(t.body)&&(r.push(""),r.push(e!=null&&e.prettyPrint&&t.prettyPrintBody?t.prettyPrintBody:t.body)),r}function gi(t,e){let r=[];return r.push(`${t.method} ${t.url}`),t.headers&&r.push(...gs(t.headers)),e!=null&&e.body&&m(t.body)&&(r.push(""),r.push(t.body)),r}function gs(t){return Object.entries(t).map(([e,r])=>{let o=r||"";return r&&(Array.isArray(r)?o=r.join(", "):m(r)||(o=k(r))),`${e}: ${o}`})}function wp(t,e){let r=[];return t.request&&(r.push(...bi(t.request,{body:!!(e!=null&&e.requestBody)})),r.push("")),r.push(...hi(t,{prettyPrint:!!(e!=null&&e.prettyPrint),body:!!(e!=null&&e.responseBody)})),e!=null&&e.testResults&&(r.push(""),r.push(""),r.push(...xi(e.testResults))),e!=null&&e.timings&&t.timings&&(r.push(""),r.push(""),r.push(...Ri(t.timings))),e!=null&&e.meta&&t.meta&&(r.push(""),r.push(""),r.push(...vi(t.meta))),Ar(r)}function hi(t,e){let r=[];if(r.push(`\`${t.protocol} ${t.statusCode}${t.statusMessage?` - ${t.statusMessage}`:""}\``),t.headers&&r.push(...hs(t.headers)),e!=null&&e.body&&m(t.body)){r.push(""),r.push(`\`\`\`${yi(t.contentType)}`);let o=e.prettyPrint&&t.prettyPrintBody?t.prettyPrintBody:t.body;r.push(Ar(Pe(o))),r.push("```")}return r}function yi(t){return Ut(t)?"json":Xe(t)?"xml":Ko(t)?"html":Go(t)?"js":Wo(t)?"css":Gt(t)?"markdown":""}function bi(t,e){let r=[];return r.push(`\`${t.method} ${t.url}\``),t.headers&&r.push(...hs(t.headers)),e!=null&&e.body&&m(t.body)&&(r.push(""),r.push("```json"),r.push(Ar(Pe(t.body))),r.push("```")),r}function xi(t){let e=[];e.push("`TestResults`"),e.push("");for(let r of t){let o=`${ne.ok}: ${r.message}`;r.status==="SKIPPED"?o=`${ne.skipped}: ${r.message}`:["FAILED","ERROR"].includes(r.status)&&(o=`${ne.error}: ${r.message}`,r.error&&(o+=` (${r.error.displayMessage})`)),e.push(o)}return e}function hs(t){return Object.entries(t).map(([e,r])=>{let o=r||"";return r&&(Array.isArray(r)?o=r.join(", "):m(r)||(o=k(r))),`*${e}*: ${o}`}).sort()}function vi(t){let e=[];e.push("`Meta`"),e.push("");for(let[r,o]of Object.entries(t))Array.isArray(o)?o.length>0&&e.push(`*${r}*: ${o.join(",")}`):e.push(`*${r}*: ${o}`);return e}function Ri(t){let e=[];return e.push("`Timings`"),e.push(""),t.wait&&e.push(`*Wait*: ${t.wait} ms`),t.dns&&e.push(`*DNS*: ${t.dns} ms`),t.tcp&&e.push(`*TCP*: ${t.tcp} ms`),t.tls&&e.push(`*TLS*: ${t.tls} ms`),t.request&&e.push(`*Request*: ${t.request} ms`),t.firstByte&&e.push(`*First Byte*: ${t.firstByte} ms`),t.download&&e.push(`*Download*: ${t.download} ms`),t.total&&e.push(`*Total*: ${t.total} ms`),e}function Ar(t){return t.join(`  ${g.EOL}`)}function Lr(t){let e=t;return!!(e!=null&&e.accessToken)}function ve(t){let e=t;return!!(e!=null&&e.httpRegion)&&!!(e!=null&&e.httpFile)&&!!(e!=null&&e.variables)&&!!(e!=null&&e.config)}var Jt=/\{{2}\s*(.+?)\s*\}{2}/gu,st=/^\s*#{3,}(?<title>.*)$/u,bs=/^\s*(?<type>openid|oauth2)(\s+(?<flow>client(_credentials)?|(authorization_)?code|device(_code)?|password|implicit|hybrid))?(\s+(?<variablePrefix>[^\s]*))?\s*((token_exchange)\s+(?<tokenExchangePrefix>[^\s]*))?\s*$/iu;async function wt(t,e,r){let o={parseResults:[]},s=t.next();for(;!s.done;){let n=!1;for(let i of e){let a=await i(s.value,r);if(a){o.parseResults.push(a),n=!0;break}}if(!n)break;o.nextLine=s.value.line,s=t.next()}return o}function Pt(t){return async function(r){var s;let o=/^\s*(?<key>[!#$%&'*+\-.^_`|~0-9A-Za-z]+)\s*:\s*(?<value>.*?),?\s*$/u.exec(r.textLine);if((s=o==null?void 0:o.groups)!=null&&s.key){let n=o.groups.key,i=o.groups.value,a=t[n];a?Array.isArray(a)?a.push(i):t[n]=[a,i]:t[n]=i;let l=r.textLine.indexOf(i);return{symbols:[new v({name:n,description:i,kind:"requestHeader",startLine:r.line,startOffset:r.textLine.indexOf(n),endLine:r.line,endOffset:r.textLine.length,children:[new v({name:n,description:"request header key",kind:"key",startLine:r.line,startOffset:r.textLine.indexOf(n),endLine:r.line,endOffset:r.textLine.indexOf(n)+n.length}),i?new v({name:i,description:"request header value",kind:"value",startLine:r.line,startOffset:l,endLine:r.line,endOffset:l+i.length,children:Ce(i,r.line,l)}):void 0].filter(d=>!!d)})]}}return!1}}function Xt(t=(e,r)=>{r.request&&(r.request.headers?Object.assign(r.request.headers,e):r.request.headers=e)}){return async function(r,o){var n;let s=/^\s*\.{3}(?<variableName>[^\s]+),?\s*$/u.exec(r.textLine);if((n=s==null?void 0:s.groups)!=null&&n.variableName){let i=new ys(s.groups.variableName,t);o.httpRegion.hooks.execute.addObjHook(l=>l.process,i);let a=r.textLine.trim();return{symbols:[new v({name:a||"hader variable",description:"Header Variable",kind:"requestHeader",startLine:r.line,startOffset:r.textLine.indexOf(a),endOffset:r.textLine.length,endLine:r.line,children:[new v({name:s.groups.variableName,description:"Header Variable",kind:"variable",startLine:r.line,startOffset:s.index,endOffset:s.groups.variableName.length,endLine:r.line})]})]}}return!1}}var ys=class{constructor(e,r){this.data=e;this.setHeaders=r;this.id="defaultHeaders"}async process(e){if(this.data&&e.variables){x(e,"set request headers");let r=await H.evalExpression(this.data,e);r&&this.setHeaders(Object.assign({},r),e)}return!0}};function xs(t){return async function(r){if(/^\s*(\/)[^*]*$/u.test(r.textLine)){let o=r.textLine.trim();return t(o),{symbols:[new v({name:o||"URL Part",description:"URL Part",kind:"url",startLine:r.line,startOffset:r.textLine.indexOf(o),endOffset:r.textLine.length,endLine:r.line,children:Ce(r.textLine,r.line)})]}}return!1}}function vs(t){return async function(r){if(/^\s*(\?|&)((([^(=?&)]+)=(.*))|\{\{.*\}\})\s*$/u.test(r.textLine)){let o=r.textLine.trim();return t(o),{symbols:[new v({name:o||"Query",description:"Query",kind:"url",startLine:r.line,startOffset:r.textLine.indexOf(o),endOffset:r.textLine.length,endLine:r.line,children:Ce(r.textLine,r.line,0)})]}}return!1}}async function nt(t,e,r=/^\s*((#\s+)|(\/{2}))/u){var o;if(r.test(t.textLine)){let s={symbols:[new v({name:"comment",description:t.textLine,kind:"metaData",startLine:t.line,startOffset:0,endLine:t.line,endOffset:t.textLine.length})]},n=/^\s*(#+|\/{2,})\s+@(?<key>[^\s]*)(\s+)?"?(?<value>.*)?"?$/u.exec(t.textLine);if(n&&n.groups&&n.groups.key){let i=n.groups.key.replace(/-./gu,l=>l[1].toUpperCase());s.symbols[0].children=[new v({name:i||"metadata",description:n.groups.value||"-",kind:"metaData",startLine:t.line,startOffset:0,endLine:t.line,endOffset:t.textLine.length,children:[new v({name:i||"metadata key",description:((o=ki.find(l=>l.name===i))==null?void 0:o.description)||"key of meta data",kind:"key",startLine:t.line,startOffset:t.textLine.indexOf(n.groups.key),endLine:t.line,endOffset:t.textLine.indexOf(n.groups.key)+n.groups.key.length})]})];let a;n.groups.value&&(a=n.groups.value.trim(),s.symbols[0].children.push(new v({name:n.groups.value||"metadata value",description:"value of meta data",kind:"value",startLine:t.line,startOffset:t.textLine.indexOf(n.groups.value),endLine:t.line,endOffset:t.textLine.indexOf(n.groups.value)+n.groups.value.length}))),e.httpRegion.metaData=Object.assign(e.httpRegion.metaData||{},{[i]:a||!0}),await e.httpFile.hooks.parseMetaData.trigger(i,a,e)}return s}return!1}var ki=[{name:"name",description:"responses of a requests with a name are automatically added as variables and can be reused by other requests",completions:["${1}"]},{name:"debug",description:"enable debug log level"},{name:"description",description:"additional description of region",completions:["${1}"]},{name:"disabled",description:"requests can be disabled"},{name:"extension",description:"extension of file for save or openWith.",completions:["${1}"]},{name:"forceRef",description:"When the request is called, it is ensured that the referenced request is always called beforehand",completions:["${1}"]},{name:"import",description:"reference Requests from other files.",completions:["${1}"]},{name:"injectVariables",description:"Inject Variables in request body (needed because of compatibility with Intellij)."},{name:"jwt",description:"supports auto decode of jwt token."},{name:"language",description:"language id of the response view",completions:["${1}"]},{name:"loop",description:"allows multiple Invocations of a Request with different parameters.",completions:["for ${1} of ${2}","for ${1}","while ${1}"]},{name:"keepStreaming",description:"keep streaming until the user session is ended manually"},{name:"noLog",description:"prevent logging of request data in output console"},{name:"noCookieJar",description:"cookieJar support is disabled for this request"},{name:"noClientCert",description:"SSL client certificate is not send for this request"},{name:"noProxy",description:"disable proxy for this request"},{name:"noRejectUnauthorized",description:"all invalid SSL certificates will be ignored and no error will be thrown."},{name:"noResponseView",description:"prevent output in editor document."},{name:"noStreamingLog",description:"prevent logging of streaming request data in output console"},{name:"note",description:"shows a confirmation dialog before sending request",completions:["${1}"]},{name:"openWith",description:"viewType of custom editor to preview files",completions:["${1}"]},{name:"ref",description:"When the request is called, it is ensured that the referenced request is called beforehand",completions:["${1}"]},{name:"ratelimit",description:"allows throttling requests",completions:["minIdleTime ${1}","max ${1} expire ${2}","minIdleTime ${1} max ${2} expire ${3}"]},{name:"save",description:"If specified, the response will not be displayed but saved directly."},{name:"sleep",description:"wait specified milliseconds, before next step.",completions:["${1}"]},{name:"title",description:"additional title of region",completions:["${1}"]},{name:"timeout",description:"set timeout for request",completions:["${1}"]},{name:"verbose",description:"enable trace log level"}],Pp=100;async function K(t,e){if(!m(t))return t;let r,o,s=t,n=0;for(;o!==s&&n++<Pp;)for(o=s;(r=Jt.exec(o))!==null;){let[i,a]=r,l=await e(a,i);if(typeof l<"u"&&i===t)return l;let d=l===null?"null":b(l);typeof d<"u"&&(s=s.replace(i,()=>d))}return s}function Ce(t,e,r=0){let o=[];if(t){let s;for(;(s=Jt.exec(t))!==null;){let[n,i]=s;o.push(new v({name:i||"variable",description:i,startLine:e,endLine:e,kind:"variable",startOffset:r+s.index,endOffset:r+s.index+n.length,source:i}))}}return o}async function de(t,e,r){var n,i;let o=t(),s=o.next();if(!s.done){if(e.data.httpResponseSymbol){let l=e.data.httpResponseSymbol;return l.body.push(s.value.textLine),l.symbol.endLine=s.value.line,l.symbol.endOffset=s.value.textLine.length,{nextParserLine:s.value.line,symbols:[]}}let a=r.exec(s.value.textLine);if(a&&((n=a.groups)!=null&&n.statusCode)){let l={};e.httpRegion.response={protocol:`HTTP/${a.groups.httpVersion||"1.1"}`,httpVersion:a.groups.httpVersion,statusCode:+a.groups.statusCode,statusMessage:a.groups.statusMessage,headers:l};let d=new v({name:"response",description:"response",kind:"response",startLine:s.value.line,startOffset:0,endLine:s.value.line,endOffset:s.value.textLine.length,children:[]});e.data.httpResponseSymbol={symbol:d,body:[]};let u=[e.data.httpResponseSymbol.symbol],c={nextParserLine:s.value.line,symbols:u},h=await wt(o,[Pt(l)],e);c.nextParserLine=h.nextLine||c.nextParserLine;for(let R of h.parseResults)for(let w of R.symbols)(i=d.children)==null||i.push(w),d.endLine=w.endLine,d.endOffset=w.endOffset;return c}}return!1}function Yt(t){let e=/^<(?:(?<injectVariables>@)(?<encoding>\w+)?)?\s+(?<fileName>.+?)\s*$/u.exec(t);if(e&&e.length===4&&e.groups)return{fileName:e.groups.fileName.trim(),injectVariables:!!e.groups.injectVariables,encoding:Rt(e.groups.encoding)}}function ue(t){return async function(r,o){var i,a,l;let s=r(),n=s.next();if(!n.done&&Hp(n.value,o,t)){if(o.httpRegion.request)return{endRegionLine:n.value.line-1,nextParserLine:n.value.line-1,symbols:[]};let d=Sp(n.value,t);if(!d)return!1;o.httpRegion.request=d.request;let u=new v({name:n.value.textLine||"request line",description:`${t.protocol} request-line`,kind:"requestLine",startLine:n.value.line,startOffset:0,endLine:n.value.line,endOffset:n.value.textLine.length,children:[d.symbol]}),c={nextParserLine:n.value.line,symbols:[u]},h={};d.request.headers=h;let R=await wt(s,[nt,Pt(h),Xt(),vs(w=>d.request.url+=w),xs(w=>d.request.url+=w)],o);c.nextParserLine=R.nextLine||c.nextParserLine;for(let w of R.parseResults)(a=(i=c.symbols)==null?void 0:i.push)==null||a.call(i,...w.symbols);if((l=t.modifyRequest)==null||l.call(t,d.request),d.request.headers){let w=E(d.request.headers,"content-type");m(w)&&(d.request.contentType=Nt(w))}return o.httpRegion.hooks.execute.addHook(t.protocol.toLowerCase(),cs(t.requestClientFactory,t.sessionStore)),c}return!1}}function Sp(t,e){var s,n,i,a;let r=e.methodRegex.exec(t.textLine);if(r&&r.length>1&&r.groups)return{request:{url:r.groups.url,protocol:e.protocol.toUpperCase(),method:((s=r.groups)==null?void 0:s.method)||e.method||e.protocol},symbol:new v({name:r.groups.url||"request",description:`${e.protocol} Url`,kind:"url",startLine:t.line,startOffset:0,endLine:t.line,endOffset:t.textLine.length,children:Ce(t.textLine,t.line)})};let o=(n=e.protocolRegex)==null?void 0:n.exec(t.textLine);if(o&&o.length>1&&((i=o.groups)!=null&&i.url))return{request:{url:o.groups.url,protocol:e.protocol.toUpperCase(),method:((a=o.groups)==null?void 0:a.method)||e.method||e.protocol},symbol:new v({name:o.groups.url||"request",description:`${e.protocol} Url`,kind:"url",startLine:t.line,startOffset:0,endLine:t.line,endOffset:t.textLine.length,children:Ce(t.textLine,t.line)})}}function Hp(t,e,r){var o,s,n,i;return ze(t.textLine)||e.forceRegionDelimiter&&e.httpRegion.request?!1:(s=(o=r.methodRegex.exec(t.textLine))==null?void 0:o.groups)!=null&&s.url?!0:!e.httpRegion.request&&r.protocolRegex?!!((i=(n=r.protocolRegex.exec(t.textLine))==null?void 0:n.groups)!=null&&i.url):!1}function Rs(t){let e=t;return!!(e!=null&&e.httpRegion)}function ks(t){let e=t;return Array.isArray(e==null?void 0:e.httpRegions)}function Ct(t,e){let r=e.httpFile.findHttpRegion(t);if(r)return r;if(e.options.httpFiles)for(let{ref:o}of e.options.httpFiles.filter(s=>s.base===e.httpFile)){let s=o.findHttpRegion(t);if(s)return s}}async function Zt(t,e,r){var s,n;let o=await le(t,r,async i=>{p.debug(`parse imported file ${i}`),r.options.httpFiles||(r.options.httpFiles=[]);let a=r.options.httpFiles.filter(d=>d.ref.fileName===i);if(a.length>0){let d=a[0].ref;return a.some(u=>u.base===r.httpFile)||r.options.httpFiles.push({base:r.httpFile,ref:d}),d}let l=await e.getOrCreate(i,async()=>await g.readFile(i,"utf-8"),0,{workingDir:r.httpFile.rootDir,config:r.config});return r.hooks=zt(r.hooks,l),r.options.httpFiles.push({base:r.httpFile,ref:l}),l});if(o&&(!r.options.globalScriptsExecuted||((n=(s=r.options.globalScriptsExecuted).indexOf)==null?void 0:n.call(s,o))<0)){r.options.globalScriptsExecuted||(r.options.globalScriptsExecuted=[]),p.debug(`execute global scripts for import ${o.fileName}`),r.options.globalScriptsExecuted.push(o);let i={...r,httpFile:o};return await kt(i)}return!!o}function St(t){let e=t;return e&&!!e.then}function Se(t){return new Promise(e=>setTimeout(e,t))}async function ws(t,...e){let r=[],o=async()=>{let n;for(;n=e.shift();)r.push(await n())},s=[];for(let n=0;n<t;n++)s.push(o());return await Promise.all(s),r}var wi=T(require("dayjs")),Pi=require("uuid"),er={alphabetic:(t=10)=>He(t,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),numeric:(t=10)=>He(t),hexadecimal:(t=10)=>He(t,"1234567890ABCDEF"),email:Or,float:(t=0,e=100)=>Math.random()*(e-t)+t,integer:(t=0,e=100)=>Math.floor(Math.random()*(e-t)+t),uuid:()=>(0,Pi.v4)(),date:(t=new Date,e=void 0)=>(0,wi.default)(t).format(e)};function Or(){return`${He(30)}@${He(10)}.${Ps(["com","org","at","de","fr","uk","it","ch","info","edu","asia","gov","app","io"])}`}function He(t,e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_"){let r=[];if(t>0){let o=e.split("");for(let s=0;s<t;s++)r.push(Ps(o))}return r.join("")}function Ps(t){return t[Math.floor(Math.random()*(t.length-1))]}function Cs({httpRegion:t}){return async function(r,o){let s={message:r,status:"SUCCESS"};if(typeof o=="function")try{await o(s)}catch(n){Ci(s,n)}je(t,s)}}function Ci(t,e){t.status="FAILED",ce(e)?t.error=Wt(e):t.error={displayMessage:`${e}`,error:new Error(`${e}`)}}function tr({httpRegion:t,variables:e}){let r=function(n,i){let a={message:n,status:"SUCCESS"};if(typeof i=="function")try{i()}catch(l){Ci(a,l)}je(t,a)};function o(){return xt(e.response)?e.response:t.response}return r.status=s=>{let n=o();n&&r(`response status equals to ${s}`,()=>es(n,s))},r.totalTime=s=>{let n=o();n&&r(`total time exceeded ${s}`,()=>ts(n,s))},r.header=(s,n)=>{let i=o();i&&r(`response header ${s} equals ${n}`,()=>rs(i,s,n))},r.headerContains=(s,n)=>{let i=o();i&&r(`response header ${s} contains ${n}`,()=>os(i,s,n))},r.responseBody=s=>{let n=o();n&&r(`response body equals ${s}`,()=>is(n,s))},r.hasResponseBody=()=>{let s=o();s&&r("response body exists",()=>ss(s))},r.hasNoResponseBody=()=>{let s=o();s&&r("response body does not exists",()=>ns(s))},r}function je(t,e){t.testResults||(t.testResults=[]),t.testResults.push(e)}function qe(t,e="request is skipped"){je(t,{message:e,status:"SKIPPED"})}var it=require("fs"),Si=require("os"),Fe=require("path");async function Ss(){Hi(),await Ap(),qp()}function qp(){process.platform==="win32"&&(ne.ok="[x]",ne.error="[-]",ne.skipped="[*]")}function Hi(){g.EOL=Si.EOL,g.isAbsolute=async t=>(0,Fe.isAbsolute)(g.toString(t)),g.dirname=t=>(0,Fe.dirname)(g.toString(t)),g.hasExtension=(t,...e)=>{let r=(0,Fe.extname)(g.toString(t));return r.startsWith(".")&&(r=r.slice(1)),e.indexOf(r)>=0},g.joinPath=(t,e)=>(0,Fe.join)(g.toString(t),e),g.exists=async t=>{try{return!!await it.promises.stat(g.toString(t))}catch{return!1}},g.readFile=async(t,e)=>{let r=g.fsPath(t);if(r)return it.promises.readFile(r,e);throw new Error("No valid path for cli")},g.readBuffer=async t=>{let e=g.fsPath(t);if(e){let r=(0,it.createReadStream)(e);return Tp(r)}throw new Error("No valid path for cli")},g.writeBuffer=(t,e)=>it.promises.writeFile(g.toString(t),e),g.readdir=async t=>it.promises.readdir(g.toString(t))}function Tp(t){return new Promise((e,r)=>{let o=[];t.on("data",s=>{Buffer.isBuffer(s)?o.push(s):o.push(Buffer.from(s))}),t.on("end",()=>e(Buffer.concat(o))),t.on("error",s=>r(s)),t.resume()})}async function Ap(){let t=(await import("inquirer")).default;q.showNote=async function(r){return(await t.prompt([{type:"confirm",name:"note",message:r}])).note},q.showInputPrompt=async function(r,o,s){return s?(await t.prompt([{type:"password",name:"placeholder",message:r,mask:"*",default:o}])).placeholder:(await t.prompt([{type:"input",name:"placeholder",message:r,default:o}])).placeholder},q.showListPrompt=async function(r,o){return(await t.prompt([{type:"list",name:"placeholder",message:r,choices:o}])).placeholder},q.getClipboard=async function(){try{return await(await import("clipboardy")).default.read()}catch(r){return p.warn(r),""}},q.setClipboard=async function(r){try{await(await import("clipboardy")).default.write(r)}catch(o){p.warn(o)}}}var Pu=require("commander");var Oi=require("assert");var Er=class{constructor(){this.id=["endsWith"]}match(e,r){let o=b(e),s=b(r);return o&&s?o==null?void 0:o.endsWith(s):!1}};var $r=class{constructor(){this.id=["==","===","equals"]}match(e,r){return typeof e=="object"?k(e)===k(r):e===r}};var Ir=class{constructor(){this.id=["exists","isTrue"]}match(e){return!!e}};var Dr=class{constructor(){this.id=[">="]}match(e,r){let o=S(e),s=S(r);return o!==void 0&&s!==void 0?o>=s:!1}};var Mr=class{constructor(){this.id=[">"]}match(e,r){let o=S(e),s=S(r);return o!==void 0&&s!==void 0?o>s:!1}};var _r=class{constructor(){this.id=["contains","includes"]}match(e,r){let o=b(e),s=b(r);return o&&s?o.includes(s):Array.isArray(e)?e.indexOf(r)>=0:!1}};var jr=class{constructor(){this.id=["isArray"]}match(e){return Array.isArray(e)}};var Fr=class{constructor(){this.id=["isBoolean"]}match(e){return typeof e=="boolean"}};var Vr=class{constructor(){this.id=["isFalse"]}match(e){return!e}};var Br=class{constructor(){this.id=["isNumber"]}match(e){return typeof e=="number"}};var Nr=class{constructor(){this.id=["isString"]}match(e){return typeof e=="string"}};var Ur=class{constructor(){this.id=["<="]}match(e,r){let o=S(e),s=S(r);return o!==void 0&&s!==void 0?o<=s:!1}};var Gr=class{constructor(){this.id=["<"]}match(e,r){let o=S(e),s=S(r);return o!==void 0&&s!==void 0?o<s:!1}};var Kr=class{constructor(){this.id=["matches"];this.noAutoConvert=!0}match(e,r){let o=b(e),s=b(r);return o&&s?new RegExp(s,"u").test(o):!1}};var qi=require("crypto");var Wr=class{constructor(){this.id=["md5"];this.noAutoConvert=!0}match(e,r){let o=ae(e);return o?(0,qi.createHash)("md5").update(o).digest("base64")===r:!1}};var Qr=class{constructor(){this.id=["!=","!==","not equals"]}match(e,r){return e!==r}};var Ti=require("crypto");var zr=class{constructor(){this.id=["sha256"];this.noAutoConvert=!0}match(e,r){let o=ae(e);return o?(0,Ti.createHash)("sha256").update(o).digest("base64")===r:!1}};var Ai=require("crypto");var Jr=class{constructor(){this.id=["sha512"];this.noAutoConvert=!0}match(e,r){let o=ae(e);return o?(0,Ai.createHash)("sha512").update(o).digest("base64")===r:!1}};var Xr=class{constructor(){this.id=["startsWith"]}match(e,r){let o=b(e),s=b(r);return o&&s?o==null?void 0:o.startsWith(s):!1}};var Li=[new Er,new $r,new Ir,new Dr,new Mr,new _r,new jr,new Fr,new Br,new Nr,new Ur,new Gr,new Kr,new Qr,new Xr,new zr,new Wr,new Jr,new Vr];async function Ei(t,{httpRegion:e}){let o=t().next();if(!o.done&&o.value.textLine){let s=o.value.textLine,i=`^\\s*\\?\\?\\s*(?<type>[^\\s]*)(\\s+(?<value>.*))?\\s+(?<predicate>(${Li.reduce((l,d)=>(l.push(...d.id),l),[]).join("|")}))\\s*(?<expected>.*)\\s*$`,a=new RegExp(i,"iu").exec(s);if(a&&a.groups&&a.groups.type&&a.groups.predicate){let l=a.groups.type,d=a.groups.value,u=a.groups.expected,c=Li.find(h=>{var R;return((R=a.groups)==null?void 0:R.predicate)&&h.id.indexOf(a.groups.predicate)>=0});return c&&e.hooks.onResponse.addHook(`test ${s}`,async(h,R)=>{await Cs(R)(`${d||l} ${c.id[0]} ${u||""}`.trim(),async $=>{let Q=await R.httpFile.hooks.provideAssertValue.trigger(l,d,h,R),C=u&&await M(u,"Variable",R);C!==u&&($.message=`${d||l} ${c.id[0]} ${C}`);let y=c.noAutoConvert?C:Op(Q,C);(0,Oi.ok)(c.match(Q,y),`${d||l} (${Q}) ${c.id[0]} ${b(y)||""}`.trim())})}),{nextParserLine:o.value.line,symbols:[new v({name:`assert ${a.groups.type}`,description:`${a.groups.predicate} ${a.groups.expected||""}`.trim(),kind:"script",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length})]}}}return!1}function Op(t,e){if(e!=null){if(typeof t=="number")return S(e);if(typeof t=="boolean")return G(e,!!e);if(typeof t=="string")return b(e);if(t===null&&e==="null")return null;if(t===void 0&&e==="undefined")return;if(typeof t=="object"&&typeof e=="string")try{return JSON.parse(e)}catch{return e}}return e}I.emptyLineProvider.push(()=>[{name:"?? status == ",description:"Status assert (200)"},{name:"?? status == 200",description:"Status assert (200)"},{name:"?? duration <",description:"Duration assert"},{name:"?? body contains",description:"Body assert"},{name:"?? body matches",description:"Body assert"},{name:"?? body md5",description:"Body assert"},{name:"?? body sh256",description:"Body assert"},{name:"?? header",description:"Header assert"}]);function $i(t,e,r){var o,s,n,i,a,l,d;if(t==="duration")switch(e){case"firstByte":return(o=r==null?void 0:r.timings)==null?void 0:o.firstByte;case"download":return(s=r==null?void 0:r.timings)==null?void 0:s.download;case"wait":return(n=r==null?void 0:r.timings)==null?void 0:n.wait;case"request":return(i=r==null?void 0:r.timings)==null?void 0:i.request;case"tcp":return(a=r==null?void 0:r.timings)==null?void 0:a.tcp;case"tls":return(l=r==null?void 0:r.timings)==null?void 0:l.tls;default:return(d=r==null?void 0:r.timings)==null?void 0:d.total}return!1}function Ii(t,e,r){return t==="header"&&e?E(r.headers,e):!1}async function Di(t,e,r,o){return t==="js"&&e?await H.evalExpression(e,o,{response:r}):t==="body"?e?await H.evalExpression(`(response.parsedBody || response.body).${e}`,o,{response:r}):r.body:!1}function Mi(t,e,r){return t==="status"?r==null?void 0:r.statusCode:!1}var Yr=class{constructor(){this.id="testFailed";this.before=["processedHttpRegion"]}async onError(e,r){if(ce(e)){let{httpRegion:o}=r.args[0];je(o,{message:e.message,error:Wt(e),status:"ERROR"})}return!0}};function _i(t){t.hooks.execute.addInterceptor(new Yr),t.hooks.provideAssertValue.addHook("status",Mi,{before:["request"]}),t.hooks.provideAssertValue.addHook("header",Ii,{before:["request"]}),t.hooks.provideAssertValue.addHook("javascript",Di,{before:["request"]}),t.hooks.provideAssertValue.addHook("duration",$i,{before:["request"]}),t.hooks.parse.addHook("assert",Ei,{before:["request"]})}I.variableProvider.push(()=>[{name:"$prompt ",description:"Prompt"},{name:"$input",description:"Input"},{name:"$input-askonce",description:"Input"},{name:"$password",description:"Password"},{name:"$pick <placeholder> $value:",description:"Password"},{name:"$pick-askonce <placeholder> $value:",description:"Password"},{name:"$timestamp",description:"Timestamp"},{name:"$datetime",description:"Datetime"},{name:"$localDatetime",description:"Local Datetime"}]);var ji="$default",Fi="$shared";async function Vi(t){var e;if((e=t.config)!=null&&e.environments){let r=Object.keys(t.config.environments).filter(o=>[ji,Fi].indexOf(o)<0);return p.info("Config Env Provider found environments",r),r}return[]}async function Bi(t,e){var o;let r=[];if((o=e.config)!=null&&o.environments){let s=e.config.environments;r.push(s[Fi]),t&&t.length>0?r.push(...t.map(n=>s[n])):r.push(s[ji])}return Object.assign({},...r)}var As={};gt(As,{HttpFile:()=>rr,HttpFileStore:()=>at,HttpRegion:()=>qt,UserSessionStore:()=>eo,closeHttpRegion:()=>Zr,createReaderFactory:()=>Hs,getEnvironmentConfig:()=>Ht,parseHttpFile:()=>Ts,pluginStore:()=>W,setSource:()=>qs,userSessionStore:()=>P});var Ni=T(require("chalk")),Ui=T(require("lodash/merge"));async function Ht(t,e){let r=[];if(e){let s=await ds(e.fileName,e.rootDir);s&&r.push(s)}t&&r.push(t);let o=(0,Ui.default)({log:{level:5,supportAnsiColors:!0},cookieJarEnabled:!0,envDirName:"env"},...r);return Ep(o),o}function Ep(t){var e,r,o;typeof((e=t==null?void 0:t.log)==null?void 0:e.level)>"u"?p.options.level=5:p.options.level=(r=t==null?void 0:t.log)==null?void 0:r.level,((o=t==null?void 0:t.log)==null?void 0:o.supportAnsiColors)===!1&&(Ni.default.level=0)}var rr=class{constructor(e,r){this.fileName=e;this.rootDir=r;this.hooks={parse:new $t,parseMetaData:new It,parseEndRegion:new Mt,provideAssertValue:new Dt,replaceVariable:new Ft,provideEnvironments:new jt,provideVariables:new _t,execute:new Qe,onStreaming:new Ke,onRequest:new Ue,onResponse:new Ge,responseLogging:new We};this.httpRegions=[]}findHttpRegion(e){return this.httpRegions.find(r=>{var o;return((o=r.metaData)==null?void 0:o.name)===e&&!r.metaData.disabled})}get globalHttpRegions(){return this.httpRegions.filter(e=>e.isGlobal()&&!e.metaData.disabled)}};var Qi=require("hookpoint");async function Zr(t){await t.httpFile.hooks.parseEndRegion.trigger(t);let{httpRegion:e}=t;t.httpRegion.symbol.name=Qt(e),t.httpRegion.symbol.description=fs(e),t.httpFile.httpRegions.push(t.httpRegion),delete t.forceRegionDelimiter}function Hs(t,e){return function*(o){for(let s=t;s<e.length;s++){let n=e[s];if(yield{textLine:n,line:s},!o&&st.test(n))break}}}var Wi=require("hookpoint");var Gi=require("hookpoint");var qt=class t{constructor(e,r=0){this.httpFile=e;this.variablesPerEnv={};this.metaData={};this.hooks={execute:new Qe,onRequest:new Ue,onStreaming:new Ke,onResponse:new Ge,responseLogging:new We};this.dependentsPerEnv=[];this.symbol=new v({name:"-",description:"-",kind:"request",startLine:r,startOffset:0,endLine:r,endOffset:0})}get id(){return`${this.httpFile.fileName}_${this.symbol.startLine}`}isGlobal(){return!(this.request||this.metaData.name)}clone(e){let r=new t(e||this.httpFile);return r.request=this.request,Object.assign(r.symbol,this.symbol),Object.assign(r.hooks,this.hooks),Object.assign(r.variablesPerEnv,this.variablesPerEnv),Object.assign(r.metaData,this.metaData),r}async execute(e,r){var s,n,i;delete this.response,this.testResults=[],e.httpRegion&&this.registerRegionDependent(e.httpRegion),(n=(s=e.progress)==null?void 0:s.report)==null||n.call(s,{message:`${this.symbol.name}`});let o=this.hooks.execute;if(!this.isGlobal()){o=this.httpFile.hooks.execute.merge(o);for(let a of this.httpFile.httpRegions.filter(l=>l.isGlobal()))a instanceof t&&a.registerRegionDependent(this)}try{let a=await o.trigger({...e,httpFile:this.httpFile,httpRegion:this,hooks:zt(this.hooks,this.httpFile),isMainContext:r});return this.isGlobal()||this.resetDependentRegionsWithVisitor(J(e.activeEnvironment),this,[]),a!==Gi.HookCancel&&a.every(l=>!!l)}catch(a){return ce(a)&&(a.handled||(await((i=e.logResponse)==null?void 0:i.call(e,this.response,this)),a.handled=!0)),!1}}resetDependentRegionsWithVisitor(e,r,o){let s=r.dependentsPerEnv.filter(n=>!o.includes(n));for(let n of s)delete n.response,delete n.variablesPerEnv[e],o.push(n),n instanceof t&&this.resetDependentRegionsWithVisitor(e,n,o)}registerRegionDependent(e){e&&!this.dependentsPerEnv.includes(e)&&e!==this&&this.dependentsPerEnv.push(e)}};function qs(t,e){for(let r of t)Ki(r.symbol,e)}function Ki(t,e){t.source=F(e.slice(t.startLine,t.endLine+1));let r=t.endOffset-e[t.endLine].length;if(r>=0&&(r=void 0),t.source=t.source.slice(t.startOffset,r),t.children)for(let o of t.children)Ki(o,e)}async function Ts(t,e,r){let o=Pe(e),s={lines:o,httpFile:t,httpRegion:new qt(t,0),data:{},httpFileStore:r};for(let n=0;n<o.length;n++){let i=await t.hooks.parse.trigger(Hs(n,o),s);i&&i!==Wi.HookCancel&&(i.endRegionLine!==void 0&&i.endRegionLine>=0&&(s.httpRegion.symbol.endLine=i.endRegionLine,s.httpRegion.symbol.endOffset=o[i.endRegionLine].length,await Zr(s),s.httpRegion=new qt(t,i.nextParserLine+1)),i.symbols&&(s.httpRegion.symbol.children?s.httpRegion.symbol.children.push(...i.symbols):s.httpRegion.symbol.children=i.symbols),n=i.nextParserLine)}return await Zr(s),s.httpRegion.symbol.endLine=o.length-1,s.httpRegion.symbol.endOffset=o[o.length-1].length,qs(t.httpRegions,o),t}var W={};var at=class{constructor(e={}){this.plugins=e;this.storeCache=[]}getFromStore(e,r){let o=g.toString(e),s=this.storeCache.find(n=>n.cacheKey===o);return s||(s={cacheKey:o,version:r},this.storeCache.push(s)),s}get(e){var o;let r=g.toString(e);return(o=this.storeCache.find(s=>s.cacheKey===r))==null?void 0:o.httpFile}getAll(){let e=[];for(let r of this.storeCache)r.httpFile&&e.push(r.httpFile);return e}getOrCreate(e,r,o,s){let n=this.getFromStore(e,o);return o>n.version||!n.httpFile?(n.promise&&o<=n.version||(n.promise=r().then(i=>this.parse(e,i,s)).then(i=>{if(delete n.promise,n.httpFile)for(let a of i.httpRegions){let l=n.httpFile.httpRegions.find(d=>d.symbol.source===a.symbol.source);l&&Object.assign(a.variablesPerEnv,l.variablesPerEnv)}return n.version=o,n.httpFile=i,i}).catch(i=>{throw delete n.promise,n.httpFile&&this.remove(n.httpFile.fileName),i})),n.promise):n.promise||Promise.resolve(n.httpFile)}async parse(e,r,o){let s=await this.initHttpFile(e,o);return await Ts(s,r,this)}remove(e){let r=g.toString(e),o=this.storeCache.findIndex(s=>s.cacheKey===r);return o>=0?(this.storeCache.splice(o,1),!0):!1}rename(e,r){let o=g.toString(e),s=this.storeCache.find(n=>n.cacheKey===o);s&&(s.cacheKey=g.toString(r),s.httpFile&&(s.httpFile.fileName=r))}clear(){this.storeCache.length=0}async initHttpFile(e,r){var l,d;let o=await z(e,r.workingDir)||e,s=await kr(o,r.workingDir,...Cr)||await kr(o,r.workingDir,"package.json",((l=r.config)==null?void 0:l.envDirName)||"env")||r.workingDir,n=new rr(o,s);r.config=await Ht(r.config,n);let i={...W,...this.plugins};s&&(Object.assign(i,await us(s)),(d=r.config)!=null&&d.configureHooks&&(i[".httpyac.js"]=r.config.configureHooks));let a=process.env.HTTPYAC_PLUGIN;if(a)try{let u=require(a);u.configureHooks&&(i.HTTPYAC_PLUGIN=u.configureHooks)}catch(u){p.warn("Global Hook Plugin not loaded",u)}return await this.configureHooks(n,r,i),n}async configureHooks(e,r,o){if(r.config){let s={version:"1.0.0",rootDir:e.rootDir,config:r.config,httpFile:e,hooks:e.hooks,log:p,fileProvider:g,sessionStore:P,userInteractionProvider:q,httpClientProvider:oe,javascriptProvider:H,utils:f,getHookCancel:()=>Qi.HookCancel};for(let[n,i]of Object.entries(o))try{let a=i(s);St(a)&&await a}catch(a){p.error(`error in ${n}`,a)}}}};var eo=class{constructor(){this.userSessions=[];this.sessionChangedListener=[]}onSessionChanged(e){return this.sessionChangedListener.push(e),()=>{let r=this.sessionChangedListener.indexOf(e);r>=0&&this.sessionChangedListener.splice(r,1)}}async reset(){for(let e of this.userSessions)e.delete&&e.delete();this.userSessions.length=0,this.notifySessionChanged()}getUserSession(e){return this.userSessions.find(r=>r.id===e)}setUserSession(e){this.removeUserSession(e.id),this.userSessions.push(e),this.notifySessionChanged()}notifySessionChanged(){for(let e of this.sessionChangedListener)e()}removeUserSession(e){let r=this.userSessions.find(o=>o.id===e);r&&(this.userSessions.splice(this.userSessions.indexOf(r),1),r.delete&&r.delete(),this.notifySessionChanged())}isUserSession(e){let r=e;return r&&!!r.description&&!!r.id&&!!r.title&&!!r.type&&!!r.details}},P=new eo;async function zi(){let t=P.getUserSession("last_response");return t!=null&&t.response?{response:t.response}:{}}var Ji=T(require("lodash/cloneDeep"));var to=class{constructor(){this.id="createRequest"}async beforeLoop(e){let[r]=e.args;return r.httpRegion.request&&(x(r,"init request"),r.request=(0,Ji.default)(r.httpRegion.request)),!0}};var Xi=require("hookpoint");var Ip="variable",ro=class{constructor(){this.id="variable"}async beforeLoop(e){let r=e.args[0];return r.options.lazyVariables=!0,!0}async beforeTrigger(e){var o;let r=e.args[0];return((o=e.hookItem)==null?void 0:o.id)!==Ip&&r.options.lazyVariables&&(await this.replaceAllVariables(r),delete r.options.lazyVariables),!0}async replaceAllVariables(e){for(let[r,o]of Object.entries(e.variables)){let s=await M(o,"Variable",e);s!==Xi.HookCancel&&(e.variables[r]=s)}}};var oo=class{constructor(){this.id="logResponse"}async afterLoop(e){let r=e.args[0],o;return r.httpRegion.response&&(o=$e(r.httpRegion.response),o.tags||(o.tags=[]),o.tags.push("httpRegion",r.isMainContext?"mainResponse":"refResponse"),delete r.httpRegion.response),await se(o,r),!0}};var so=class{constructor(){this.id="processedHttpRegion"}getResponseLoggingInterceptor(){return{id:this.id,afterLoop:this.afterResponseLoggingLoop.bind(this)}}async beforeLoop(e){let[r]=e.args;if(r.processedHttpRegions){let o=this.toProcessedHttpRegion(r);r.processedHttpRegions.push(o)}return!0}async onError(e,r){return this.updateProcessedHttpRegionAfterLoop(r.args[0]),!0}async afterLoop(e){return this.updateProcessedHttpRegionAfterLoop(e.args[0]),!0}updateProcessedHttpRegionAfterLoop(e){var o,s;let r=(s=(o=e.processedHttpRegions)==null?void 0:o.slice().reverse())==null?void 0:s.find(n=>n.id===e.httpRegion.id);r&&(r.end=performance.now(),r.duration=r.end-r.start,r.metaData={...e.httpRegion.metaData},r.testResults=e.httpRegion.testResults)}async afterResponseLoggingLoop(e){var n;let[r,o]=e.args,s=(n=o.processedHttpRegions)==null?void 0:n.find(i=>i.id===o.httpRegion.id);return s&&(s.request=r.request,s.response=r),!0}toProcessedHttpRegion(e){return{id:e.httpRegion.id,filename:e.httpFile.fileName,symbol:e.httpRegion.symbol,isGlobal:e.httpRegion.isGlobal(),testResults:e.httpRegion.testResults,start:performance.now()}}};var no=class{constructor(){this.id="regionScopedVariables"}async beforeLoop(e){var s;let r=e.args[0],o=J(r.activeEnvironment);if((s=r.config)!=null&&s.useRegionScopedVariables){let n=r.options;n.variables=r.variables,r.variables=Object.assign({},r.variables,...r.httpFile.globalHttpRegions.map(i=>i.variablesPerEnv[o]))}else r.variables=Object.assign(r.variables,...r.httpFile.httpRegions.map(n=>n.variablesPerEnv[o]));return!0}async afterLoop(e){var o;let r=e.args[0];if((o=r.config)!=null&&o.useRegionScopedVariables){let s=r.options;if(s.variables){let n=r.variables;r.variables=s.variables,this.autoShareNewVariables(n,r)}}return!0}autoShareNewVariables(e,r){for(let[o,s]of Object.entries(e))r.variables[o]||(r.variables[o]=s)}};function Yi(t,e,r){return t==="disabled"?(e?typeof e=="string"&&r.httpRegion.hooks.execute.addHook("disabled",async o=>{let s=await H.evalExpression(e,o);return s&&qe(o.httpRegion),!s}):r.httpRegion.hooks.execute.addInterceptor({id:"disabled",async beforeLoop(o){o.bail=!0;let{httpRegion:s}=o.args[0];return qe(s),!0}}),!0):!1}function Zi(t,e,r){return t==="forceRegionDelimiter"&&(r.forceRegionDelimiter=!0),!1}function ea(t,e,r){return t==="import"&&e?(r.httpRegion.hooks.execute.addObjHook(o=>o.process,new Ls(e,r.httpFileStore)),!0):!1}var Ls=class{constructor(e,r){this.fileName=e;this.httpFileStore=r;this.id="import"}async process(e){return Zt(this.fileName,this.httpFileStore,e)}};function ta(t,e,r){return t==="jwt"?(r.httpRegion.hooks.onResponse.addHook("jwt",async o=>{let s=o.parsedBody||o.body;if(s&&typeof s=="object"){let n=Object.entries(s),i=n;e&&(i=n.filter(([d])=>e.indexOf(d)>=0));for(let[d,u]of i){let c=Mp(u);c&&n.push([`${d}_parsed`,c])}let a=Object.fromEntries(n),l=k(a,2);o.body=l,o.prettyPrintBody=l,o.parsedBody=a}}),!0):!1}function Mp(t){return m(t)?et(t):null}var ra=require("uuid");function oa(t,e,r){if(t==="keepStreaming"){let o=`keep_streaming_${(0,ra.v4)()}`;return r.httpRegion.hooks.onStreaming.addHook("keepStreaming",async s=>{s.request&&(x(s,"stream until manual cancellation"),await new Promise(n=>{s.requestClient&&s.requestClient.addEventListener("disconnect",()=>n(!0))}))}),r.httpRegion.hooks.onResponse.addHook("keepStreaming",()=>{P.removeUserSession(o)}),!0}return!1}var sa=require("hookpoint"),na=require("uuid");function ia(t,e,r){var o,s,n,i;if(t==="loop"&&e){let a=/^\s*for\s+(?<variable>.*)\s+of\s+(?<iterable>.*)\s*/u.exec(e);if((o=a==null?void 0:a.groups)!=null&&o.iterable&&((s=a==null?void 0:a.groups)!=null&&s.variable))return Os(r,{type:1,variable:a.groups.variable,iterable:a.groups.iterable}),!0;let l=/^\s*for\s*(?<counter>\d*)\s*$/u.exec(e);if((n=l==null?void 0:l.groups)!=null&&n.counter)return Os(r,{type:0,counter:Number.parseInt(l.groups.counter,10)}),!0;let d=/^\s*while\s*(?<expression>.*)\s*$/u.exec(e);if((i=d==null?void 0:d.groups)!=null&&i.expression)return Os(r,{type:2,expression:d.groups.expression}),!0}return!1}function Os(t,e){let r=new Es(e);t.httpRegion.hooks.execute.addInterceptor(r),t.httpRegion.hooks.execute.addObjHook(o=>o.process,r)}var Es=class{constructor(e){this.data=e;this.isInLoop=!1;this.id=`loop_${(0,na.v4)()}`}async beforeLoop(e){return this.hook=e.hook,this.isInLoop&&(e.index=e.hook.items.findIndex(r=>r.id===this.id)),!0}async process(e){if(this.hook&&!this.isInLoop){let r=[];try{this.isInLoop=!0;let o=this.iterate(e),s=await o.next();for(;!s.done;){x(e,`${s.value.index+1} loop pass`);let n={...e,httpRegion:this.createHttpRegionClone(e.httpRegion,s.value.index),variables:Object.assign(e.variables,s.value.variables)};if(await this.hook.trigger(n)===sa.HookCancel)return!1;r.push(n.variables.response),s=await o.next()}e.httpRegion.metaData.name&&r.length>0&&_({[`${e.httpRegion.metaData.name}`]:r[0],[`${e.httpRegion.metaData.name}List`]:r},e)}finally{this.isInLoop=!1}}return!0}async afterTrigger(e){var r;return!this.isInLoop&&((r=e.hookItem)==null?void 0:r.id)===this.id&&(e.bail=!0),!0}async*iterate(e){switch(this.data.type){case 1:yield*this.iterateForOfLoop(e);break;case 0:yield*this.iterateForLoop();break;case 2:yield*this.iterateWhileLoop(e);break;default:break}}async*iterateForOfLoop(e){if(this.data.variable&&this.data.iterable){let r=await H.evalExpression(this.data.iterable,e),o;if(Array.isArray(r)&&(o=r),o){let s=0;for(let n of o){let i={$index:s};i[this.data.variable]=n,yield{index:s,variables:i},s++}}}}async*iterateWhileLoop(e){if(this.data.expression){let r=0;for(;await H.evalExpression(this.data.expression,e);)yield{index:r,variables:{$index:r}},r++}}*iterateForLoop(){if(this.data.counter)for(let e=0;e<this.data.counter;e++)yield{index:e,variables:{$index:e}}}createHttpRegionClone(e,r){let o=e.clone();return o.metaData.name=e.metaData.name?`${e.metaData.name}${r}`:void 0,o}};function aa(t,e,r){return t==="noRedirect"?(r.httpRegion.hooks.onRequest.addHook("noRedirect",async o=>{o.noRedirect=!0}),!0):!1}function la(t,e,r){return t==="noRejectUnauthorized"?(r.httpRegion.hooks.onRequest.addHook("noRejectUnauthorized",async o=>{o.noRejectUnauthorized=!0}),!0):!1}function da(t,e,r){if(t==="note"){let o=e||`Are you sure you want to send the request ${Qt(r.httpRegion)}?`;return r.httpRegion.hooks.execute.addInterceptor({id:"note",beforeLoop:()=>q.showNote(o)}),!0}return!1}function ua(t,e,r){return t==="proxy"?(r.httpRegion.hooks.onRequest.addHook("proxy",async o=>{o.proxy=e}),!0):!1}function pa(t,e,{httpRegion:r}){if(t==="ratelimit"&&e){let o=/^\s*(slot(:)?\s*(?<slot>[^\s]+))?\s*(minIdleTime(:)?\s*(?<minIdleTime>\d*))?\s*(max(:)?\s*(?<max>\d*))\s*(expire(:)?\s*(?<expire>\d*))?\s*$/iu.exec(e);if(o!=null&&o.groups){let s=o.groups.slot||"rateLimit",n=o.groups.minIdleTime||"0",i=o.groups.max||"0",a=o.groups.expire||"0";r.hooks.execute.addHook("rateLimit",async l=>{let d=Fp(s,Number.parseInt(n,10),Number.parseInt(i,10),Number.parseInt(a,10));return d.requests.push(await _p(d,l)),!0})}}return!1}async function _p(t,e){for(;t.requests.length>0;){let r=new Date;if(Vp(t.requests,r,t.expire),t.max>0&&t.requests.length>=t.max){let o=t.requests[0],s=t.expire+o.getTime()-r.getTime();s>0&&(x(e,`rate limit max reached. wait for ${s}`),p.debug(`rate limit max reached. wait for ${s} (slot ${t.slot})`),await Se(s),p.debug("rate limit max waited"));continue}if(t.requests.length>0){let o=t.requests[t.requests.length-1];if(o&&t.minIdleTime>0){let s=o.getTime()+t.minIdleTime-r.getTime();if(s>0){x(e,`rate limit minIdleTime, wait for ${s}`),p.debug(`rate limit minIdleTime, wait for ${s} (slot ${t.slot})`),await Se(s),p.debug("rate limit minIdleTime waited");continue}}}return r}return new Date}function jp(t){let e=t;return!!(e!=null&&e.requests)&&e.type==="RateLimit"}function Fp(t,e,r,o){let s=`ratelimit_${t}`,n=P.getUserSession(s);if(jp(n))return n.max=r,n.minIdleTime=e,n.expire=o,n;let i=[];e>0&&i.push(`minIdleTime ${e}ms`),o>0&&i.push(`max ${r} with expire ${o}ms`);let a={id:s,type:"RateLimit",title:`rate limit slot ${t}`,details:{slot:t,minIdleTime:e,max:r,expire:o},description:i.join(", "),slot:t,minIdleTime:e,max:r,expire:o,requests:[]};return P.setUserSession(a),a}function Vp(t,e,r){if(r>0){let o=0;for(let s of t)if(e.getTime()-s.getTime()>=r)o++;else break;t.splice(0,o)}else t.splice(0,t.length-1)}function ma(t,e,r){return["ref","forceRef"].indexOf(t)>=0&&e?(r.httpRegion.hooks.execute.addObjHook(o=>o.process,new $s({name:e,force:t==="forceRef"})),!0):!1}var $s=class{constructor(e){this.data=e;this.id="ref"}async process(e){var n;let r=await M(this.data.name,this.id,e);if(typeof r!="string"||!r)throw p.error(`ref ${this.data.name} not resolvable to a valid name: ${this.data.name} -> ${r}`),new Error(`ref ${this.data.name} not resolvable to a valid name: ${this.data.name} -> ${r}`);let o=!0;x(e,`load reference ${r}`);let s=Ct(r,e);if(s){let i=J(e.activeEnvironment);_(s.variablesPerEnv[i],e),p.trace("import variables",s.variablesPerEnv[i]),(this.data.force||be(e.variables[r]))&&(o=await s.execute(e),o?_(s.variablesPerEnv[i],e):(n=s.testResults)!=null&&n.some(a=>a.status==="SKIPPED")&&qe(e.httpRegion,"ref is skipped"))}else throw p.error(`ref ${r} not found`),new Error(`ref ${r} not found`);return o}};function ca(t,e,r){return t==="responseRef"&&e&&(r.httpRegion.responseRefs||(r.httpRegion.responseRefs=[]),r.httpRegion.responseRefs.push(e)),!1}function fa(t,e,r){return t==="sleep"&&e?(r.httpRegion.hooks.execute.addHook("sleep",async o=>{let s=await H.evalExpression(e,o);return Number.isSafeInteger(s)&&(await x(o,`Sleep for ${s}ms`),await Se(s)),!0}),!0):!1}function ga(t,e,r){let o=S(e);return t==="timeout"&&o!==void 0?(r.httpRegion.hooks.onRequest.addHook("timeout",async s=>{s.timeout=o}),!0):!1}function ha(t,e,r){if(t==="verbose"||t==="debug"){let o=t==="debug"?2:1;return p.options.level=o,r.httpRegion.hooks.execute.addInterceptor({id:"verbose",async beforeLoop(){return p.options.level=o,!0}}),!0}return!1}async function ya(t,{httpRegion:e}){let r=t(!0),o=Np(r);return o?(e.metaData.description||(e.metaData.description=o.comment),{nextParserLine:o.endLine,symbols:[new v({name:"comment",description:o.comment,kind:"comment",startLine:o.startLine,startOffset:0,endLine:o.endLine,endOffset:o.endOffset})]}):!1}function Np(t){var r;let e=t.next();if(!e.done){let o=e.value.line,s=/^\s*\/\/\s*(?<comment>.*)\s*$/u.exec(e.value.textLine);if((r=s==null?void 0:s.groups)!=null&&r.comment)return{startLine:o,endLine:o,endOffset:e.value.textLine.length,comment:s.groups.comment};if(/^\s*\/\*$/u.exec(e.value.textLine)){e=t.next();let i=[];for(;!e.done;){if(/^\s*\*\/\s*$/u.test(e.value.textLine))return{startLine:o,endLine:e.value.line,endOffset:e.value.textLine.length,comment:F(i)};i.push(e.value.textLine),e=t.next()}}}return!1}var ba=/^\s*(#+|\/{2})/u;async function xa(t,e){var i,a;let r=t(),{httpRegion:o,data:s}=e;s.metaTitle&&(o.metaData.title=s.metaTitle.trim(),o.metaData.name||(o.metaData.name=s.metaTitle.trim()),delete s.metaTitle);let n=r.next();if(!n.done){let l=n.value.textLine;if(ba.test(l)){if(Up(e)&&l.trim()!=="###")return p.debug("request with markdown only supports delimiter after request line"),!1;let d={nextParserLine:n.value.line,symbols:[]},u=st.exec(l);if(u)d.endRegionLine=n.value.line-1,d.symbols.push(new v({name:"separator",description:((i=u.groups)==null?void 0:i.title)||"-",kind:"metaData",startLine:n.value.line,startOffset:0,endLine:n.value.line,endOffset:l.length})),s.metaTitle=(a=u.groups)==null?void 0:a.title;else{let c=await nt(n.value,e,ba);c&&(d.symbols=c.symbols)}return d}}return!1}function Up(t){var e;if((e=t.httpRegion.request)!=null&&e.headers){let r=Ze(t.httpRegion.request.headers);if(Gt(r))return!0}return!1}async function va(t,e){var o,s,n;let r=t();if(e.httpRegion.request){let i=Is(e),a=r.next();if(!a.done&&(i.rawBody.length>0||!ze(a.value.textLine))){let l=[];!i.symbol||i.symbol.endLine!==a.value.line-1?(i.symbol=new v({name:"request body",description:"request body",kind:"requestBody",startLine:a.value.line,startOffset:0,endLine:a.value.line,endOffset:a.value.textLine.length,children:Ce(a.value.textLine,a.value.line)}),l.push(i.symbol)):(i.symbol.endLine=a.value.line,i.symbol.endOffset=a.value.textLine.length,(s=(o=i.symbol.children)==null?void 0:o.push)==null||s.call(o,...Ce(a.value.textLine,a.value.line)));let d=Yt(a.value.textLine);return d?(i.rawBody.push(d),(n=i.symbol.children)==null||n.push(new v({name:"filename",description:d.fileName,kind:"path",startLine:a.value.line,startOffset:a.value.textLine.indexOf(d.fileName),endLine:a.value.line,endOffset:a.value.textLine.indexOf(d.fileName)+d.fileName.length}))):i.rawBody.push(a.value.textLine),{nextParserLine:a.value.line,symbols:l}}}return!1}function Is(t){let e=t.data.request_body;return e||(e={rawBody:[]},t.data.request_body=e),e}var io=class{get id(){return"multipart/mixed"}async beforeLoop(e){var o;let r=e.args[1];if(r.httpRegion.request&&zo(r.httpRegion.request.contentType)){if(r.forceRegionDelimiter===void 0)r.forceRegionDelimiter=!0;else if(r.forceRegionDelimiter){let s=((o=r.httpRegion.request.contentType)==null?void 0:o.boundary)||"",n=Is(r).rawBody.slice().pop();m(n)&&n.includes(`--${s}--`)&&(r.forceRegionDelimiter=!1)}}return!0}};async function Ra(t,{httpRegion:e}){var s;let o=t().next();if(!o.done){let n=o.value.textLine,i=/^\s*>>(?<force>!)?\s+(?<fileName>.+)\s*$/u.exec(n);if(i&&((s=i.groups)!=null&&s.fileName)){let a=i.groups.fileName.trim(),l=!!i.groups.force;return e.hooks.onResponse.addHook("outputRedirection",async(d,u)=>{try{if(d.rawBody){let c=b(await M(a,"Variable",u));if(c){let h=await Gp(c,l,u.httpFile.fileName);h?await g.writeBuffer(h,d.rawBody):p.debug(`file ${a} not found`)}else p.debug(`file ${a} not found`)}}catch(c){p.error(`output redirection failed for ${a}`,c)}}),{nextParserLine:o.value.line,symbols:[new v({name:"outputredirection",description:i.groups.filename,kind:"response",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length,children:[new v({name:"filename",description:a,kind:"path",startLine:o.value.line,startOffset:o.value.textLine.indexOf(a),endLine:o.value.line,endOffset:o.value.textLine.indexOf(a)+a.length})]})]}}}return!1}async function Gp(t,e,r){let o=await Ds(t,r);if(!e&&await g.exists(o)){let s=t.lastIndexOf(".");if(s>0&&s<t.length-2){let n=t.slice(0,s),i=t.slice(s+1),a=1;for(o=await Ds(`${n}-${a}.${i}`,r);await g.exists(o);)o=await Ds(`${n}-${a++}.${i}`,r)}}return o}async function Ds(t,e){if(!await g.isAbsolute(t)){let r=g.dirname(e);if(r)return g.joinPath(r,t)}return t}var ka=ue({protocol:"HTTP",methodRegex:/^\s*(?<method>GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS|CONNECT|TRACE|PROPFIND|PROPPATCH|MKCOL|COPY|MOVE|LOCK|UNLOCK|CHECKOUT|CHECKIN|REPORT|MERGE|MKACTIVITY|MKWORKSPACE|VERSION-CONTROL|BASELINE-CONTROL|MKCALENDAR|ACL|SEARCH|GRAPHQL)\s+(?<url>.+?)$/u,protocolRegex:/^\s*(?<url>.+)\s*$/iu,requestClientFactory(t,e){if(oe.createRequestClient)return oe.createRequestClient(t,e);throw new Error("Missing Http Client Provider")},modifyRequest(t){t.method==="HTTP"&&(t.method="GET"),V(t)&&Kp(t)},sessionStore:P});function Kp(t){var e;if(t.url){let r=/(?<url>.*)\s+HTTP\/(?<version>(\S+))/u.exec(t.url);(e=r==null?void 0:r.groups)!=null&&e.version&&r.groups.url&&(t.url=r.groups.url.trim(),["1.1","1.0"].indexOf(r.groups.version)<0&&(t.options||(t.options={}),t.options.http2=!0))}}async function wa(t,e){return de(t,e,/^\s*HTTP\/(?<httpVersion>\S+)\s*(?<statusCode>[1-5][0-9][0-9])\s*(-)?\s*(?<statusMessage>.*)$/u)}async function Pa(t,{httpRegion:e}){var s;let o=t().next();if(!o.done){let n=o.value.textLine,i=/^\s*<>\s*(?<fileName>.+?)\s*$/u.exec(n);if(i&&((s=i.groups)!=null&&s.fileName)){e.responseRefs||(e.responseRefs=[]);let a=i.groups.fileName;return e.responseRefs.push(a),{nextParserLine:o.value.line,symbols:[new v({name:"responseRef",description:i.groups.filename,kind:"response",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length,children:[new v({name:"filename",description:a,kind:"path",startLine:o.value.line,startOffset:n.indexOf(a),endLine:o.value.line,endOffset:n.indexOf(a)+a.length})]})]}}}return!1}async function Ca(t,{httpRegion:e}){let o=t().next();if(!o.done){let s=o.value.textLine,n=/^\s*@(?<useGlobal>global\.)?(?<key>[^\s=:]*)\s*(?<lazyIndicator>:?)=*\s*"?(?<value>.*)"?\s*$/u.exec(s);if(n&&n.groups&&n.groups.key&&n.groups.value){let i=n.groups.key,a=!!n.groups.lazyIndicator,l=!!n.groups.useGlobal,d=n.groups.value;return e.hooks.execute.addHook(`variable_${i}`,async u=>{let c=d;a?u.options.lazyVariables=!0:c=await M(d,"Variable",u);let h=u.variables.$global;return l&&h&&typeof h=="object"?Object.assign(h,{[i]:c}):_({[i]:c},u),!0}),{nextParserLine:o.value.line,symbols:[new v({name:n.groups.key,description:n.groups.value,kind:"variableDefinition",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length,children:[new v({name:n.groups.key,description:"key",kind:"key",startLine:o.value.line,startOffset:o.value.textLine.indexOf(n.groups.key),endLine:o.value.line,endOffset:o.value.textLine.indexOf(n.groups.key)+n.groups.key.length}),new v({name:n.groups.value,description:"value",kind:"value",startLine:o.value.line,startOffset:o.value.textLine.indexOf(n.groups.value),endLine:o.value.line,endOffset:o.value.textLine.indexOf(n.groups.value)+n.groups.value.length})]})]}}}return!1}function Sa(t){t.httpRegion.hooks.execute.addInterceptor({id:"cancel",beforeLoop:async function(r){var s,n;return(n=(s=r.args[0].progress)==null?void 0:s.isCanceled)!=null&&n.call(s)?(p.debug("process canceled by user"),!1):!0}})}async function Ha(t,e){var r;if(t&&((r=e.config)!=null&&r.defaultHeaders)){x(e,"set default request headers");let o=e.config.defaultHeaders;if(!t.headers)t.headers={...o};else for(let[s,n]of Object.entries(o))E(t.headers,s)||(t.headers[s]=n)}}var qa=T(require("encodeurl"));async function Ta(t){t.body&&m(t.body)&&Ye(t.contentType)&&(t.body=(0,qa.default)(t.body))}var Aa={id:"excludeProxy",afterLoop:async function(e){var s,n;let[r,o]=e.args;return r.proxy||(r.proxy=(s=o.config)==null?void 0:s.proxy),r.proxy&&(o.httpRegion.metaData.noProxy||(n=o.config)!=null&&n.proxyExcludeList&&o.config.proxyExcludeList.some(i=>r.url.startsWith(i)))&&delete r.proxy,!0}};var La={id:"isTrusted",afterLoop:async function(e){if(!q.isTrusted()){let[r]=e.args;return await q.showNote(`Is call to ${r.method} ${r.url} allowed, because workspace is not trusted.`)}return!0}};var De=require("hookpoint");async function Oa(t,e){if(x(e,"replace variables in request"),t.url){let r=await M(t.url,"Url",e)||t.url;if(r===De.HookCancel)return De.HookCancel;m(r)&&(t.url=r)}if(await Ms(t,e)===!1)return De.HookCancel;if(await Qp(t,e)===!1)return De.HookCancel}async function Ms(t,e){if(t.body){if(m(t.body)){let r=await M(t.body,"Body",e);if(r===De.HookCancel)return!1;m(r)||Buffer.isBuffer(r)?t.body=r:t.body=b(r)}else if(Array.isArray(t.body)){let r=[];for(let o of t.body)if(m(o)){let s=await M(o,"Body",e);if(s===De.HookCancel)return!1;m(s)&&r.push(s)}else r.push(o);t.body=r}}return!0}async function Qp(t,e){if(t.headers)for(let[r,o]of Object.entries(t.headers))if(Array.isArray(o)){let s=[];for(let n of o){let i=await M(n,r,e);if(i===De.HookCancel)return!1;s.push(i)}t.headers[r]=s}else{let s=await M(o,r,e);if(s===De.HookCancel)return!1;t.headers[r]=s}return!0}async function Ea(t,e){if(t.body&&Array.isArray(t.body)){let r=[];for(let o of t.body)if(m(o))r.push(o);else if(Buffer.isBuffer(o))r.push(o);else{let s=await o(e);s&&r.push(s)}t.body=r}}async function $a(t){if(t){let e={Accept:"*/*","User-Agent":"httpyac"};if(!t.headers)t.headers=e;else for(let[r,o]of Object.entries(e))E(t.headers,r)||(t.headers[r]=o)}}async function Ia(t,{variables:e}){await zp(t,e),await Jp(t,e),await Xp(t,e),await Yp(t,e)}async function zp(t,e){t&&e&&typeof e.request_rejectUnauthorized<"u"&&(t.noRejectUnauthorized=!G(e.request_rejectUnauthorized))}async function Jp(t,e){t&&e&&typeof e.request_noRedirect<"u"&&(t.noRedirect=G(e.request_noRedirect))}async function Xp(t,e){m(e==null?void 0:e.request_proxy)&&(t.proxy=e.request_proxy)}async function Yp(t,e){let r=S(e==null?void 0:e.request_timeout);r!==void 0&&(t.timeout=r)}async function Da(t,e){t.body&&(t.body=await _s(t.body,e))}async function _s(t,e){return m(t)||Buffer.isBuffer(t)?t:await Zp(t,e)}async function Zp(t,e){let r=[];for(let o of t)if(m(o))r.push(o);else if(Buffer.isBuffer(o))r.push(o);else{let s=await o(e);s&&r.push(s)}return r.some(o=>Buffer.isBuffer(o))?Buffer.concat(r.map(o=>Buffer.isBuffer(o)?o:Buffer.from(o))):r.join("")}async function Ma(t){if(t.body&&m(t.body)&&Ye(t.contentType)){let e=Pe(t.body);if(e.length>0){let r=[];for(let o of e)r.push(o.split("=").map(s=>s.trim()).join("="));t.body=r.join("")}}}async function Fa(t){var r;let e=rm(t);if(t.httpRegion.request&&e){let o=t.httpRegion.request;sm(e.rawBody);let s=await nm(e.rawBody);if(s.length>0){let n=am(s,o.contentType);n.length>0&&!n[0].wait&&(o.body=(r=n.shift())==null?void 0:r.body),n.length>0&&dm(n,t)}}}function _a(t,e){return Ye(e)?im(t):(om(t,e),tm(t,e))}function tm(t,e){let r=[],o=[],s=Qo(e)?`\r
`:g.EOL;for(let n of t)m(n)?o.push(n):(o.length>0&&(o.push(""),r.push(o.join(s)),o.length=0),r.push(n),o.push(""));return o.length>0&&r.length===0?o.join(s):(o.length>0&&r.push(o.join(s)),r)}function rm(t){let e=t.data.request_body;return e&&delete t.data.request_body,e}function om(t,e){t.every(r=>m(r))&&Jo(e)&&t.push("")}function sm(t){for(;t.length>0&&ze(t[t.length-1]);)t.pop();if(t.length>0){let e=t[t.length-1];m(e)&&/\s*<--->\s*/u.test(e)&&t.pop()}}async function nm(t){let e=[];for(let r of t)if(m(r))e.push(r);else{let{injectVariables:o,fileName:s}=r,n=(i,a)=>{var l;if(a.httpRegion.metaData.injectVariables)return!0;if((l=a.config)!=null&&l.requestBodyInjectVariablesExtensions){let d=as(i);if(d)return a.config.requestBodyInjectVariablesExtensions.indexOf(d)>=0}return!1};e.push(async i=>await le(s,i,async a=>o||n(r.fileName,i)?await g.readFile(a,r.encoding):g.readBuffer(a)))}return e}function im(t){let e=t.reduce((r,o,s)=>{let n=r;return m(o)&&(n+=`${s===0||o.startsWith("&")?"":g.EOL}${o}`),n},"");return m(e)?e:""}function am(t,e){let r=[],o=[],s=!1;for(let n of t){let i=lm(n);i?(o.push({wait:s,body:_a(r,e)}),s=i.waitForServer,r.length=0):r.push(n)}return r.length>0&&o.push({wait:s,body:_a(r,e)}),o}function lm(t){var e;if(m(t)){let r=/\s*={3}\s*(?<wait>wait-for-server)?\s*$/u.exec(t);if(r)return{waitForServer:!!((e=r==null?void 0:r.groups)!=null&&e.wait)}}}function dm(t,e){e.httpRegion.hooks.onStreaming.addHook("streaming_body",async r=>{if(r.requestClient)return new Promise(o=>{um(t,r,o)})})}async function um(t,e,r){var s;let o=0;for(let n of t){let i=t.indexOf(n)===t.length-1;if(n.wait&&o++,o===0)await ja(n,e),i&&r();else{let a=0,l=o;(s=e.requestClient)==null||s.addEventListener("message",async()=>{++a===l&&(await ja(n,e),i&&r())})}}}async function ja(t,e){var r;if(await Ms(t,e),t.body){let o=await _s(t.body,e);o&&await((r=e.requestClient)==null?void 0:r.send(o))}}async function Va(t){if(t.data.httpResponseSymbol){if(t.httpRegion.response&&t.data.httpResponseSymbol.body.length>0){let e=t.httpRegion.response,r=F(t.data.httpResponseSymbol.body);e.body=r,e.rawBody=Buffer.from(r),e.headers&&(e.contentType=Ze(e.headers));let o=t.data.httpResponseSymbol.symbol;if(o.children){let s=t.data.httpResponseSymbol.body.at(-1);o.children.push(new v({name:"response body",description:"response body",kind:"response",startLine:o.endLine-t.data.httpResponseSymbol.body.length+1,startOffset:0,endLine:o.endLine,endOffset:(s==null?void 0:s.length)||0}))}}delete t.data.httpResponseSymbol}}var Ba={id:"escapeVariable",afterLoop:async function(e){let[r]=e.args;if(m(r)){let o=/(?:\\\{){2}([^}]+?)(?:\\\}){2}/gu,s,n=r;for(;m(n)&&(s=o.exec(r))!==null;){let[i,a]=s;n=n.replace(i,()=>`{{${a}}}`)}n!==r&&e.results.push(n)}return!0}};async function Na(t,e,r){return K(t,async o=>{let s=Yt(o);if(s){let n=await le(s.fileName,r,async i=>s.injectVariables||s.encoding?await g.readFile(i,s.encoding):g.readBuffer(i));return s.injectVariables&&(n=await M(n,e,r)),n}})}async function Ua(t,e,{variables:r,request:o}){if(m(t)&&"Url"===e&&t.startsWith("/")){let s=E(o==null?void 0:o.headers,"Host");if(m(s)){let[,n]=s.toString().split(":");return`${n==="443"||n==="8443"?"https":"http"}://${s}${t}`}if(r.host)return`${r.host}${t}`}return t}async function Ga(t,e,r){return K(t,async o=>r.variables[o])}var Tt=T(require("dayjs")),js=T(require("dayjs/plugin/utc")),Ka=require("uuid");Tt.default.extend(js.default);async function Wa(t,e,{variables:r}){return K(t,async o=>{var n,i,a,l,d,u,c,h,R,w,$,Q;let s=o.trim();if(s==="$guid")return(0,Ka.v4)();if(s.startsWith("$randomInt")){let C=/^\$randomInt\s*(?<min>-?\d+)?\s*(?<max>-?\d+)?\s*$/u.exec(s);if(C&&((n=C.groups)!=null&&n.min)&&((i=C.groups)!=null&&i.max)){let y=S((a=C.groups)==null?void 0:a.min)??0,L=S((l=C.groups)==null?void 0:l.max)??100;if(!Number.isNaN(y)&&!Number.isNaN(L)){if(y>L){let Z=L;L=y,y=Z}return`${Math.floor(Math.random()*(L-y))+y}`}}}else if(s.startsWith("$timestamp")){let C=/^\$timestamp(?:\s(?<offset>-?\d+)\s(?<option>y|Q|M|w|d|h|m|s|ms))?/u.exec(s);if(C){Tt.default.extend(js.default);let y=Tt.default.utc();return(d=C.groups)!=null&&d.offset&&((u=C.groups)!=null&&u.option)&&(y=y.add(Number(C.groups.offset),C.groups.option)),`${y.unix()}`}}else if(s.startsWith("$datetime")){let C=/^\$datetime\s(?<type>rfc1123|iso8601|'.+'|".+")(?:\s(?<offset>-?\d+)\s(?<option>y|Q|M|w|d|h|m|s|ms))?/u.exec(s);if((c=C==null?void 0:C.groups)!=null&&c.type){let y=Tt.default.utc();return(h=C.groups)!=null&&h.offset&&((R=C.groups)!=null&&R.option)&&(y=y.add(Number(C.groups.offset),C.groups.option)),C.groups.type==="rfc1123"?y.toDate().toUTCString():C.groups.type==="iso8601"?y.toISOString():y.format(C.groups.type.slice(1,C.groups.type.length-1))}}else if(s.startsWith("$localDatetime")){let C=/^\$localDatetime\s(?<type>rfc1123|iso8601|'.+'|".+")(?:\s(?<offset>-?\d+)\s(?<option>y|Q|M|w|d|h|m|s|ms))?/u.exec(s);if((w=C==null?void 0:C.groups)!=null&&w.type){let y=Tt.default.utc().local();return($=C.groups)!=null&&$.offset&&((Q=C.groups)!=null&&Q.option)&&(y=y.add(Number(C.groups.offset),C.groups.option)),C.groups.type==="rfc1123"?y.locale("en").format("ddd, DD MMM YYYY HH:mm:ss ZZ"):C.groups.type==="iso8601"?y.format():y.format(C.groups.type.slice(1,C.groups.type.length-1))}}else{if(s.startsWith("$processEnv"))return process.env[s.slice(11).trim()]||"";if(s.startsWith("$dotenv"))return r[s.slice(7).trim()]||""}})}var Qa=require("hookpoint");async function za(t,e,{variables:r}){return K(t,async o=>{var i;let n=/^\$(?<type>(prompt|input|password))(?<askonce>-askonce)?\s*(?<placeholder>[^$]*)(\$value:\s*(?<value>.*))?\s*$/u.exec(o);if((i=n==null?void 0:n.groups)!=null&&i.placeholder){let a=n.groups.placeholder.trim(),l=n.groups.type,d=`input_${a}`,u=P.getUserSession(d);if(n.groups.askonce){if((r==null?void 0:r[a])!==void 0)return r[a];if(u!=null&&u.answer)return u.answer}let c=l==="password",h=await q.showInputPrompt(a,(u==null?void 0:u.answer)||n.groups.value,c);return h!==void 0?(P.setUserSession({id:d,title:c?a:`${a}=${h}`,description:`Cache for ${l}`,type:"input",details:{placeholder:a,inputType:l,answer:c?void 0:h},answer:h}),h):Qa.HookCancel}})}var Ja=require("hookpoint");async function Xa(t,e,r){return K(t,async o=>{var n,i;let s=/^\$pick(?<save>-askonce)?\s*(?<placeholder>[^$]*)(\$value:\s*(?<value>.*))\s*$/u.exec(o);if((n=s==null?void 0:s.groups)!=null&&n.placeholder&&((i=s==null?void 0:s.groups)!=null&&i.value)){let a=s.groups.placeholder.trim(),l=`input_${a}`,d=P.getUserSession(l);if(d!=null&&d.answer&&s.groups.save)return d.answer;let u=await mm(s.groups.value,r),c=await q.showListPrompt(a,u);return c!==void 0?(P.setUserSession({id:l,title:`${a}=${c}`,description:"Cache for $pick",type:"input",details:{placeholder:a,answer:c},answer:c}),c):Ja.HookCancel}})}async function mm(t,e){let r=t.split(",");if(r.length===1)try{let o=await H.evalExpression(t,e);if(Array.isArray(o))return o}catch(o){p.trace("error in quickpick",o)}return r}function Ya(t,e){let{httpRegion:r}=e;if(m(r.metaData.name)){let o=r.metaData.name.trim().replace(/\s/gu,"-").replace(/-./gu,s=>s[1].toUpperCase());_({[o]:t.parsedBody||t.body,[`${o}Response`]:t},e)}}var Za={id:"jsonResponseBody",beforeLoop:async function(e){let[r]=e.args;if(r&&Ut(r.contentType)&&m(r.body)&&r.body.length>0)try{r.parsedBody||(r.parsedBody=JSON.parse(r.body)),r.prettyPrintBody||(r.prettyPrintBody=k(r.parsedBody,2))}catch(o){p.warn("json parse error",r.body,o)}return!0}};function el(t,e){let r=Zo(t);P.setUserSession({id:"last_response",title:"last response",description:`response of ${e.httpRegion.symbol.name}`,details:{},type:"LAST_RESPONSE",response:r}),e.variables.response=t}function tl(t){gm(t),hm(t),ym(t),Rm(t),vm(t),bm(t),km(t),xm(t)}function gm(t){t.hooks.onRequest.addHook("attachDefaultHeaders",Ha),t.hooks.onRequest.addHook("setEnvRequestOptions",Ia),t.hooks.onRequest.addHook("resolveRequestBody",Ea),t.hooks.onRequest.addHook("setDefaultHttpyacHeaders",$a),t.hooks.onRequest.addHook("requestVariableReplacer",Oa),t.hooks.onRequest.addHook("transformRequestBody",Da),t.hooks.onRequest.addHook("transfromMultilineFormUrlEncoded",Ma),t.hooks.onRequest.addHook("encodeRequestBody",Ta),t.hooks.onRequest.addInterceptor(La),t.hooks.onRequest.addInterceptor(Aa)}function hm(t){t.hooks.onResponse.addHook("handleMetaDataName",Ya),t.hooks.onResponse.addHook("setLastResponseInVariables",el),t.hooks.onResponse.addInterceptor(Za)}function ym(t){t.hooks.parse.addHook("meta",xa),t.hooks.parse.addHook("comment",ya),t.hooks.parse.addHook("variable",Ca),t.hooks.parse.addHook("request",ka),t.hooks.parse.addHook("outputRedirection",Ra),t.hooks.parse.addHook("responseRef",Pa),t.hooks.parse.addHook("response",wa),t.hooks.parse.addHook("requestBody",va),t.hooks.parse.addInterceptor(new io)}function bm(t){t.hooks.parseEndRegion.addHook("registerCancelExecutionInterceptor",Sa),t.hooks.parseEndRegion.addHook("response",Va),t.hooks.parseEndRegion.addHook("requestBody",Fa)}function xm(t){t.hooks.replaceVariable.addHook("host",Ua),t.hooks.replaceVariable.addHook("name",Ga),t.hooks.replaceVariable.addHook("file",Na),t.hooks.replaceVariable.addHook("showInputBox",za),t.hooks.replaceVariable.addHook("showQuickPick",Xa),t.hooks.replaceVariable.addHook("restClientDynamic",Wa),t.hooks.replaceVariable.addInterceptor(Ba)}function vm(t){t.hooks.parseMetaData.addHook("disabled",Yi),t.hooks.parseMetaData.addHook("import",ea),t.hooks.parseMetaData.addHook("jwt",ta),t.hooks.parseMetaData.addHook("keepStreaming",oa),t.hooks.parseMetaData.addHook("loop",ia),t.hooks.parseMetaData.addHook("noRedirect",aa),t.hooks.parseMetaData.addHook("noRejectUnauthorized",la),t.hooks.parseMetaData.addHook("timeout",ga),t.hooks.parseMetaData.addHook("note",da),t.hooks.parseMetaData.addHook("proxy",ua),t.hooks.parseMetaData.addHook("rateLimit",pa),t.hooks.parseMetaData.addHook("ref",ma),t.hooks.parseMetaData.addHook("responseRef",ca),t.hooks.parseMetaData.addHook("sleep",fa),t.hooks.parseMetaData.addHook("verbose",ha),t.hooks.parseMetaData.addHook("forceRegionDelimiter",Zi)}function Rm(t){let e=new so;t.hooks.execute.addInterceptor(new no),t.hooks.execute.addInterceptor(e),t.hooks.responseLogging.addInterceptor(e.getResponseLoggingInterceptor()),t.hooks.execute.addInterceptor(new to),t.hooks.execute.addInterceptor(new ro),t.hooks.execute.addInterceptor(new oo)}function km(t){t.hooks.provideEnvironments.addHook("config",Vi),t.hooks.provideVariables.addHook("config",Bi),t.hooks.provideVariables.addHook("response",zi)}var rl=require("dotenv");var Fs=".env";async function ol(t){let e=[];if(process.env.HTTPYAC_ENV)try{e.push(...await g.readdir(process.env.HTTPYAC_ENV))}catch(s){p.warn(`HTTPYAC_ENV ${process.env.HTTPYAC_ENV} has read error`,s)}let r=g.dirname(t.httpFile.fileName);r&&await _e(r,t.httpFile.rootDir,async s=>{e.push(...await wm(nl(t),s)),e.push(...await rt(g.readdir(s),[]))});let o=[];for(let s of e){let n;s.startsWith(`${Fs}.`)?n=s.slice(5):s.endsWith(Fs)&&(n=s.slice(0,s.length-4)),n&&o.push(n)}return p.info("dotenv Env Provider found environments",o),o}async function wm(t,e){let r=[];if(t){let o=await z(t,e);o&&r.push(...await rt(g.readdir(o),[]))}return r}async function sl(t,e){let r=Pm(t),o=[];process.env.HTTPYAC_ENV&&o.push(...await Vs(r,process.env.HTTPYAC_ENV));let s=g.dirname(e.httpFile.fileName);if(s){let n=[];await _e(s,e.httpFile.rootDir,async i=>{n.unshift(...await Cm(nl(e),r,i)),n.unshift(...await Vs(r,i))}),o.push(...n)}return Object.assign({},...o)}function nl(t){var e;return((e=t.config)==null?void 0:e.envDirName)||"env"}function Pm(t){let e=[Fs];if(t)for(let r of t)e.push(`${r}.env`,`.env.${r}`);return e}async function Cm(t,e,r){let o=[];if(t){let s=await z(t,r);s&&o.push(...await Vs(e,s))}return o}async function Vs(t,e){let r=await rt(g.readdir(e),[]),o=t.filter(n=>r.indexOf(n)>=0),s=[];for(let n of o){let i=g.joinPath(e,n);p.trace(`.env environment file found: ${i}`);try{let a=await g.readFile(i,"utf-8"),l=(0,rl.parse)(a);s.push(l)}catch{p.trace(`${g.toString(i)} not found`)}}return s}function il(t){t.hooks.provideEnvironments.addHook("dotenv",ol),t.hooks.provideVariables.addHook("dotenv",sl)}function ao(t){return(t==null?void 0:t.protocol)==="SSE"}I.emptyLineProvider.push(()=>[{name:"SSE",description:"Server Sent Event"}]);I.requestHeaderProvider.push(t=>{let e=[];return ao(t)&&e.push({name:"Event",description:"Server Sent Events to add listener"}),e});var al=T(require("eventsource"));var lo=class extends te{constructor(r){super();this.request=r;this.responseTemplate={protocol:"SSE"}}get reportMessage(){return`perform SSE Request (${this.request.url})`}get supportsStreaming(){return!0}get nativeClient(){return this._nativeClient}async connect(){return ao(this.request)&&(this._nativeClient=new al.default(this.request.url||"",this.getClientOptions(this.request)),this.registerEvents(this._nativeClient,this.request)),this._nativeClient}async send(){p.debug("SSE does not support send")}disconnect(){var r;(r=this.nativeClient)==null||r.close(),this.onDisconnect()}getClientOptions(r){let o={},s={...r.headers};return Ee(s,"event"),o.headers=s,r.noRejectUnauthorized&&(o.rejectUnauthorized=!1),r.proxy&&(o.proxy=r.proxy),o}registerEvents(r,o){let s=O(o.headers,"event",["data","message"]);for(let i of s)r.addEventListener(i,a=>{this.onMessage("message",{...this.responseTemplate,statusCode:a.status||200,name:`EventSource (${this.request.url})`,request:this.request,body:a.data,rawBody:Buffer.from(a.data)})});r.onerror=i=>{this.onMessage("error",{...this.responseTemplate,statusCode:400,request:this.request,body:Ie(i)})};let n=["open"];for(let i of n)r.addEventListener(i,a=>{this.onMetaData("open",{...this.responseTemplate,statusCode:200,message:a.data,body:{data:a.data,date:new Date}})})}};var ll=ue({protocol:"SSE",methodRegex:/^\s*(SSE|EVENTSOURCE)\s+(?<url>.+?)\s*$/u,requestClientFactory(t){return new lo(t)},modifyRequest(t){t.supportsStreaming=!0},sessionStore:P});async function dl(t,e){return de(t,e,/^\s*SSE\s*(?<statusCode>(-1|0))\s*(-)?\s*(?<statusMessage>.*)$/u)}var Sm=T(require("eventsource"));function ul(t){t.hooks.parse.addHook("eventSource",ll,{before:["request"]}),t.hooks.parse.addHook("eventSourceResponse",dl,{before:["requestBody"]}),H.require.eventsource=Sm}var uo=class{constructor(e){this.gqlData=e;this.id="gql";this.before=["http"]}async process(e,r){var o,s,n,i,a;if(e&&((o=this.gqlData)!=null&&o.query)){x(r,"build GraphQL query");let l;if(m(this.gqlData.query))l=this.gqlData.query;else{let d=await this.gqlData.query(r);if(d)l=d;else{let u="query import not found";(n=(s=q).showWarnMessage)==null||n.call(s,u),p.warn(u)}}if(l){for(let[c,h]of Object.entries(this.gqlData.fragments))if(l.indexOf(`...${c}`)>=0){let R;if(m(h))R=h;else{let w=await h(r);if(w)R=w;else{let $=`query fragment ${c} not found`;(a=(i=q).showWarnMessage)==null||a.call(i,$),p.warn($)}}R&&(l=F([l,R]))}let d=await M(l,"Body",r),u={query:m(d)?d:l};this.gqlData.operationName&&(u.operationName=this.gqlData.operationName),m(e.body)&&(u.variables=JSON.parse(e.body)),e.body=k(u)}}}};var Hm=/^\s*$/u;async function ml(t,e){let r=t();if(e.httpRegion.metaData.noGqlParsing)return!1;let o=await Am(r);if(o){let s={fragments:Tm(e)};return e.httpRegion.request?(s.query=o.gql,o.name&&(s.operationName=qm(o.name),e.httpRegion.metaData.name||(e.httpRegion.metaData.name=o.name)),e.httpRegion.hooks.onRequest.addObjHook(n=>n.process,new uo(s))):o.name&&(s.fragments[o.name]=o.gql),{nextParserLine:o.symbol.endLine,symbols:[o.symbol]}}return!1}function qm(t){return t&&t.trim().split(" ").filter(e=>!!e&&!e.startsWith("@")).pop()}function Tm(t){let e=t.data.gql;return e||(e={},t.data.gql=e),e}async function Am(t){var r,o,s;let e=t.next();if(!e.done){let n=e.value.line,i=/^\s*gql(\s+(?<name>[^\s(]+))?\s+<\s+(?<fileName>.+)\s*$/u.exec(e.value.textLine);if(i&&((r=i.groups)!=null&&r.fileName)){let d=i.groups.fileName.trim();return{symbol:new v({name:"gql",description:"gql",kind:"gql",startLine:n,startOffset:0,endLine:n,endOffset:e.value.textLine.length,children:[new v({name:"filename",description:d,kind:"path",startLine:e.value.line,startOffset:e.value.textLine.indexOf(d),endLine:e.value.line,endOffset:e.value.textLine.indexOf(d)+d.length})]}),name:i.groups.name||i.groups.fileName,gql:u=>le(d,u,c=>g.readFile(c,"utf-8"))}}let a=/^\s*(query|mutation)(\s+(?<name>[^\s(]+))?/u.exec(e.value.textLine);if(a)return pl(e.value,t,(o=a.groups)==null?void 0:o.name);let l=/^\s*(fragment)\s+(?<name>[^\s(]+)\s+on\s+/u.exec(e.value.textLine);if(l)return pl(e.value,t,(s=l.groups)==null?void 0:s.name)}return!1}function pl(t,e,r){let o=e.next(),s={endLine:t.line,endOffset:t.textLine.length},n=[t.textLine];for(;!o.done;){if(s={endLine:o.value.line,endOffset:o.value.textLine.length},Hm.test(o.value.textLine))return{name:r,symbol:new v({name:"gql",description:"gql",kind:"gql",startLine:t.line,startOffset:0,...s}),gql:F(n)};n.push(o.value.textLine),o=e.next()}return{name:r,symbol:new v({name:"gql",description:"gql",kind:"gql",startLine:t.line,startOffset:0,...s}),gql:F(n)}}async function cl(t){var e;((e=t.method)==null?void 0:e.toUpperCase())==="GRAPHQL"&&(t.method="POST",E(t.headers,"content-type")||(t.headers||(t.headers={}),t.headers["content-type"]="application/json"))}function fl(t){t.hooks.parse.addHook("graphql",ml,{before:["request"]}),t.hooks.onRequest.addHook("graphqlProtocolReplacer",cl)}function Y(t){return(t==null?void 0:t.protocol)==="GRPC"}async function gl(t,e){var r,o;if(Y(t)&&t.headers){x(e,"create call options");let s=t.timeout||S((o=(r=e.config)==null?void 0:r.request)==null?void 0:o.timeout);s!==void 0&&(t.callOptions=Object.assign({},t.options,{deadline:new Date(new Date().getTime()+s)}))}}var or=require("@grpc/grpc-js");async function hl(t){if(Y(t)&&t.headers){let e=E(t.headers,"channelcredentials");m(e)&&(e.toLowerCase()==="ssl"&&(t.channelCredentials=or.credentials.createSsl()),e.toLowerCase()==="insecure"&&(t.channelCredentials=or.credentials.createInsecure())),e instanceof or.ChannelCredentials&&(Ee(t.headers,"channelcredentials"),t.channelCredentials=e)}}async function yl(t,e){if(Y(t)&&t.headers){x(e,"create channel options"),t.options||(t.options={});for(let[r,o]of Object.entries(t.headers))r.startsWith("grpc.")&&(Ee(t.headers,r),(m(o)||Number.isInteger(o))&&(["grpc.keepalive_time_ms","grpc.keepalive_timeout_ms","grpc.keepalive_permit_without_calls","grpc.max_concurrent_streams","grpc.initial_reconnect_backoff_ms","grpc.max_reconnect_backoff_ms","grpc.use_local_subchannel_pool","grpc.max_send_message_length","grpc.max_receive_message_length","grpc.enable_http_proxy","grpc.default_compression_algorithm","grpc.enable_channelz","grpc.dns_min_time_between_resolutions_ms","grpc-node.max_session_memory"].indexOf(r)>=0?t.options[r]=S(o):t.options[r]=o))}}I.emptyLineProvider.push(()=>[{name:"GRPC",description:"GRPC request"},{name:"proto < ./",description:"Proto Import"}]);I.requestHeaderProvider.push(t=>{let e=[];return Y(t)&&e.push({name:"ChannelCredentials",description:"Channel credentials, which are attached to a Channel, such as SSL credentials."}),e});var Bs=/^\s*((?<protocol>grpc|https?):\/\/)?(?<server>[^/]+?)(\/(?<path>.+))?\/(?<service>[^/]+?)\/(?<method>[^/]+?)$/iu;function bl(t,e){var o;let r=Bs.exec(t);if(r&&((o=r.groups)!=null&&o.service)){let{server:s,path:n,service:i,method:a,protocol:l}=r.groups,d=Lm(e),u=d[i];if(!u){let h=Object.keys(d).find(R=>R.indexOf(i)>=0);h&&(p.warn(`service ${i} not found. Similar service ${h} is used.`),u=d[h])}if(typeof u=="function"){let h=u.service[a]||Object.entries(u.service).filter(([R])=>R.toLowerCase()===a.toLowerCase()).map(([,R])=>R).pop();return{server:s,service:i,path:n,protocol:l,method:a,ServiceClass:u,methodDefinition:h}}let c=Object.keys(d);throw c.length>0?new Error(`Service ${i} does not exist. Available Services: ${c.join(", ")}`):new Error(`Service ${i} does not exist. No Service imported`)}else throw new Error(`Url ${t} does not match pattern <server>/<service>/<method>`)}function Lm(t){let e={};for(let r of Object.values(t))if(r.grpcObject){let o=xl(r.grpcObject);Object.assign(e,o)}return e}function xl(t){return Object.entries(t).reduce((e,r)=>{if(typeof r[1]=="function")e[r[0]]=r[1];else if(Om(r[1]))for(let[o,s]of Object.entries(xl(r[1])))e[`${r[0]}.${o}`]=s;return e},{})}function Om(t){let e=t;return e&&!e.format&&typeof t!="function"}var Ve=T(require("@grpc/grpc-js")),Re=require("stream");var vl=T(require("@grpc/grpc-js")),po=class extends vl.Channel{constructor(r,o,s,n){super(r,o,s);this.path=n}createCall(r,o,s,n,i){return this.path?super.createCall(`/${this.path}${r}`,o,s,n,i):super.createCall(r,o,s,n,i)}};var Ns=require("@grpc/grpc-js/build/src/connectivity-state");Ve.setLogger(p);var mo=class extends te{constructor(r,o){super();this.request=r;this.context=o;this.responseTemplate={protocol:"GRPC"}}get reportMessage(){return`perform gRPC Request (${this.request.url})`}get supportsStreaming(){var r,o,s,n;return!!((o=(r=this._clientDefinition)==null?void 0:r.methodDefinition)!=null&&o.requestStream)||!!((n=(s=this._clientDefinition)==null?void 0:s.methodDefinition)!=null&&n.responseStream)}get nativeClient(){return this._nativeClient}getChannelOptions(r,o){let s={};return o.path&&(s.channelFactoryOverride=(n,i,a)=>{try{p.trace("grpc new channel for address is created",n);let l=Object.assign({},a);return delete l.channelFactoryOverride,l["grpc.default_authority"]=o.server,new po(n,i,l,o.path)}catch(l){p.debug("error on PathAwareChannel creation",l)}return new Ve.Channel(n,i,a)}),Object.assign(s,r.options)}getSessionId(){return tt(this.request.url)}async connect(r){if(Y(this.request)){if(r){let s=this.getClientConnectivityState(r);if(p.trace("grpc connect with prev client and state",s,r),s===Ns.ConnectivityState.TRANSIENT_FAILURE)r.close(),p.debug("grpc prev client connection state after close:",this.getClientConnectivityState(r));else if(s!==Ns.ConnectivityState.SHUTDOWN)return this._nativeClient=r,p.trace("grpc prev client is used",s,r),this._nativeClient}let o=this.context.options.protoDefinitions;if(o)p.trace("grpc new client is used"),this._clientDefinition=bl(this.request.url||"",o),this._nativeClient=new this._clientDefinition.ServiceClass(this._clientDefinition.server,this.request.channelCredentials||Ve.credentials.createInsecure(),this.getChannelOptions(this.request,this._clientDefinition));else throw p.error("no protodefinitions found in context"),new Error("Missing Protodefinitions")}return this._nativeClient}async send(r){return new Promise(o=>{var i;let s=this.getData(r||this.request.body),n=!this.grpcStream||!((i=this._clientDefinition)!=null&&i.methodDefinition.requestStream);n&&(this.grpcStream=this.callMethod(s,o),(this.grpcStream instanceof Re.Duplex||this.grpcStream instanceof Re.Readable)&&this.grpcStream.once("close",()=>o())),Y(this.request)&&(this.grpcStream instanceof Re.Writable||this.grpcStream instanceof Re.Duplex)&&this.grpcStream.write(s),n||o()})}callMethod(r,o){if(this.nativeClient&&this._clientDefinition&&Y(this.request)){let s=this._clientDefinition.method,n=this.nativeClient[s].bind(this.nativeClient),i=this.getMethodArgs(this._clientDefinition,this.request,r,o),a=n(...i);return this.registerEvents(a,s),a}}getMethodArgs(r,o,s,n){var a,l;let i=[this.getMetaData(o)];return o.callOptions&&i.push(o.callOptions),(a=r.methodDefinition)!=null&&a.requestStream||i.splice(0,0,s),(l=r.methodDefinition)!=null&&l.responseStream||i.push((d,u)=>{this.onMessage(r.method,this.toHttpResponse(d||u)),n()}),i}getData(r){return m(r)?JSON.parse(r):Buffer.isBuffer(r)?JSON.parse(r.toString("utf-8")):r}streamEnded(){(this.grpcStream instanceof Re.Writable||this.grpcStream instanceof Re.Duplex)&&(this.grpcStream.end(),delete this.grpcStream)}disconnect(r){var o,s;(o=this.grpcStream)!=null&&o.cancel?this.grpcStream.cancel():r?(s=this.grpcStream)==null||s.destroy(r):(this.grpcStream instanceof Re.Writable||this.grpcStream instanceof Re.Duplex)&&this.grpcStream.end(),delete this.grpcStream,this._nativeClient&&(p.debug("client connection state:",this.getClientConnectivityState(this._nativeClient)),this._nativeClient.close(),p.debug("client connection state after close:",this.getClientConnectivityState(this._nativeClient))),delete this._nativeClient,this.onDisconnect()}getClientConnectivityState(r){return r.getChannel().getConnectivityState(!1)}registerEvents(r,o){r.on("metadata",n=>{this.responseTemplate.headers=n.getMap()}),r.on("data",n=>{this.onMessage(o,this.toHttpResponse(n))}),r.on("error",n=>{this.onMessage(o,this.toHttpResponse(n))});let s=["end","close","pause","resume"];for(let n of s)r.on(n,i=>{this.onMetaData(o,{...this.responseTemplate,statusCode:0,message:`${n} received`,body:{message:i,date:new Date}})})}getMetaData(r){let o=new Ve.Metadata;if(r.headers)for(let[s,n]of Object.entries(r.headers))(m(n)||Buffer.isBuffer(n))&&o.add(s,n);return o}toHttpResponse(r){let o=m(r)?r:k(r,2),s={headers:{},...this.responseTemplate,statusCode:0,statusMessage:"OK",body:o,rawBody:Buffer.isBuffer(r)?r:Buffer.from(o),parsedBody:r,contentType:{mimeType:"application/grpc+json",charset:"UTF-8",contentType:"application/grpc+json; charset=utf-8"},request:this.request};return this.isGrpcError(r)&&(s.statusCode=r.code||2,s.statusMessage=r.details),s}isGrpcError(r){return r instanceof Error}};var Rl=ue({protocol:"GRPC",methodRegex:/^\s*(GRPC)\s+(?<url>.+?)\s*$/u,protocolRegex:/^\s*(?<url>grpc:\/\/.+?)\s*$/iu,requestClientFactory(t,e){return new mo(t,e)},modifyRequest(t){t.supportsStreaming=!0},sessionStore:P});async function kl(t,e){return de(t,e,/^\s*GRPC\s*(?<statusCode>([0-9]+))\s*(-)?\s*(?<statusMessage>.*)$/u)}var wl=require("@grpc/grpc-js"),Pl=require("@grpc/proto-loader");var Em=/^\s*proto\s+<\s+(?<fileName>.+)\s*$/u;async function Cl(t,e){var s;let r=t(),o=r.next();if(!o.done){let n=Em.exec(o.value.textLine);if((s=n==null?void 0:n.groups)!=null&&s.fileName){let i=n.groups.fileName,a=new Bt(i.trim());a.loaderOptions={};let d=[new v({name:o.value.textLine||"proto import",description:"proto import",kind:"proto",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length,children:[new v({name:"filename",description:i,kind:"path",startLine:o.value.line,startOffset:o.value.textLine.indexOf(i),endLine:o.value.line,endOffset:o.value.textLine.indexOf(i)+i.length})]})],u={nextParserLine:o.value.line,symbols:d},c=await wt(r,[nt,Pt(a.loaderOptions),Xt((h,R)=>{var $,Q;let w=(Q=($=R.options.protoDefinitions)==null?void 0:$[a.fileName])==null?void 0:Q.loaderOptions;w&&Object.assign(w,h)})],e);if(c){u.nextParserLine=c.nextLine||u.nextParserLine;for(let h of c.parseResults)d.push(...h.symbols)}return e.httpRegion.hooks.execute.addObjHook(h=>h.process,new Us(a)),e.httpRegion.hooks.execute.addInterceptor(new Gs(a)),u}}return!1}var Us=class{constructor(e){this.protoDefinition=e;this.id="proto"}async process(e){var o;x(e,`import proto ${this.protoDefinition.fileName}`);let r=(o=e.options.protoDefinitions)==null?void 0:o[this.protoDefinition.fileName];if(r&&q.isTrusted("Proto-Loader")){let s=await this.convertLoaderOptions(e,r.loaderOptions);r.packageDefinition=await le(this.protoDefinition.fileName,e,async n=>{var l,d;let i=g.fsPath(n);if(i)return await(0,Pl.load)(i,s);let a=`file ${n} has not scheme file`;(d=(l=q).showWarnMessage)==null||d.call(l,a),p.warn(a)}),r.packageDefinition&&(r.grpcObject=(0,wl.loadPackageDefinition)(r.packageDefinition))}return!0}async convertLoaderOptions(e,r){var n,i;let o={...r},s=F(Object.entries(o).filter(([,a])=>m(a)).map(([a,l])=>`${a}: ${l},`));try{Object.assign(o,await H.evalExpression(`{${s}}`,e))}catch(a){let l=`proto-loader options convert failed: ${s}`;(i=(n=q).showWarnMessage)==null||i.call(n,l),p.warn(l,a)}return o}},Gs=class{constructor(e){this.protoDefinition=e;this.id="proto"}async beforeLoop(e){let r=e.args[0];return r.options.protoDefinitions=Object.assign({},r.options.protoDefinitions,{[this.protoDefinition.fileName]:{fileName:this.protoDefinition.fileName,loaderOptions:{...this.protoDefinition.loaderOptions}}}),!0}};var Sl=T(require("@grpc/grpc-js")),Hl=require("grpc-js-reflection-client"),ql=require("@grpc/grpc-js");function Tl(t,e,r){return t==="grpcReflection"&&e?(r.httpRegion.hooks.onRequest.addHook("grpcReflection",async(o,s)=>{if(Y(o)&&(x(s,"grpc reflection"),e))try{let n=await Ks(e,o);s.options.protoDefinitions?Object.assign(s.options.protoDefinitions,n):s.options.protoDefinitions=n}catch(n){p.debug("error in grpc reflection",n)}}),!0):!1}async function Ks(t,e){let r=new Hl.GrpcReflection(t,e.channelCredentials||Sl.credentials.createInsecure()),o=await r.listServices();p.debug("grpc reflection",o);let s={};for(let n of o)if(!n.startsWith("grpc.reflection")){let a=(await r.getDescriptorBySymbol(n)).getPackageDefinition(),l=(0,ql.loadPackageDefinition)(a);s[n]={fileName:n,loaderOptions:{},grpcObject:l,packageDefinition:a}}return s}var $m=T(require("@grpc/grpc-js"));async function Al(t,e){var r,o;if(Y(t)){x(e,"grpc reflection");let s=(o=(r=Bs.exec(t.url))==null?void 0:r.groups)==null?void 0:o.server;if(!s||e.options.protoDefinitions&&Object.keys(e.options.protoDefinitions).length>0)return;try{let n=await Ks(s,t);if(Object.keys(n).length===0)return;e.options.protoDefinitions?Object.assign(e.options.protoDefinitions,n):e.options.protoDefinitions=n}catch(n){p.debug("error in grpc reflection",n)}}}function Ll(t){t.hooks.parseMetaData.addHook("grpcReflection",Tl),t.hooks.parse.addHook("proto",Cl,{before:["request"]}),t.hooks.parse.addHook("grpc",Rl,{before:["request"]}),t.hooks.parse.addHook("grpcResponse",kl,{before:["requestBody"]}),t.hooks.onRequest.addHook("channelOptions",yl),t.hooks.onRequest.addHook("channelCredentials",hl),t.hooks.onRequest.addHook("callOptions",gl),t.hooks.onRequest.addHook("grpcReflectionRequestHook",Al),H.require["@grpc/grpc-js"]=$m}var Ol=T(require("aws4")),El=require("url");async function $l(t,e,r){var s;let{request:o}=r;if(e.toLowerCase()==="authorization"&&m(t)&&V(o)&&(o!=null&&o.url)){let n=/^\s*(aws)\s+(?<accessKeyId>[^\s]*)\s+(?<secretAccessKey>[^\s]*)\s*(token:\s*(?<token>[^\s]*))?\s*(region:\s*(?<region>[^\s]*))?\s*(service:\s*(?<service>[^\s]*))?\s*$/iu.exec(t);if(n&&n.groups&&n.groups.accessKeyId&&n.groups.secretAccessKey){x(r,"get AWS Authorization");let i={accessKeyId:n.groups.accessKeyId,secretAccessKey:n.groups.secretAccessKey,sessionToken:n.groups.token},a=new El.URL(o.url);o.headers||(o.headers={});let l={method:o.method,headers:o.headers,host:a.host,path:`${a.pathname}${a.search}`,region:n.groups.region,service:n.groups.service,body:Buffer.isBuffer(o.body)||m(o.body)?o.body:void 0},d=await Ol.default.sign(l,i);return Object.assign(o,{http2:!1}),Object.assign(o.headers,d.headers),(s=d.headers)==null?void 0:s.Authorization}}return t}var Im=/^\s*(basic)\s+(?<user>[^\s]*)\s+(?<password>([^\s]+.*))$/iu,Dm=/^\s*(basic)\s+(?<user>.*):(?<password>.*)$/iu;async function Il(t,e){if(e.toLowerCase()==="authorization"&&m(t)){let r=Dm.exec(t)||Im.exec(t);if(r&&r.groups&&r.groups.user)return`Basic ${Buffer.from(`${r.groups.user}:${r.groups.password}`).toString("base64")}`}return t}var Dl=require("url");async function Ml(t,e,r){var i,a,l;let{request:o,httpRegion:s,httpFile:n}=r;if(m(t)&&V(o)&&!s.metaData.noClientCert){if(e==="Url"&&((i=r.config)!=null&&i.clientCertificates))await Mm(t,o,r);else if(e.toLowerCase().endsWith("clientcert")){let d=/^\s*(cert:\s*(?<cert>[^\s]*)\s*)?(key:\s*(?<key>[^\s]*)\s*)?(pfx:\s*(?<pfx>[^\s]*)\s*)?(passphrase:\s*(?<passphrase>[^\s]*)\s*)?\s*$/u.exec(t);if((a=d==null?void 0:d.groups)!=null&&a.cert||(l=d==null?void 0:d.groups)!=null&&l.pfx){await _l(o,{cert:d.groups.cert,key:d.groups.key,pfx:d.groups.pfx,passphrase:d.groups.passphrase},n);return}}}return t}async function Mm(t,e,r){var s,n;let o=_m(t);if(o&&((s=r.config)!=null&&s.clientCertificates)){let i=(n=r.config)==null?void 0:n.clientCertificates[o.host];i&&await _l(e,i,r.httpFile)}}function _m(t){try{return new Dl.URL(t)}catch{return}}async function _l(t,e,r){let o=g.dirname(r.fileName);t.options||(t.options={}),t.options.https=Object.assign({},t.options.https,{certificate:await Ws(e.cert,o),key:await Ws(e.key,o),pfx:await Ws(e.pfx,o),passphrase:e.passphrase})}async function Ws(t,e){if(t)if(m(t)){let r=await z(t,e);if(r)return await g.readBuffer(r)}else return await g.readBuffer(t)}I.emptyLineProvider.push(()=>[{name:"GET",description:"The GET method requests a representation of the specified resource. Requests using GET should only retrieve data."},{name:"HEAD",description:"The GET method requests a representation of the specified resource. Requests using GET should only retrieve data."},{name:"POST",description:"The POST method is used to submit an entity to the specified resource, often causing a change in state or side effects on the server."},{name:"PUT",description:"The PUT method replaces all current representations of the target resource with the request payload."},{name:"DELETE",description:"The DELETE method deletes the specified resource."},{name:"CONNECT",description:"The CONNECT method establishes a tunnel to the server identified by the target resource."},{name:"OPTIONS",description:"The OPTIONS method is used to describe the communication options for the target resource."},{name:"TRACE",description:"The TRACE method performs a message loop-back test along the path to the target resource."},{name:"PATCH",description:"The PATCH method is used to apply partial modifications to a resource."}]);I.requestHeaderProvider.push(t=>V(t)?[{name:"A-IM",description:"Acceptable instance-manipulations for the request."},{name:"Accept",description:"Media type(s)\xA0that is/are acceptable for the response. See\xA0Content negotiation."},{name:"Accept-Charset",description:"Character sets that are acceptable."},{name:"Accept-Datetime",description:"Acceptable version in time."},{name:"Accept-Encoding",description:"List of acceptable encodings. See\xA0HTTP compression."},{name:"Accept-Language",description:"List of acceptable human languages for response. See\xA0Content negotiation."},{name:"Access-Control-Request-Method",description:"Initiates a request for\xA0cross-origin resource sharing\xA0with\xA0Origin\xA0(below)."},{name:"Access-Control-Request-Headers",description:"Initiates a request for\xA0cross-origin resource sharing\xA0with\xA0Origin\xA0(below)."},{name:"Authorization",description:"Authentication credentials for\xA0HTTP authentication."},{name:"Cache-Control",description:"Used to specify directives that\xA0must\xA0be obeyed by all caching mechanisms along the request-response chain."},{name:"Connection",description:"Control options for the current connection and list of hop-by-hop request fields. Must not be used with HTTP/2."},{name:"Content-Encoding",description:"The type of encoding used on the data. See\xA0HTTP compression."},{name:"Content-Length",description:"The length of the request body in\xA0octets\xA0(8-bit bytes)."},{name:"Content-MD5",description:"A\xA0Base64-encoded binary\xA0MD5\xA0sum of the content of the request body."},{name:"Content-Type",description:"The\xA0Media type\xA0of the body of the request (used with POST and PUT requests)."},{name:"Cookie",description:"An\xA0HTTP cookie\xA0previously sent by the server with\xA0Set-Cookie\xA0(below)."},{name:"Date",description:'The date and time at which the message was originated (in "HTTP-date" format as defined by\xA0RFC 7231 Date/Time Formats).'},{name:"Expect",description:"Indicates that particular server behaviors are required by the client."},{name:"Forwarded",description:"Disclose original information of a client connecting to a web server through an HTTP proxy."},{name:"From",description:"The email address of the user making the request."},{name:"Host",description:"The domain name of the server (for\xA0virtual hosting), and the\xA0TCP port\xA0number on which the server is listening. The\xA0port\xA0number may be omitted if the port is the standard port for the service requested. Mandatory since HTTP/1.1.\xA0If the request is generated directly in HTTP/2, it should not be used."},{name:"HTTP2-Settings",description:"A request that upgrades from HTTP/1.1 to HTTP/2 MUST include exactly one\xA0HTTP2-Setting\xA0header field. The\xA0HTTP2-Settings\xA0header field is a connection-specific header field that includes parameters that govern the HTTP/2 connection, provided in anticipation of the server accepting the request to upgrade."},{name:"If-Match",description:"Only perform the action if the client supplied entity matches the same entity on the server. This is mainly for methods like PUT to only update a resource if it has not been modified since the user last updated it."},{name:"If-Modified-Since",description:"Allows a\xA0304 Not Modified\xA0to be returned if content is unchanged."},{name:"If-None-Match",description:"Allows a\xA0304 Not Modified\xA0to be returned if content is unchanged, see\xA0HTTP ETag."},{name:"If-Range",description:"If the entity is unchanged, send me the part(s) that I am missing; otherwise, send me the entire new entity."},{name:"If-Unmodified-Since",description:"Only send the response if the entity has not been modified since a specific time."},{name:"Max-Forwards",description:"Limit the number of times the message can be forwarded through proxies or gateways."},{name:"Origin",description:"Initiates a request for\xA0cross-origin resource sharing\xA0(asks server for\xA0Access-Control-*\xA0response fields)."},{name:"Pragma",description:"Implementation-specific fields that may have various effects anywhere along the request-response chain."},{name:"Proxy-Authorization",description:"Authorization credentials for connecting to a proxy."},{name:"Range",description:"Request only part of an entity. Bytes are numbered from 0. See\xA0Byte serving."},{name:"Referer",description:'This is the address of the previous web page from which a link to the currently requested page was followed. (The word "referrer" has been misspelled in the RFC as well as in most implementations to the point that it has become standard usage and is considered correct terminology)'},{name:"TE",description:'The transfer encodings the user agent is willing to accept: the same values as for the response header field Transfer-Encoding can be used, plus the "trailers" value (related to the "chunked" transfer method) to notify the server it expects to receive additional fields in the trailer after the last, zero-sized, chunk. Only\xA0trailers\xA0is supported in HTTP/2.'},{name:"Trailer",description:"The Trailer general field value indicates that the given set of header fields is present in the trailer of a message encoded with\xA0chunked transfer coding."},{name:"Transfer-Encoding",description:"The form of encoding used to safely transfer the entity to the user.\xA0Currently defined methods\xA0are:\xA0chunked, compress, deflate, gzip, identity. Must not be used with HTTP/2"},{name:"User-Agent",description:"The\xA0user agent string\xA0of the user agent."},{name:"Upgrade",description:"Ask the server to upgrade to another protocol. Must not be used in HTTP/2."},{name:"Via",description:"Informs the server of proxies through which the request was sent."},{name:"Warning",description:"A general warning about possible problems with the entity body."},{name:"Upgrade-Insecure-Requests",description:"Tells a server which (presumably in the middle of a HTTP -> HTTPS migration) hosts mixed content that the client would prefer redirection to HTTPS and can handle\xA0Content-Security-Policy: upgrade-insecure-requests Must not be used with HTTP/2"},{name:"X-Requested-With",description:"Mainly used to identify\xA0Ajax\xA0requests (most\xA0JavaScript frameworks\xA0send this field with value of\xA0XMLHttpRequest); also identifies Android apps using WebView"},{name:"DNT",description:"Requests a web application to disable their tracking of a user. This is Mozilla`s version of the X-Do-Not-Track header field (since\xA0Firefox 4.0\xA0Beta 11).\xA0Safari\xA0and\xA0IE9\xA0also have support for this field.\xA0On March 7, 2011, a draft proposal was submitted to IETF.\xA0The\xA0W3C\xA0Tracking Protection Working Group is producing a specification."},{name:"X-Forwarded-For",description:"A\xA0de facto\xA0standard\xA0for identifying the originating IP address of a client connecting to a web server through an HTTP proxy or load balancer. Superseded by\xA0Forwarded\xA0header."},{name:"X-Forwarded-Host",description:"A\xA0de facto\xA0standard\xA0for identifying the original host requested by the client in the\xA0Host\xA0HTTP request header, since the host name and/or port of the reverse proxy (load balancer) may differ from the origin server handling the request. Superseded by\xA0Forwarded\xA0header."},{name:"X-Forwarded-Proto",description:"A\xA0de facto\xA0standard\xA0for identifying the originating protocol of an HTTP request, since a reverse proxy (or a load balancer) may communicate with a web server using HTTP even if the request to the reverse proxy is HTTPS. An alternative form of the header (X-ProxyUser-Ip) is used by Google clients talking to Google servers. Superseded by\xA0Forwarded\xA0header."},{name:"Front-End-Https",description:"Non-standard header field used by Microsoft applications and load-balancers"},{name:"X-Http-Method-Override",description:"Requests a web application to override the method specified in the request (typically POST) with the method given in the header field (typically PUT or DELETE). This can be used when a user agent or firewall prevents PUT or DELETE methods from being sent directly (note that this is either a bug in the software component, which ought to be fixed, or an intentional configuration, in which case bypassing it may be the wrong thing to do)."},{name:"X-ATT-DeviceId",description:"Allows easier parsing of the MakeModel/Firmware that is usually found in the User-Agent String of AT&T Devices"},{name:"X-Wap-Profile",description:"Links to an XML file on the Internet with a full description and details about the device currently connecting. In the example to the right is an XML file for an AT&T Samsung Galaxy S2."},{name:"Proxy-Connection",description:"Implemented as a misunderstanding of the HTTP specifications. Common because of mistakes in implementations of early HTTP versions. Has exactly the same functionality as standard Connection field. Must not be used with HTTP/2."},{name:"X-UIDH",description:'Server-side\xA0deep packet insertion\xA0of a unique ID identifying customers of\xA0Verizon Wireless; also known as "perma-cookie" or "supercookie"'},{name:"X-Csrf-Token",description:"Used to prevent\xA0cross-site request forgery. Alternative header names are:\xA0X-CSRFToken\xA0and\xA0X-XSRF-TOKEN"},{name:"X-Request-ID",description:"Correlates HTTP requests between a client and server."},{name:"X-Correlation-ID",description:"Correlates HTTP requests between a client and server."},{name:"Save-Data",description:"The Save-Data client hint request header available in Chrome, Opera, and Yandex browsers lets developers deliver lighter, faster applications to users who opt-in to data saving mode in their browser."}]:[]);var sr=require("tough-cookie");var co=class{constructor(){this.id="cookieJar"}async beforeTrigger(e){let{request:r,httpRegion:o,config:s,options:n}=e.args[0];if(V(r)&&!o.metaData.noCookieJar&&(s!=null&&s.cookieJarEnabled)){let i=this.getCookieStorePrefix(e.args[0]),a=P.userSessions.filter(c=>c.type==="Cookie"&&c.id.startsWith(i)),l=new sr.MemoryCookieStore;for(let c of a)c.cookie&&l.putCookie(c.cookie,h=>{h&&p.info(h)});n.memoryStore=l;let d={};s.cookieJarEnabled!==!0&&Object.assign(d,s.cookieJarEnabled);let u=new sr.CookieJar(l,d);r.options||(r.options={}),r.options.cookieJar=u}return!0}async afterTrigger(e){let{options:r}=e.args[0],o=r.memoryStore;if(o&&o instanceof sr.MemoryCookieStore){o.getAllCookies((n,i)=>{if(!n)for(let a of i){let l={id:`${this.getCookieStorePrefix(e.args[0])}_${a.toString()}`,title:`${a.domain} ${a.path} ${a.key}`,description:`${a}`,type:"Cookie",details:Object.fromEntries(Object.entries(a).map(([d,u])=>u?u instanceof Date?[d,u.toISOString()]:[d,u]:[]).filter(d=>d.length>0)),cookie:a};P.setUserSession(l)}});let s=P.userSessions.filter(n=>n.type==="Cookie");for(let n of s)n.cookie&&o.putCookie(n.cookie,i=>{i&&p.info(i)})}return!0}getCookieStorePrefix(e){var r,o;return`Cookies_${J(e.activeEnvironment)}_${((o=(r=e.httpFile.rootDir)==null?void 0:r.toString)==null?void 0:o.call(r))||"none"}`}};var jl=require("tough-cookie");async function Fl(t,e,r){var s;let{request:o}=r;if(e.toLowerCase()==="cookie"&&V(o)&&o.url&&((s=o.options)==null?void 0:s.cookieJar)instanceof jl.CookieJar){if(m(t))o.options.cookieJar.setCookie(t,o.url);else if(Array.isArray(t))for(let n of t)await o.options.cookieJar.setCookie(n,o.url);return}return t}var Wl=require("crypto"),Ql=require("url"),zl=require("uuid");var Vl=require("filesize"),fo=T(require("got")),Bl=require("http-proxy-agent"),Nl=require("https-proxy-agent"),Ul=T(require("lodash/merge")),Gl=require("socks-proxy-agent");async function Kl(t,e){try{let r=Qs(t,e),s=await(0,fo.default)(t.url||"",r);return lt(s,t)}catch(r){if(r instanceof fo.CancelError)return!1;throw r}}function Qs(t,e){var s;let{config:r}=e,o=(0,Ul.default)({decompress:!0,retry:0,throwHttpErrors:!1,allowGetBody:!0},r==null?void 0:r.request,{method:t.method,headers:t.headers,body:t.body,timeout:t.timeout},t.options);return t.noRedirect&&(o.followRedirect=!1),t.noRejectUnauthorized&&(o.https=((s=t.options)==null?void 0:s.https)||{},o.https.rejectUnauthorized=!1),jm(o,t.proxy),Fm(o.headers),p.debug("request",o),o}function jm(t,e){if(e)if(e.startsWith("socks://")){let r=new Gl.SocksProxyAgent(e);t.agent={http:r,https:r}}else t.agent={http:new Bl.HttpProxyAgent(e),https:new Nl.HttpsProxyAgent(e)}}function Fm(t){if(t){for(let[e,r]of Object.entries(t))if(typeof r<"u"){let o;Array.isArray(r)?o=r.map(s=>b(s)||s):o=b(r)||"",t[e]=o}}}function lt(t,e){var r;return{name:`${t.statusCode} - ${e.method||"GET"} ${e.url}`,statusCode:t.statusCode,protocol:`HTTP/${t.httpVersion}`,statusMessage:t.statusMessage,body:t.body,rawHeaders:t.rawHeaders,rawBody:t.rawBody,headers:t.headers,timings:t.timings.phases,httpVersion:t.httpVersion,request:{protocol:"HTTP",method:t.request.options.method,url:`${t.request.options.url}`,headers:t.request.options.headers,body:zs(t.request.options.body)},contentType:Ze(t.headers),meta:{ip:t.ip,redirectUrls:t.redirectUrls,size:(0,Vl.filesize)(t.rawHeaders.map(o=>o.length).reduce((o,s)=>o+s,0)+(((r=t.rawBody)==null?void 0:r.length)||0))}}}function zs(t){if(typeof t=="string"||Buffer.isBuffer(t))return t}var Vm=/^\s*(digest)\s+(?<user>[^\s]*)\s+(?<password>([^\s]+.*))$/iu,Bm=/^\s*(digest)\s+(?<user>.*):(?<password>.*)$/iu;async function Jl(t,e,r){let{request:o}=r;if(e.toLowerCase()==="authorization"&&m(t)&&V(o)){let s=Bm.exec(t)||Vm.exec(t);if(s&&s.groups&&s.groups.user&&s.groups.password){o.options||(o.options={}),o.options.hooks||(o.options.hooks={}),o.options.hooks.afterResponse||(o.options.hooks.afterResponse=[]),o.options.hooks.afterResponse.push(Nm(s.groups.user,s.groups.password,r));return}}return t}function Nm(t,e,r){return async function(s,n){let i=s.headers["www-authenticate"];if(s.statusCode===401&&i&&i.toLowerCase().startsWith("digest")){let a=lt(s,{url:s.request.requestUrl});await se(a,r);let l=new Ql.URL(s.url),d={qop:"",algorithm:"",realm:"",nonce:"",opaque:""};Km(d,i);let u=/(^|,)\s*auth\s*($|,)/u.test(d.qop)&&"auth",c=u&&"00000001",h=u&&(0,zl.v4)().replace(/-/gu,""),R=Gm(d.algorithm,t,e,d.realm,d.nonce,h),w=nr(`${s.request.options.method}:${l.pathname}`),$=nr(u?`${R}:${d.nonce}:${c}:${h}:${u}:${w}`:`${R}:${d.nonce}:${w}`);return n({headers:{authorization:`Digest ${Um({username:t,realm:d.realm,nonce:d.nonce,uri:l.pathname,qop:u,response:$,nc:c,cnonce:h,algorithm:d.algorithm,opaque:d.opaque})}`}})}return s}}function Um(t){let e=[];for(let[r,o]of Object.entries(t))o&&(["qop","nc","algorithm"].indexOf(r)>=0?e.push(`${r}=${o}`):e.push(`${r}="${o}"`));return e.join(", ")}function nr(t){return(0,Wl.createHash)("md5").update(t).digest("hex")}function Gm(t,e,r,o,s,n){let i=nr(`${e}:${o}:${r}`);return n&&(t==null?void 0:t.toLowerCase())==="md5-sess"?nr(`${i}:${s}:${n}`):i}function Km(t,e){for(let r of e.split(",")){let o=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/giu.exec(r);o&&(t[o[1]]=o[2]||o[3])}}var ir=T(require("got"));var go=class extends te{constructor(r,o){super();this.request=r;this.context=o}get reportMessage(){return`perform Http Request (${this.request.url})`}get supportsStreaming(){return!1}get nativeClient(){return ir.default}async connect(){return this.nativeClient}async send(r){if(V(this.request)&&this.request.url)try{let o=Qs(this.request,this.context);r&&(o.body=ae(r)),this.cancelableRequest=(0,ir.default)(this.request.url,o),this.registerEvents(this.cancelableRequest);let s=await this.cancelableRequest;this.onMessage("message",lt(s,this.request))}catch(o){if(o instanceof ir.CancelError)return;throw o instanceof TypeError&&o.message==="Invalid URL"&&(o.message=`Invalid URL: ${o.input||this.request.url}`),o}finally{delete this.cancelableRequest}}disconnect(r){var o;r&&((o=this.cancelableRequest)==null||o.cancel(),this.onDisconnect())}registerEvents(r){r.on("downloadProgress",s=>{this.onProgress(s.percent)});let o=s=>(...n)=>{this.onMetaData(s,{protocol:"HTTP",statusCode:0,message:n.length>0?`${b(n[0])}`:void 0,body:{...n}})};r.on("redirect",o("redirect")),r.on("retry",o("retry")),r.on("downloadProgress",o("downloadProgress")),r.on("uploadProgress",o("uploadProgress"))}};async function Xl(t,e){var r,o;if(t&&V(t)){t.options||(t.options={}),(r=t.options)!=null&&r.hooks||(t.options.hooks={}),(o=t.options)!=null&&o.hooks.beforeRedirect||(t.options.hooks.beforeRedirect=[]),t.options.hooks.beforeRequest||(t.options.hooks.beforeRequest=[]);let s;t.options.hooks.beforeRequest.push(n=>{s={protocol:"HTTP",method:n.method,url:`${n.url}`,headers:n.headers,body:zs(n.body)}}),t.options.hooks.beforeRedirect.push(async(n,i)=>{let a=lt(i,s||{url:b(n.url)||""});await se(a,e)})}}function Yl(t,e,r){return t==="postRedirectGet"?(r.httpRegion.hooks.onRequest.addHook("postRedirectGet",async o=>{V(o)&&(o.options||(o.options={}),o.options.hooks||(o.options.hooks={}),o.options.hooks.beforeRedirect||(o.options.hooks.beforeRedirect=[]),o.options.hooks.beforeRedirect.push(s=>{s.method="GET",s.body=void 0}))}),!0):!1}oe.exchange=Kl;oe.createRequestClient=(t,e)=>new go(t,e);function Zl(t){t.hooks.parseMetaData.addHook("postRedirectGet",Yl),t.hooks.execute.addInterceptor(new co),t.hooks.replaceVariable.addHook("aws",$l),t.hooks.replaceVariable.addHook("basicAuth",Il),t.hooks.replaceVariable.addHook("clientCertificate",Ml),t.hooks.replaceVariable.addHook("digestAuth",Jl),t.hooks.replaceVariable.addHook("cookie",Fl),t.hooks.onRequest.addHook("logHttpRedirect",Xl)}var At=class{constructor(e,r,o){this.extensions=e;this.beginCodeBlock=r;this.endCodeBlock=o}async beforeTrigger(e){let r=e.args[0],o=e.args[1];if(g.hasExtension(o.httpFile.fileName,...this.extensions)){let s=this.getHttpBlockLines(o.lines,o.data);e.args[0]=function*(i){if(s.length>0){let a=r(!0);for(let l of a){let d=s.find(u=>u.startLine<=l.line&&l.line<u.endLine);if(d)if(d.startLine===l.line)yield{line:l.line,textLine:"###"};else{if(!i&&st.test(l.textLine))break;yield l}else break}}}}return!0}getHttpBlockLines(e,r){if(r.codeBlocks)return r.codeBlocks;let o=[],s=-1;for(let n=0;n<e.length;n++){let i=e[n];s<0?Array.isArray(this.beginCodeBlock)?e.length>n+this.beginCodeBlock.length&&this.beginCodeBlock.every((a,l)=>a.test(e[n+l]))&&(s=n+this.beginCodeBlock.length-1,n+=this.beginCodeBlock.length-1):this.beginCodeBlock.test(i)&&(s=n):this.endCodeBlock.test(i)&&(o.push({startLine:s,endLine:n}),s=-1)}return r.codeBlocks=o,o}};var ho=class extends At{constructor(){super(["adoc","asciidoc","asc"],[/^\[source,http\]\s*$/iu,/^----\s*$/u],/^----\s*$/u);this.id="asciidoc"}};var yo=class extends At{constructor(){super(["md","markdown","mdown","mkdn","mdtxt","mdtext","text","rmd"],/^```\s*(http|rest)$/iu,/^```\s*$/u);this.id="markdown"}};function ed(t){t.hooks.parse.addInterceptor(new yo),t.hooks.parse.addInterceptor(new ho)}var pe=require("crypto");var bo=class{constructor(){this.hmac=new Xs}sha1(){return new Te((0,pe.createHash)("sha1"))}sha256(){return new Te((0,pe.createHash)("sha256"))}sha384(){return new Te((0,pe.createHash)("sha384"))}sha512(){return new Te((0,pe.createHash)("sha512"))}md5(){return new Te((0,pe.createHash)("md5"))}},Te=class t{constructor(e){this.hash=e}updateWithText(e,r){let o=Rt(r),s=this.hash.update(Buffer.from(e,o));return new t(s)}updateWithHex(e){let r=this.hash.update(Buffer.from(e,"hex"));return new t(r)}updateWithBase64(e,r){let o=this.hash.update(Buffer.from(e,r?"base64url":"base64"));return new t(o)}digest(){return new Js(this.hash)}},Js=class{constructor(e){this.hash=e}toHex(){return this.hash instanceof pe.Hmac?this.hash.digest("hex"):this.hash.digest("hex")}toBase64(e){let r=e?"base64url":"base64";return this.hash instanceof pe.Hmac?this.hash.digest(r):this.hash.digest(r)}},Xs=class{sha1(){return new dt("sha1")}sha256(){return new dt("sha256")}sha384(){return new dt("sha384")}sha512(){return new dt("sha512")}md5(){return new dt("md5")}},dt=class{constructor(e){this.algorithm=e}withTextSecret(e,r){let o=(0,pe.createHmac)(this.algorithm,Buffer.from(e,Rt(r)));return new Te(o)}withHexSecret(e){let r=(0,pe.createHmac)(this.algorithm,Buffer.from(e,"hex"));return new Te(r)}withBase64Secret(e,r){let o=(0,pe.createHmac)(this.algorithm,Buffer.from(e,r?"base64url":"base64"));return new Te(o)}};var td=require("assert");var ut=class{constructor(e){this.context=e;this.userSession=this.getIntellijSession()}getIntellijSession(){let e="intellij_global_cache",r=P.getUserSession(e);if(this.isIntellijGlobalCacheSession(r))return r;let o={id:e,title:"Intellij Cache",description:"Global Cache for all Intellij Variables",details:{},type:"intellij_global_cache"};return P.setUserSession(o),o}isIntellijGlobalCacheSession(e){return!!(e!=null&&e.id)&&!!e.title}set(e,r){this.userSession.details[e]=r,_({[e]:r},this.context)}get(e){return this.context.variables[e]}isEmpty(){return Object.entries(this.userSession.details).length===0}clear(e){delete this.userSession.details[e],ot(e,this.context)}clearAll(){for(let[e]of Object.entries(this.userSession.details))this.clear(e)}};var xo=class{constructor(e){this.context=e;this.global=new ut(e)}test(e,r){tr(this.context)(e,r)}assert(e,r){(0,td.ok)(e,r)}log(e){this.context.scriptConsole&&this.context.scriptConsole.info(e)}exit(){var e;(e=this.context.scriptConsole)==null||e.warn("exit not supported")}};var md=require("crypto"),cd=T(require("open"));var rd=require("lodash"),od=T(require("lodash/get")),sd=require("url");var Wm="http://localhost:3000/callback",nd="oauth2";function Qm(t,e,r){let o=`${r}_${e}`,s=t[o],n=Object.entries(t).filter(([i])=>i.toLowerCase()===o.toLowerCase()).map(([,i])=>i);return n.length===1?n.pop():(s===void 0&&(s=(0,od.default)(t,`${r}.${e}`)),s)}function Lt(t,e,r){let o=i=>Qm(t,r,i),s;return e&&(s=o(e)),s===void 0&&(s=o(nd)),Hr(s,t)}function Ys(t,e){let r=d=>{let u=Lt(e,t,d);return xe(u)},o=d=>{let u=Lt(e,t,d);return Array.isArray(u)?u.map(c=>xe(c)):xe(u)},s=(d,u)=>{let c=xe(Lt(e,t,d));try{return new sd.URL(c||u)}catch{throw new Error(`Expected a valid URL, but received ${c}`)}},n=d=>{let u=Lt(e,t,d);if(typeof u=="function")return u},i=(d,u=!1)=>{let c=Lt(e,t,d);return G(c,u)},a=(d,u=void 0)=>{let c=Lt(e,t,d);return S(c)||u};return{variablePrefix:t||nd,authorizationEndpoint:r("authorizationEndpoint"),deviceCodeEndpoint:r("deviceCodeEndpoint"),tokenEndpoint:r("tokenEndpoint"),clientId:r("clientId"),clientSecret:r("clientSecret"),responseType:r("responseType"),responseMode:r("responseMode"),audience:o("audience"),scope:r("scope"),resource:o("resource"),username:r("username"),password:r("password"),subjectIssuer:r("subjectIssuer")||void 0,redirectUri:s("redirectUri",Wm),keepAlive:i("keepAlive",!0),useAuthorizationHeader:i("useAuthorizationHeader",!0),useDeviceCodeClientSecret:i("useDeviceCodeClientSecret"),usePkce:i("usePkce"),serverPort:a("serverPort"),interceptRequest:n("interceptRequest")}}function id(t,e){return(0,rd.isEqualWith)(t,e,(r,o,s)=>{if(s&&["redirectUri"].some(i=>i===s))return`${r}`==`${o}`})}function fe(t,e){let r=[];for(let o of e)Object.entries(t).some(([s,n])=>s===o&&!!n)||r.push(o);if(r.length>0){let o=`missing configuration: ${r.map(s=>`${t.variablePrefix}_${s}`).join(", ")}`;throw p.error(o),new Error(o)}}var ld=require("http");var Ae=[],pt,vo,Ro=0;function ko(t){Ae.push(t),zm(t.port,t.path)}function Be(t){let e=Ae.findIndex(r=>r.id===t);e>=0&&Ae.splice(e,1),Ae.length===0&&ud(60)}function dd(){vo&&(clearTimeout(vo),vo=!1,Ro=0)}function ud(t){dd();let e=t*1e3;Ro=new Date().getTime()+e,vo=setTimeout(()=>pd(),e)}function pd(){for(let t of Ae)t.reject();Ae.length=0,pt&&(dd(),pt.close(t=>{t?p.error(t):p.debug("http server closed")}),pt=!1)}function zm(t,e){if(ud(600),!pt){pt=(0,ld.createServer)((o,s)=>{try{let n="invalid",i=500,a=[];if(o.url){let l=Jm(o.url),d=o.url.split("?")[0];if(d===e){let u=Ae.find(c=>c.id===l.state);if(u){let c=u.resolve(l);a.push(ar(c.message,c.valid)),c.valid&&(i=200,Be(u.id)),n=c.statusMessage}else a.push(ar("invalid state received",!1)),a.push(`
                <script>
                  if(window.location.hash){
                    window.document.querySelector('.js-message').remove();
                    window.location.replace(\`\${window.location.href.substring(0,window.location.href.indexOf('#'))}?\${window.location.hash.substring(1)}\`);
                  }
                </script>
                <noscript>
                  ${ar("Please enable javascript for redirect or replace fragment (#) with query (?)",!1)}
                </noscript>
              `),n="invalid state received"}else if(d.startsWith("/reject")){let u=Ae.find(c=>c.id===l.id);u?(u.reject(),Be(l.id),i=200,n="listener removed",a.push(ar(`${u.name} removed`,!0))):n="listener not found"}else d.startsWith("/shutdown")&&(pd(),a.push(ar("server closed",!0)),i=200,n="server was shut down")}a.push(Xm()),s.setHeader("Content-Type","text/html"),s.writeHead(i,n),s.end(ad(a.join("")))}catch(n){p.error(n),s.end(ad(`${n}`))}}),pt.listen(t);let r=pt.address();r?p.debug(`open http server on port ${typeof r=="string"?r:r.port}`):p.debug(`open http server on port ${t}`)}}function Jm(t){return t.slice(t.indexOf("?")+1).split("&").reduce((e,r)=>{let[o,s]=r.split("=");return e[o]=s,e},{})}function ar(t,e){return`
<div class="card js-message ${e?"card--success":"card--error"}">
  <h3 class="card__title">${e?"success":"error"}</h3>
  <div class="card__message">${t}</div>
</div>`}function Xm(){let t=[];return Ae.length>0&&t.push(...Ae.map(e=>`
      <div class="card">
        <h3 class="card__title">open requests</h3>
        <div class="card__message">${e.name}</div>
        <div class="card__actions">
          <a href="/reject?id=${e.id}">remove</a>
        </div>
      </div>`)),Ro>0&&t.push(`
    <div class="card">
      <h3 class="card__title">Server Status</h3>
      <div class="card__message">automatic shutdown in ${Ym(Math.floor((Ro-new Date().getTime())/1e3))}</div>
      <div class="card__actions">
        <a href="/shutdown">shutdown</a>
      </div>
    </div>`),t.join("")}function Ym(t){if(t>0){let e=Math.trunc(t/60),r=t%60;return e>0?r>0?`${e}minute${e>1?"s":""} ${r} seconds`:`${e} minute${e>1?"s":""}`:`${t} seconds`}return"-"}function ad(t){return`
  <html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>httpYac</title>
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <style>
    :root{
      --light: #FAFAFA;
      --success: #4CAF50;
      --success-dark: #43A047;
      --error: #D32F2F;
      --error-dark: #C62828;
      --link-light: #E1F5FE;
      --link: #00B0FF;
      --link-dark: #0091EA;
    }
      body{
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        background-color: var(--light);
        display:flex;
        align-items: center;
        flex-direction: column;
      }

      .card{
        border-radius: 4px;
        background-color: #FFF;
        box-shadow: 0px 2px 1px -1px rgb(0 0 0 / 20%), 0px 1px 1px 0px rgb(0 0 0 / 14%), 0px 1px 3px 0px rgb(0 0 0 / 12%);
        width: 22rem;
        padding: .5rem;
        margin: auto;
        display: flex;
        flex-direction: column;
        justify-content: center;
        margin: 2rem;
      }

      .card--success{
        border-bottom: 1rem solid var(--success);
      }
      .card--success:hover{
        border-bottom: 1rem solid var(--success-dark);
      }

      .card--error{
        border-bottom: 1rem solid var(--error);
      }
      .card--error:hover{
        border-bottom: 1rem solid var(--error-dark);
      }
      .card__title{
        margin: 0 .5rem;
      }
      .card__message{
        padding: 0 .5rem;
        word-break: break-word;
      }
      .card__actions{
        padding: 1rem 0;
      }
      a {
          color: var(--link);
          text-decoration:none;
          border-radius:3px;
          cursor:pointer;
          text-transform: uppercase;
          padding: .5rem;
      }
      a:focus {
        outline-color: var(--link);
        color: var(--link);
      }
      a:hover, a:active {
          color: var(--link-dark);
          background-color: var(--link-light);
      }
    </style>
  </head>
  <body>
  <img src="https://raw.githubusercontent.com/AnWeber/vscode-httpyac/master/icon.png" alt="HttpYac Logo" />
${t}
</body>
</html>
`}async function ge(t,e,r){var o,s;if(t){let n=new Date().getTime();t.headers||(t.headers={"content-type":"application/x-www-form-urlencoded"}),t.headers&&e.config.useAuthorizationHeader&&e.config.clientId&&e.config.clientSecret?t.headers.authorization=`Basic ${Buffer.from(`${e.config.clientId}:${e.config.clientSecret}`).toString("base64")}`:t.body=`${t.body}&${N({client_id:e.config.clientId,client_secret:e.config.clientSecret})}`,await wo(t,e.config,r);let i=await((s=(o=oe).exchange)==null?void 0:s.call(o,{options:{},...t},{isMainContext:!1}));if(i&&(i.tags=["auth","oauth2","automatic"],ve(r)&&(i.tags=i.tags??[],i.tags.push("httpRegion"),await se(i,r)),i.statusCode<400&&m(i.body)))return lr(JSON.parse(i.body),n,e)}return!1}async function wo(t,e,r){var o,s,n,i;ve(r)&&(((s=(o=r.config)==null?void 0:o.request)==null?void 0:s.rejectUnauthorized)!==void 0&&(t.noRejectUnauthorized=!G((i=(n=r.config)==null?void 0:n.request)==null?void 0:i.rejectUnauthorized)),e.interceptRequest&&await e.interceptRequest(t,r))}function lr(t,e,r){if(Zm(t)){let o=et(t.access_token);return o&&p.debug(k(o,2)),{...r,type:"OAuth2",time:e,accessToken:t.access_token,expiresIn:t.expires_in??(o==null?void 0:o.exp),refreshToken:t.refresh_token,refreshExpiresIn:t.refresh_expires_in,timeSkew:o!=null&&o.iat?Math.floor(e/1e3)-o.iat:0,idToken:t.id_token,scope:t.scope}}return!1}function Zm(t){let e=t;return e&&!!e.access_token}var Zs=class{supportsFlow(e){return["authorization_code","code"].indexOf(e)>=0}getCacheKey(e){return fe(e,["tokenEndpoint","authorizationEndpoint","clientId"]),`authorization_code_${e.variablePrefix}_${e.clientId}_${e.tokenEndpoint}`}async perform(e,r){let o=this.getCacheKey(e);return o?new Promise((s,n)=>{var l,d,u;let i=Je(),a=e.usePkce?Je(64):void 0;try{x(r,"execute OAuth2 authorization_code flow");let c=`${e.authorizationEndpoint}${e.authorizationEndpoint&&e.authorizationEndpoint.indexOf("?")>0?"&":"?"}${N({client_id:e.clientId,scope:e.scope??"openid",response_type:"code",state:i,audience:e.audience,resource:e.resource,redirect_uri:(l=e.redirectUri)==null?void 0:l.toString(),...a?{code_challenge:this.createSha256(a),code_challenge_method:"S256"}:{}})}`,h;r.progress&&(h=r.progress.register(()=>{Be(i),s(!1)})),ko({id:i,port:e.serverPort||Number((d=e.redirectUri)==null?void 0:d.port),path:((u=e.redirectUri)==null?void 0:u.pathname)||"",name:`authorization for ${e.clientId}: ${e.authorizationEndpoint}`,resolve:R=>{var w;if(R.code&&R.state===i){h&&h();let $=ge({url:e.tokenEndpoint||"",method:"POST",body:N({grant_type:"authorization_code",scope:e.scope??"opendid",code:R.code,redirect_uri:(w=e.redirectUri)==null?void 0:w.toString(),...a?{code_verifier:a}:{}})},{config:e,id:o,title:`authorization_code: ${e.clientId}`,description:`${e.variablePrefix} - ${e.tokenEndpoint}`,details:{clientId:e.clientId,tokenEndpoint:e.tokenEndpoint,grantType:"authorization_code"}},r);return s($),{valid:!0,message:"code received.",statusMessage:"code and state valid. starting code exchange"}}return R.error_description?{valid:!1,message:decodeURIComponent(R.error_description),statusMessage:"no access_token received"}:{valid:!1,message:"no code received",statusMessage:"no code received"}},reject:n}),x(r,`authorization_code browser authentication pending: ${c}`),(0,cd.default)(c)}catch(c){Be(i),n(c)}}):!1}createSha256(e){return(0,md.createHash)("sha256").update(e).digest("base64").replace(/=/gu,"").replace(/\+/gu,"-").replace(/\//gu,"_")}},fd=new Zs;var en=class{supportsFlow(e){return["client_credentials","client"].indexOf(e)>=0}getCacheKey(e){return fe(e,["tokenEndpoint","clientId","clientSecret"]),`client_credentials_${e.variablePrefix}_${e.clientId}_${e.tokenEndpoint}`}async perform(e,r){let o=this.getCacheKey(e);return o?(x(r,"execute OAuth2 client_credentials flow"),ge({url:e.tokenEndpoint||"",method:"POST",body:N({grant_type:"client_credentials",scope:e.scope,audience:e.audience,resource:e.resource})},{config:e,id:o,title:`clientCredentials: ${e.clientId}`,description:`${e.variablePrefix} - ${e.tokenEndpoint}`,details:{clientId:e.clientId,tokenEndpoint:e.tokenEndpoint,grantType:"client_credentials"}},r)):!1}},gd=new en;var hd=T(require("open"));var tn=class{supportsFlow(e){return["device_code","device"].indexOf(e)>=0}getCacheKey(e){return fe(e,["tokenEndpoint","deviceCodeEndpoint","clientId"]),`device_code_${e.variablePrefix}_${e.clientId}_${e.tokenEndpoint}`}async perform(e,r){var s,n,i,a;let o=this.getCacheKey(e);if(o){x(r,"execute device_code authorization flow");let l=new Date().getTime(),d=await this.requestDeviceAuthorization(e,r);if(d&&ve(r)&&await se(d,r),d&&d.statusCode===200&&m(d.body)){x(r,"device_code received");let u=JSON.parse(d.body),h=(S(u.interval)||5)*1e3;for(this.showUserCode(u);new Date().getTime()-l<Number(u.expires_in)*1e3;)try{if(await Se(h),(n=(s=r.progress)==null?void 0:s.isCanceled)!=null&&n.call(s))return p.trace("process canceled by user"),!1;let R=new Date().getTime(),w=await this.authenticateUser(e,u,r);if(w&&m(w.body)){w.tags=["auth","oauth2","deviceCode","automatic"];let $=JSON.parse(w.body);if(w.statusCode===200)return x(r,"accessToken received"),await this.logResponse(w,r),lr($,R,{config:e,id:o,title:`deviceCode: ${e.clientId}`,description:`${e.variablePrefix} - ${e.tokenEndpoint}`,details:{clientId:e.clientId,tokenEndpoint:e.tokenEndpoint,grantType:"device_code"}});if(x(r,`device code ${$.error}`),["slow_down","authorization_pending"].indexOf($.error)>=0)($.error==="slow_down"||w.statusCode===408)&&(h+=5e3,p.debug(`DeviceCode Flow increase interval: ${h/1e3}s`));else{if($.error&&["access_denied","expired_token","bad_verification_code"].indexOf($.error)>=0)return p.debug(`DeviceCode Flow aborted: ${$.error_description||""}`),await this.logResponse(w,r),!1;if(await((a=(i=q).showWarnMessage)==null?void 0:a.call(i,`Unknown error code ${$.error}`,"Continue","Cancel"))==="Cancel")return await this.logResponse(w,r),!1}}else return p.debug("device code received invalid response"),!1}catch(R){return p.debug("error in deviceCodeFlow",R),!1}}}return!1}async logResponse(e,r){ve(r)&&await se(e,r)}async authenticateUser(e,r,o){var i,a;let s={url:e.tokenEndpoint||"",method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:N({client_id:e.clientId,grant_type:"urn:ietf:params:oauth:grant-type:device_code",device_code:r.device_code})};await wo(s,e,o);let n=await((a=(i=oe).exchange)==null?void 0:a.call(i,s,{isMainContext:!1}));return n&&ve(o)&&await se(n,o),n}async requestDeviceAuthorization(e,r){var n,i;let o={url:e.deviceCodeEndpoint||"",method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},body:N({client_id:e.clientId,client_secret:e.useDeviceCodeClientSecret?e.clientSecret:void 0,scope:e.scope??"openid",audience:e.audience,resource:e.resource})};await wo(o,e,r);let s=await((i=(n=oe).exchange)==null?void 0:i.call(n,o,{isMainContext:!1}));return s&&ve(r)&&(s.tags=["auth","oauth2","deviceCode","automatic"],await se(s,r)),s}showUserCode(e){let r=e.message||`To sign in, use a web browser to open the page ${e.verification_uri_complete} and enter the code ${e.user_code} to authenticate.`;p.info(r),p.info(`Verification_Uri: ${e.verification_uri_complete||e.verification_uri}`),p.info(`User_Code: ${e.user_code}`);let o=async()=>{var s,n;await((n=(s=q).setClipboard)==null?void 0:n.call(s,e.user_code)),await(0,hd.default)(e.verification_uri_complete||e.verification_uri)};q.showInformationMessage?q.showInformationMessage(r,"Open").then(s=>{s&&o()}):o()}},yd=new tn;var bd=T(require("open"));var rn=class{supportsFlow(e){return["implicit","hybrid"].indexOf(e)>=0}getCacheKey(e){return fe(e,["tokenEndpoint","authorizationEndpoint","clientId"]),`implicit_${e.variablePrefix}_${e.clientId}_${e.tokenEndpoint}`}async perform(e,r){let o=this.getCacheKey(e);return o?new Promise((s,n)=>{var a,l,d;x(r,"execute OAuth2 implicit flow");let i=Je();try{let u=`${e.authorizationEndpoint}${e.authorizationEndpoint&&e.authorizationEndpoint.indexOf("?")>0?"&":"?"}${N({client_id:e.clientId,scope:e.scope??"openid",response_type:e.responseType??"token",nonce:Je(),state:i,response_mode:e.responseMode,audience:e.audience,resource:e.resource,redirect_uri:(a=e.redirectUri)==null?void 0:a.toString()})}`,c;r.progress&&(c=r.progress.register(()=>{Be(i),s(!1)})),ko({id:i,port:e.serverPort||Number((l=e.redirectUri)==null?void 0:l.port),path:((d=e.redirectUri)==null?void 0:d.pathname)||"",name:`authorization for ${e.clientId}: ${e.authorizationEndpoint}`,resolve:h=>{var R;if(h.state===i){if(h.code){let w=ge({url:e.tokenEndpoint||"",method:"POST",body:N({grant_type:"authorization_code",scope:e.scope,code:h.code,redirect_uri:(R=e.redirectUri)==null?void 0:R.toString()})},{config:e,id:o,title:`implicit: ${e.clientId}`,description:`${e.variablePrefix} - ${e.tokenEndpoint}`,details:{clientId:e.clientId,tokenEndpoint:e.tokenEndpoint,grantType:"implicit"}},r);return s(w),{valid:!0,message:"code received.",statusMessage:"code valid. starting code exchange"}}if(h.access_token){c&&c();let w=lr(h,new Date().getTime(),{config:e,id:o,title:`implicit: ${e.clientId}`,description:e.tokenEndpoint||"",details:{clientId:e.clientId,tokenEndpoint:e.tokenEndpoint,grantType:"implicit"}});return s(w),{valid:!0,message:"access_token received.",statusMessage:"access_token and state valid."}}}return h.error_description?{valid:!1,message:decodeURIComponent(h.error_description),statusMessage:"no access_token received"}:{valid:!1,message:"no access_token received",statusMessage:"no access_token received"}},reject:n}),p.debug(`open browser: ${u}`),x(r,`implicit browser authentication pending: ${u}`),(0,bd.default)(u)}catch(u){Be(i),n(u)}}):!1}},xd=new rn;var on=class{supportsFlow(e){return["password"].indexOf(e)>=0}getCacheKey(e){return fe(e,["tokenEndpoint","clientId","username","password"]),`password_${e.variablePrefix}_${e.clientId}_${e.username}_${e.tokenEndpoint}`}async perform(e,r){let o=this.getCacheKey(e);return o?(x(r,"execute OAuth2 password flow"),ge({url:e.tokenEndpoint||"",method:"POST",body:N({grant_type:"password",scope:e.scope,username:e.username,password:e.password,audience:e.audience,resource:e.resource})},{config:e,id:o,title:`password flow: ${e.username} (${e.clientId})`,description:`${e.variablePrefix} - ${e.tokenEndpoint}`,details:{clientId:e.clientId,tokenEndpoint:e.tokenEndpoint,grantType:"password",username:e.username}},r)):!1}},vd=new on;var sn=class{isTokenExpired(e,r,o){return typeof o<"u"?e+1e3*(o-r)<new Date().getTime():!1}async perform(e,r){if(!this.isTokenExpired(e.time,e.timeSkew,e.expiresIn))return e;if(e.refreshToken&&!this.isTokenExpired(e.time,e.timeSkew,e.refreshExpiresIn)){x(r,"execute OAuth2 refresh_token flow");let{tokenEndpoint:o,scope:s,resource:n,audience:i}=e.config;return ge({url:o||"",method:"POST",body:N({grant_type:"refresh_token",refresh_token:e.refreshToken,scope:s,audience:i,resource:n})},{config:e.config,id:e.id,title:e.title,description:e.description,details:{clientId:e.config.clientId,tokenEndpoint:e.config.tokenEndpoint,grantType:"refresh_token"}},r)}return!1}},nn=new sn;var Rd=T(require("encodeurl"));var Po=class{static getCacheKey(e){return fe(e,["tokenEndpoint","clientId","clientSecret"]),`${e.tokenEndpoint}_${e.clientId}`}static async perform(e,r,o){if(r){x(o,"execute OAuth2 token exchange flow");let s=et(r.accessToken);return ge({url:e.tokenEndpoint||"",method:"POST",body:N({grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",requested_token_type:"urn:ietf:params:oauth:token-type:access_token",subject_token_type:"urn:ietf:params:oauth:token-type:access_token",scope:e.scope??"openid",subject_issuer:e.subjectIssuer||(s==null?void 0:s.iss),subject_token:(0,Rd.default)(r.accessToken),audience:e.audience,resource:e.resource})},{config:e,id:r.id,title:`${r.title} (token exchange)`,description:r.description,details:{clientId:e.clientId,tokenEndpoint:e.tokenEndpoint,grantType:"urn:ietf:params:oauth:grant-type:token-exchange"}},o)}return!1}};var kd=require("hookpoint");async function wd(t,e,r){if(e.toLowerCase()==="authorization"&&m(t)){let o=bs.exec(t);if(o&&o.groups){let s=o.groups.flow||"client_credentials";x(r,`get OAuth2 Authorization (${s})`);let n=await mt(s,o.groups.variablePrefix,r,o.groups.tokenExchangePrefix);return n?`Bearer ${n.accessToken}`:(je(r.httpRegion,{message:"OAuth2 did not retrieve AccessToken",status:"ERROR"}),kd.HookCancel)}}return t}async function mt(t,e,r,o){let s=rc(t);if(s){let n=Ys(e,r.variables),i=s.getCacheKey(n),a=Ys(o,r.variables),l=tc(i,o?a:n);if(P.removeUserSession(i),l&&(p.trace(`openid refresh token flow used: ${i}`),l=await nn.perform(l,r)),l||(p.trace(`openid flow ${t} used: ${i}`),l=await s.perform(n,r),l&&o&&(l=await Po.perform(a,l,r))),l)return p.trace(`openid flow ${t} finished`),ve(r)&&_({oauth2Session:l},r),P.setUserSession(l),Pd(i,r.variables),l}}function tc(t,e){let r=P.userSessions.find(o=>o.id===t);return Lr(r)&&id(r.config,e)?r:!1}function rc(t){return[fd,gd,yd,vd,xd].find(r=>r.supportsFlow(t))}function Pd(t,e){let r=P.userSessions.find(o=>o.id===t);if(Lr(r)&&r.expiresIn&&r.refreshToken&&r.config.keepAlive){let o=setTimeout(async()=>{let s=await nn.perform(r,{variables:e});s&&(p.trace(`token ${s.title} refreshed`),P.setUserSession(s),Pd(t,e))},(r.expiresIn-r.timeSkew)*1e3);r.delete=()=>clearTimeout(o)}}function Cd(t){t.hooks.replaceVariable.addHook("oauth2",wd),t.hooks.provideVariables.addHook("oauth2",()=>({$getOAuth2Response:mt}))}async function Hd(t,e){let r=t.trim();if(r.startsWith("$auth.token")||r.startsWith("$auth.idToken")){let o=await oc(r,e);if(o)return`${o}`}}async function oc(t,e){var o,s;let r=/^\$auth.(?<type>token|idToken)\s*\(\s*"?(?<name>[^"]*)"?\s*\)$/u.exec(t);if(r&&((o=r.groups)!=null&&o.type)&&((s=r.groups)!=null&&s.name)){let n=sc(r.groups.name,e.variables);if(!(n!=null&&n.flow))return;_({intellij_oauth2:n.config},e);let i=await mt(n.flow,"intellij_oauth2",e);return n.useIdToken||r.groups.type==="idToken"?i==null?void 0:i.idToken:i==null?void 0:i.accessToken}}function sc(t,e){var s,n,i,a;if(!ic(e.Security)){p.warn("no intellij auth security found");return}let r=(n=(s=e.Security)==null?void 0:s.Auth)==null?void 0:n[t];if(!r){p.warn(`no auth security found with name ${t}`);return}let o={variablePrefix:"__intellij_oauth2__",authorizationEndpoint:r["Auth URL"],deviceCodeEndpoint:r["Device Auth URL"],tokenEndpoint:r["Token URL"],clientId:r["Client ID"],clientSecret:r["Client Secret"],resource:Sd((i=r["Custom Request Parameters"])==null?void 0:i.resource),audience:Sd((a=r["Custom Request Parameters"])==null?void 0:a.audience),scope:r.Scope,username:r.Username,password:r.Password,useAuthorizationHeader:r["Client Credentials"]==="basic",usePkce:!!r.PKCE};return{flow:nc(r["Grant Type"]),useIdToken:r["Use ID Token"],config:o}}function Sd(t){return!t||typeof t=="string"?t:Array.isArray(t)?t.map(e=>typeof e=="string"?e:e.Value):t.Value}function nc(t){switch(t){case"Authorization Code":return"authorization_code";case"Client Credentials":return"client_credentials";case"Device Authorization":return"device_code";case"Implicit":return"implicit";case"Password":return"password";default:return}}function ic(t){let e=t;return!!(e!=null&&e.Auth)}var Td=require("uuid");function Co(t){let e=t.trim();if(["$uuid","$random.uuid"].indexOf(e)>=0)return(0,Td.v4)();if(e==="$timestamp")return b(Date.now());if(e==="$isoTimestamp")return new Date().toISOString();if(e==="$randomInt")return`${Math.floor(Math.random()*1e3)}`;if(e.startsWith("$random.integer")){let r=qd(e);if(r)return`${Math.floor(r)}`}if(e.startsWith("$random.float")){let r=qd(e);if(r)return`${r}`}if(e.startsWith("$random.alphabetic"))return ac(e);if(e.startsWith("$random.alphanumeric"))return lc(e);if(e.startsWith("$random.hexadecimal"))return dc(e);if(e.startsWith("$random.email"))return Or()}function qd(t){var r,o,s,n;let e=/^\$random.(integer|float)\s*\(\s*(?<from>-?\d+)\s*,\s*(?<to>-?\d+)\s*\)$/u.exec(t);if(e&&((r=e.groups)!=null&&r.from)&&((o=e.groups)!=null&&o.to)){let i=S((s=e.groups)==null?void 0:s.from)||0,a=S((n=e.groups)==null?void 0:n.to)||0;if(!Number.isNaN(i)&&!Number.isNaN(a)){if(i>a){let l=a;a=i,i=l}return Math.random()*(a-i)+i}}}function ac(t){var r,o;let e=/^\$random.alphabetic\s*\(\s*(?<length>-?\d+)\s*\)\s*$/u.exec(t);if(e&&((r=e.groups)!=null&&r.length)){let s=S((o=e.groups)==null?void 0:o.length);if(s)return He(s,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz")}}function lc(t){var r,o;let e=/^\$random.alphanumeric\s*\(\s*(?<length>-?\d+)\s*\)\s*$/u.exec(t);if(e&&((r=e.groups)!=null&&r.length)){let s=S((o=e.groups)==null?void 0:o.length);if(s)return He(s)}}function dc(t){var r,o;let e=/^\$random.hexadecimal\s*\(\s*(?<length>-?\d+)\s*\)\s*$/u.exec(t);if(e&&((r=e.groups)!=null&&r.length)){let s=S((o=e.groups)==null?void 0:o.length);if(s)return He(s,"1234567890ABCDEF")}}async function Ad(t,e,r){return K(t,async o=>{let s=Co(o);return s||await Hd(o,r)})}var So=class{url(){return this._url}body(){return this._body||""}constructor(e){var r,o,s,n;this._url=((r=e.request)==null?void 0:r.url)||"",this.method=((o=e.request)==null?void 0:o.method)||"",this._body=((s=e.request)==null?void 0:s.body)&&b((n=e.request)==null?void 0:n.body),this.headers=new qo(e),this.environment=new Ao(e.variables),this.variables=new ut(e)}},Ho=class{constructor(e){var r;this.url=new ln(e),this.method=((r=e.request)==null?void 0:r.method)||"",this.body=new an(e),this.headers=new qo(e),this.environment=new Ao(e.variables),this.variables=new ut(e)}},an=class{constructor(e){this.context=e}getRaw(){var e;return b((e=this.context.request)==null?void 0:e.body)||""}tryGetSubstituted(){var r;let e=dn(this.getRaw(),this.context.variables);return e&&((r=this.context.request)!=null&&r.body)&&(this.context.request.body=e),e}},qo=class{constructor(e){this.context=e}all(){var e;return(e=this.context.request)!=null&&e.headers?Object.keys(this.context.request.headers).map(r=>new To(r,this.context)):[]}findByName(e){var r;return E((r=this.context.request)==null?void 0:r.headers,e)?new To(e,this.context):null}},To=class{constructor(e,r){this.name=e;this.context=r}value(){return this.getRawValue()}getRawValue(){var e;return b(E((e=this.context.request)==null?void 0:e.headers,this.name))||""}tryGetSubstitutedValue(){var r;let e=dn(this.getRawValue(),this.context.variables);return e&&((r=this.context.request)!=null&&r.headers)&&(Ee(this.context.request.headers,this.name),this.context.request.headers[this.name]=e),e}},ln=class{constructor(e){this.context=e}getRaw(){var e;return((e=this.context.request)==null?void 0:e.url)||""}tryGetSubstituted(){var r;let e=dn(this.getRaw(),this.context.variables);return e&&((r=this.context.request)!=null&&r.body)&&(this.context.request.body=e),e}},Ao=class{constructor(e){this.variables=e}get(e){let r=b(this.variables[e]);return be(r)?null:r}};function dn(t,e){let r=t,o=[Co,s=>{let n=e[s];if(!be(n))return b(n)}];for(let s of o)r=uc(r,s);return r}function uc(t,e){if(!m(t))return t;let r,o,s=t,n=0;for(;o!==s&&n++<100;)for(o=s;(r=Jt.exec(o))!==null;){let[i,a]=r,l=e(a,i);if(typeof l<"u"&&i===t)return l;let d=b(l);typeof d<"u"&&(s=s.replace(i,()=>d))}return s}var Lo=class{constructor(e){this.body=e.parsedBody||e.body,this.status=e.statusCode,this.contentType=un(e.contentType),this.headers=new Oo(e.headers)}};function un(t){return{mimeType:(t==null?void 0:t.mimeType)||"application/octet-stream",charset:(t==null?void 0:t.charset)||"utf-8"}}var Oo=class{constructor(e){this.headers=e}valueOf(e){if(this.headers){let r=E(this.headers,e);if(r&&m(r))return r}return null}valuesOf(e){if(this.headers){let r=E(this.headers,e);if(r){if(m(r))return[r];if(Array.isArray(r))return r}}return[]}},Eo=class{constructor(e,r){this.requestClient=e;this.resolve=r;this.status=0;this.contentType=un();this.lazyHeaders={};this.body={onEachLine:(...o)=>this.onEachLine(...o),onEachMessage:(...o)=>this.onEachMessage(...o)},this.headers=new Oo(this.lazyHeaders)}onEachLine(e,r){this.onEachMessage(e,r)}onEachMessage(e,r){let o=s=>{let[,n]=s.detail;this.status=n.statusCode,Object.assign(this.headers,n.headers),this.contentType=un(n.contentType);let i=b(n.body);i&&e(i,()=>{this.requestClient.removeEventListener("message",o),this.resolve()},d=>this.requestClient.send(d))};this.requestClient.addEventListener("message",o),r&&this.requestClient.addEventListener("end",r)}};I.variableProvider.push(()=>[{name:"$uuid",description:"UUID"},{name:"$uuid",description:"UUID"},{name:"$random.uuid",description:"UUID"},{name:"$timestamp",description:"Timestamp"},{name:"$isoTimestamp",description:"ISOTimestamp"},{name:"$randomInt",description:"randomInt (0 -1000)"},{name:"$random.integer",description:"integer"},{name:"$random.float",description:"float"},{name:"$random.alphabetic",description:"Alphabetic Text"},{name:"$random.alphanumeric",description:"Alphanumeric Text"},{name:"$random.hexadecimal",description:"Hexadecimal String"},{name:"$random.email",description:"EMail"}]);var $o=class{constructor(e,r){this.scriptData=e;this.id="intellij";r&&(this.before=["requestVariableReplacer"])}isStreamingScript(e){return["onEachLine","onEachMessage"].some(r=>e.script.indexOf(r)>0)}async processOnRequest(e,r){x(r,"execute Intellij Javascript");let o=await this.loadScript(r);if(this.isStreamingScript(o))return;let s=pn(r);await this.executeScriptData(o,s,r)}async processOnStreaming(e){let r=await this.loadScript(e);if(this.scriptData=r,this.isStreamingScript(r)&&e.requestClient){let o=e.requestClient;await new Promise(s=>{let n=pn(e);n.response=new Eo(o,s),this.executeScriptData(r,n,e)})}}async processOnResponse(e,r){x(r,"execute Intellij Javascript");let o=await this.loadScript(r);if(this.isStreamingScript(o))return;let s=pn(r);s.response=new Lo(e),await this.executeScriptData(o,s,r)}async executeScriptData(e,r,o){return H.runScript?(await H.runScript(e.script,{fileName:o.httpFile.fileName,context:{console:o.scriptConsole,...r},lineOffset:e.lineOffset}),!0):!1}async loadScript(e){if(this.isIntellijScriptData(this.scriptData))try{return{script:await le(this.scriptData.fileName,e,r=>g.readFile(r,"utf-8"))||"",lineOffset:0}}catch(r){throw(e.scriptConsole||p).error(this.scriptData.fileName,r),new Error(`error loading script ${this.scriptData.fileName}`)}else return this.scriptData}isIntellijScriptData(e){return!!e.fileName}};function pn(t){let e={client:new xo(t),crypto:new bo};return t.request&&(t.httpRegion.response?e.request=new So(t):e.request=new Ho(t)),e}async function Ld(){let t=P.getUserSession("intellij_global_cache");return(t==null?void 0:t.details)||{}}async function Od(t,{httpRegion:e}){let r=t(),o=mc(r,!!e.request);if(o){let s=new $o(o.data,o.isBeforeRequest);return o.isBeforeRequest?e.hooks.onRequest.addObjHook(n=>n.processOnRequest,s):(e.hooks.onStreaming.addObjHook(n=>n.processOnStreaming,s),e.hooks.onResponse.addObjHook(n=>n.processOnResponse,s)),{nextParserLine:o.endLine,symbols:[new v({name:"Intellij Script",description:"Intellij Script",kind:"script",startLine:o.startLine,startOffset:0,endLine:o.endLine,endOffset:o.endOffset,children:o.symbols})]}}return!1}function mc(t,e){var o,s,n;let r=t.next();if(!r.done){let i=r.value.line,a=/^\s*(?<event>(<|>))\s+(?<fileName>[^\s{%}]+\s*)$/u.exec(r.value.textLine);if((o=a==null?void 0:a.groups)!=null&&o.fileName){if(a.groups.event==="<"&&e)return!1;let u=a.groups.fileName.trim();return{startLine:i,endLine:i,endOffset:r.value.textLine.length,data:{fileName:u},isBeforeRequest:a.groups.event==="<",symbols:[new v({name:"filename",description:u,kind:"path",startLine:r.value.line,startOffset:r.value.textLine.indexOf(u),endLine:r.value.line,endOffset:r.value.textLine.indexOf(u)+u.length})]}}let l=/^\s*(?<event>(<|>))\s+\{%\s*(?<script>.*)\s*%\}\s*$/u.exec(r.value.textLine);if((s=l==null?void 0:l.groups)!=null&&s.script)return l.groups.event==="<"&&e?!1:{startLine:i,endLine:i,endOffset:r.value.textLine.length,data:{script:l.groups.script,lineOffset:i},isBeforeRequest:l.groups.event==="<"};let d=/^\s*(?<event>(<|>))\s+\{%\s*$/u.exec(r.value.textLine);if((n=d==null?void 0:d.groups)!=null&&n.event){if(d.groups.event==="<"&&e)return!1;r=t.next();let u=[];for(;!r.done;){if(/^\s*%\}\s*$/u.test(r.value.textLine))return{startLine:i,endLine:r.value.line,endOffset:r.value.textLine.length,data:{script:F(u),lineOffset:i},isBeforeRequest:d.groups.event==="<"};u.push(r.value.textLine),r=t.next()}}}return!1}async function Ed(t,e,r){return K(t,async o=>{if(o.trim()==="$projectRoot")return r.httpFile.rootDir})}async function $d(t){let e=Object.keys(await Id(t));return p.info("Intellij Env Provider found environments",e),e}async function Id(t){var i;let e=[],r=a=>["http-client.env.json","http-client.private.env.json"].includes(a),o=process.env.HTTPYAC_ENV;if(o&&m(o)){let a=await z(o,t.httpFile.rootDir);a&&e.push(...await mn(a,r))}if((i=t.config)!=null&&i.envDirName){let a=await z(t.config.envDirName,t.httpFile.rootDir);a&&e.push(...await mn(a,r))}let s=g.dirname(t.httpFile.fileName);s&&await _e(s,t.httpFile.rootDir,async a=>{e.push(...await mn(a,r))});let n={};e.length>0&&p.trace(`Intellij environment files found: ${e.join(", ")}`),e.sort((a,l)=>{let d=g.toString(a),u=g.toString(l),c=d.endsWith("private.env.json"),h=u.endsWith("private.env.json");return c===h?d.localeCompare(u):c?1:-1});for(let a of e){let l=await cc(a);if(l)for(let[d,u]of Object.entries(l))n[d]?(g.toString(a).endsWith("private.env.json")||p.warn(`Multiple files with environment ${d} were found.`),Object.assign(n[d],u)):n[d]=u}return n}async function mn(t,e){return(await rt(g.readdir(t),[])).filter(e).map(o=>g.joinPath(t,o))}async function Dd(t,e){let r=await Id(e),o=[];if(t)for(let s of t)o.push(r[s]);return Object.assign({},...o)}async function cc(t){try{if(await g.exists(t)){let e=await g.readFile(t,"utf-8");return JSON.parse(e)}}catch(e){p.trace(`${t} not found`),p.trace(e)}}function Md(t){t.hooks.parse.addHook("intellijScript",Od,{before:["request"]}),t.hooks.provideEnvironments.addHook("intellij",$d),t.hooks.provideVariables.addHook("intellij",Dd),t.hooks.provideVariables.addHook("intellij_global",Ld),t.hooks.replaceVariable.addHook("intellijDynamic",Ad,{before:["name"]}),t.hooks.replaceVariable.addHook("intellijProjectContext",Ed,{before:["name"]})}I.emptyLineProvider.push(()=>[{name:`{{@streaming
`,description:"Streaming Javascript Block"},{name:`{{@response
`,description:"Response Javascript Block"},{name:`{{@request
`,description:"Request Javascript Block"}]);I.variableProvider.push(()=>[{name:"$random.alphabetic()",description:"random letters"},{name:"$random.number()",description:"random number"},{name:"$random.hexadecimal()",description:"random hexadecimal"},{name:"$random.email()",description:"random email"},{name:"$random.float()",description:"random float"},{name:"$random.integer()",description:"random integer"},{name:"$random.uuid()",description:"random uuid"},{name:"$random.date()",description:"Date format function"}]);async function _d(t){let e=jd(t),r=P.getUserSession(e);return(r==null?void 0:r.details)||{$global:{}}}var Io=class{constructor(){this.id="globalVariables"}async afterLoop(e){let[r]=e.args,o=r.variables.$global;if(o&&typeof o=="object"&&Object.keys(o).length>0){let s=jd(r.activeEnvironment);P.setUserSession({id:s,title:"global store",description:r.activeEnvironment?`global Variables for ${r.activeEnvironment.join(", ")}`:"global Variables",type:"global_cache",details:{$global:o}})}return!0}};function jd(t){return`global_cache_${J(t)}`}var Do=class{constructor(e,r){this.context=e;this.httpFileStore=r}findHttpRegionInContext(e){return Ct(e,this.context)}async import(e){return await Zt(e,this.httpFileStore,this.context)}setVariables(e){_(e,this.context)}async execute(e,r){r&&_(r,this.context);let o;if(m(e)?o=Ct(e,this.context):o=e,o&&await(o==null?void 0:o.execute(this.context))){let n=J(this.context.activeEnvironment);_(o.variablesPerEnv[n],this.context)}return this.context.variables}};var dr=T(require("module")),ur=T(require("path")),Fd=T(require("vm"));function Vd(t,e){let r;try{try{r=dr.default.createRequire(ur.default.resolve(e,"package.json")).resolve(t)}catch{r=require.resolve(t,{paths:[e]})}}catch(o){p.debug(o)}return r}function Bd(t,e,r=!1){if(q.isTrusted("loadModule"))try{return r&&gc(t,e),dr.default.createRequire(ur.default.resolve(e,"package.json"))(t)}catch{let s=Vd(t,e);if(s)return r&&cn(s),require(s)}}function fc(t,e){let r=new dr.default(t,require.main);return r.filename=t,r.paths=dr.default._nodeModulePaths(ur.default.dirname(t)),e&&r._compile(e,t),r}function gc(t,e){let r=Vd(t,e);r&&cn(r)}function cn(t,e=new Map){let r=require.cache[t];r&&(e.set(t,!0),r.children.forEach(o=>{e.get(o.id)||cn(o.id,e)}),delete require.cache[t])}async function pr(t,e){if(!q.isTrusted("runScript"))return{};let r=hc(e.fileName),o=fc(r);function s(c){let h=H.require;return h&&h[c]?h[c]:o.require(c)}let n=bc(e.context),i=Object.assign({$context:n,...n}),a=Object.keys(i),l=`(async function userJS(exports, require, module, __filename, __dirname, context){ with(context){${g.EOL}${t}${g.EOL}}})`;await Fd.default.runInThisContext(l,{filename:r,lineOffset:e.lineOffset,displayErrors:!0}).apply(i,[o.exports,s,o,r,ur.default.dirname(r),i]),yc(a,i,e.deleteVariable);let u=o.exports;if(St(u))u=await u;else for(let[c,h]of Object.entries(u))St(h)&&(u[c]=await h);return u}function hc(t){return g.fsPath(t)||g.toString(t)}function yc(t,e,r){if(r)for(let o of t)try{e[o]===void 0&&r(o)}catch(s){p.info(`error on delete of ${o}`,s)}}async function Mo(t,e,r){if(!q.isTrusted("evalExpression"))return;let o=`exports.$result = (${t});`,s=e.httpRegion.symbol.startLine;if(e.httpRegion.symbol.source){let i=Pe(e.httpRegion.symbol.source).findIndex(a=>a.indexOf(t)>=0);i>=0&&(s+=i)}return(await pr(o,{fileName:e.httpFile.fileName,context:{...e.variables,httpFile:e.httpFile,httpRegion:e.httpRegion,request:e.request,console:e.scriptConsole,$random:er,...r,$context:e},lineOffset:s})).$result}function bc(t){let e={};for(let[r,o]of Object.entries(t)){let s=r.trim().replace(/\s/gu,"-").replace(/-./gu,n=>n[1].toUpperCase());Ud.indexOf(s)<0&&typeof o<"u"&&(e[s]=o)}return e}function Nd(t){return Ud.indexOf(t)>=0?(p.debug(`Keyword ${t} prevented, because Javascript Keyword`),!1):xc.indexOf(t)>=0?(p.debug(`Keyword ${t} prevented, because used by httpYac`),!1):!0}var xc=["httpFile","httpRegion","request","test","sleep"],Ud=["await","break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","implements","import","in","instanceof","interface","let","new","null","package","private","protected","public","return","super","switch","static","this","throw","try","true","typeof","var","void","while","with","yield"];var Rc=/^\s*\{\{(@js\s+)?(?<modifier>\+|@)?(?<event>(request|streaming|response|after|responseLogging)?)?\s*$/iu,kc=/^\s*\}\}\s*$/u;async function Gd(t,{httpRegion:e,httpFile:r,httpFileStore:o}){let s=t(),n=s.next();if(!n.done){let i=Rc.exec(n.value.textLine);if(i!=null&&i.groups){let a=n.value.line;n=s.next();let l=[];for(;!n.done;){if(kc.test(n.value.textLine)){let d={script:F(l),lineOffset:a},u=i.groups.modifier==="+";switch(i.groups.event){case"request":Cc(u?r.hooks:e.hooks,d,o);break;case"streaming":wc(u?r.hooks:e.hooks,d,o);break;case"response":Sc(u?r.hooks:e.hooks,d,o);break;case"after":qc(u?r.hooks:e.hooks,d,o);break;case"responseLogging":Hc(u?r.hooks:e.hooks,d,o);break;default:Pc(u?r.hooks:e.hooks,d,o);break}return{nextParserLine:n.value.line,symbols:[new v({name:"script",description:"nodejs script",kind:"script",startLine:a,startOffset:0,endLine:n.value.line,endOffset:n.value.textLine.length})]}}l.push(n.value.textLine),n=s.next()}}}return!1}function wc(t,e,r){t.onStreaming.addHook("js",async o=>await Ot(e,o,r,"streaming")?void 0:Vt)}function Pc(t,e,r){t.execute.addHook("js",o=>Ot(e,o,r))}function Cc(t,e,r){t.onRequest.addHook("js",async(o,s)=>await Ot(e,s,r,"request")?void 0:Vt)}function Sc(t,e,r){t.onResponse.addHook("js",async(o,s)=>(s.variables.response=o,await Ot(e,s,r,"response")?void 0:Vt))}function Hc(t,e,r){t.responseLogging.addHook("js",async(o,s)=>{let n=s.variables.response;s.variables.response=o,await Ot(e,s,r,"responseLogging"),s.variables.response=n})}function qc(t,e,r){t.execute.addInterceptor(new fn(e,r))}var fn=class{constructor(e,r){this.scriptData=e;this.httpFileStore=r;this.id=`afterJavascript_${e.script}`}async afterLoop(e){return await Ot(this.scriptData,e.args[0],this.httpFileStore,"after")}};async function Ot(t,e,r,o){x(e,o?`execute javascript (@${o})`:"execute javascript");let s=await pr(t.script,{fileName:e.httpFile.fileName,context:{...e.variables,httpFile:e.httpFile,httpRegion:e.httpRegion,request:e.request,console:e.scriptConsole,sleep:Se,test:tr(e),$httpyac:new Do(e,r),$random:er,$context:e},lineOffset:t.lineOffset,deleteVariable:i=>ot(i,e)}),n=s.$cancel;return n&&(delete s.$cancel,qe(e.httpRegion)),_(s,e),!n}async function Kd(t,e,r){return await K(t,async(o,s)=>{try{return await Mo(o,r)}catch(n){if(e==="Variable")(r.scriptConsole||p).debug(`variable ${o} not defined`),(r.scriptConsole||p).debug(n);else throw(r.scriptConsole||p).error(`expression ${o} throws error`),n;return s}})}var Wd=T(require("dayjs")),Qd=T(require("open")),Tc=T(require("uuid"));D.javascriptProvider.loadModule=Bd;function zd(t){t.hooks.replaceVariable.addHook("javascript",Kd,{before:["aws"]}),t.hooks.parse.addHook("javascript",Gd,{before:["request"]}),t.hooks.execute.addInterceptor(new Io),t.hooks.provideVariables.addHook("globalVariables",_d),Ac(),D.javascriptProvider.evalExpression=Mo,D.javascriptProvider.runScript=pr,D.javascriptProvider.isAllowedKeyword=Nd}function Ac(){Object.assign(D.javascriptProvider.require,{httpyac:gn,dayjs:Wd.default,open:Qd.default,uuid:Tc})}function Ne(t){return(t==null?void 0:t.protocol)==="MQTT"}I.emptyLineProvider.push(()=>[{name:"MQTT",description:"MQTT request"}]);I.requestHeaderProvider.push(t=>Ne(t)?[{name:"username",description:"the username required by your broker"},{name:"password",description:"the password required by your broker"},{name:"clean",description:"true, set to false to receive QoS 1 and 2 messages while offline"},{name:"keepalive",description:"10 seconds, set to 0 to disable"},{name:"QoS",description:"the QoS used for subscribe or publish"},{name:"retain",description:"the retain flat used for publish"},{name:"subscribe",description:"topics to subscribe to"},{name:"publish",description:"topics to publish to"},{name:"topic",description:"topic to subscribe and publish to"}]:[]);var Jd=require("mqtt");var _o=class extends te{constructor(r,o){super();this.request=r;this.context=o;this.responseTemplate={protocol:"MQTT"};this.promises=[]}get reportMessage(){return`perform MQTT Request (${this.request.url})`}get supportsStreaming(){return!0}get nativeClient(){return this._nativeClient}get publishTopics(){return Ne(this.request)?[...O(this.request.headers,"topic"),...O(this.request.headers,"publish")]:[]}get subscribeTopics(){return Ne(this.request)?[...O(this.request.headers,"topic"),...O(this.request.headers,"subscribe")]:[]}async connect(){if(Ne(this.request)){let r=this.request,o={};Ne(this.request)&&Object.assign(o,this.getClientOptions(this.request,this.context)),this._nativeClient=await(0,Jd.connectAsync)(this.request.url||"",o),this.registerEvents(this._nativeClient),this.subscribe(this._nativeClient,this.subscribeTopics,r)}return this._nativeClient}async send(r){if(Ne(this.request)&&this.nativeClient){let o={...this.request,body:b(r||this.request.body)},s=this.publish(this.nativeClient,this.publishTopics,o);this.promises.push(s),await s;let n=this.promises.findIndex(i=>i===s);n>=0&&this.promises.splice(n,1)}}disconnect(r){let o=()=>{var s;(s=this.nativeClient)==null||s.end(!!r,void 0,n=>n&&p.error("error on close",n)),this.onDisconnect()};this.promises.length>0?Promise.all([...this.promises]).then(o):o()}registerEvents(r){r.on("message",(s,n,i)=>{this.onMessage(s,{...this.responseTemplate,statusCode:0,name:`MQTT ${s} (${this.request.url})`,message:n.toString("utf-8"),request:this.request,body:n.toString("utf-8"),rawBody:n,headers:{topic:s,...i.properties}})}),r.on("error",s=>{this.onMessage("error",{...this.responseTemplate,statusCode:1,request:this.request,body:Ie(s)})});let o=["close","connect","disconnect","end","offline","outgoingEmpty","packetreceive","packetsend","reconnect"];for(let s of o)m(s)&&r.on(s,n=>{this.onMetaData(s,{...this.responseTemplate,statusCode:0,message:n?`${b(n)}`:void 0,body:{event:s,packet:n,date:new Date}})})}getClientOptions(r,o){let{config:s}=o,n={};if(s!=null&&s.request){let a=r.timeout||S(s.request.timeout);a!==void 0&&(n.connectTimeout=a),be(s.request.rejectUnauthorized)||(n.rejectUnauthorized=G(s.request.rejectUnauthorized,!0))}r.noRejectUnauthorized&&(n.rejectUnauthorized=!1);let i=Object.fromEntries(Object.entries(r.headers||{}).filter(([a])=>["topic","qos","retain","subscribe","publish"].indexOf(a.toLowerCase())<0));return Object.assign({},s==null?void 0:s.request,r.options,n,i)}subscribe(r,o,s){for(let n of o)r.subscribe(n,{qos:this.toQoS(j(s.headers,"qos"))})}async publish(r,o,s){if(s.body){let n=s.body,i={qos:this.toQoS(j(s.headers,"qos")),retain:!!E(s.headers,"retain")};await Promise.all(o.map(async a=>{try{await r.publishAsync(a,n,i)}catch(l){p.error("publish error",l)}}))}}toQoS(r,o=0){switch(r){case"2":return 2;case"1":return 1;default:return o}}};var Xd=ue({protocol:"MQTT",methodRegex:/^\s*(MQTT(S)?)\s+(?<url>.+?)\s*$/u,protocolRegex:/^\s*(?<url>mqtt(s)?:\/\/.+?)\s*$/iu,requestClientFactory(t,e){return new _o(t,e)},modifyRequest(t){t.supportsStreaming=!0},sessionStore:P});async function Yd(t,e){return de(t,e,/^\s*MQTT\s*(?<statusCode>([0-9]+))\s*(-)?\s*(?<statusMessage>.*)$/u)}var Lc=T(require("mqtt"));function Zd(t){t.hooks.parse.addHook("mqtt",Xd,{before:["request"]}),t.hooks.parse.addHook("mqttResponse",Yd,{before:["requestBody"]}),H.require.mqtt=Lc}var hn="amqp_channel_id",re="amqp_queue",ke="amqp_exchange",eu="amqp_method",mr="amqp_exchange_destination",ct="amqp_routing_key",Me="amqp_tag",yn="amqp_no_ack",bn="amqp_exclusive",jo="amqp_mandatory",xn="amqp_internal",vn="amqp_correlation_id",Rn="amqp_content_type",kn="amqp_content_encoding",wn="amqp_delivery_mode",Pn="amqp_expiration",Cn="amqp_message_id",Sn="amqp_priority",Hn="amqp_replyTo",cr="amqp_type",qn="amqp_user_id",Tn="amqp_requeue",fr="amqp_multiple",An="amqp_if_unused",Ln="amqp_if_empty",On="amqp_passive",En="amqp_durable",$n="amqp_auto_delete";function gr(t){let e=f.getHeaderString(t.headers,eu);return e||(t.body?e="publish":e="consume"),e}function ft(t){return(t==null?void 0:t.protocol)==="AMQP"}var tu=require("@cloudamqp/amqp-client");var Gn={};gt(Gn,{AmqpAutoDelete:()=>$n,AmqpChannelId:()=>hn,AmqpContentEncoding:()=>kn,AmqpContentType:()=>Rn,AmqpCorrelationId:()=>vn,AmqpDeliveryMode:()=>wn,AmqpDurable:()=>En,AmqpExchange:()=>ke,AmqpExchangeDestination:()=>mr,AmqpExclusive:()=>bn,AmqpExpiration:()=>Pn,AmqpIfEmpty:()=>Ln,AmqpIfUnused:()=>An,AmqpInternal:()=>xn,AmqpMandatory:()=>jo,AmqpMessageId:()=>Cn,AmqpMethod:()=>eu,AmqpMultiple:()=>fr,AmqpNoAck:()=>yn,AmqpPassive:()=>On,AmqpPriority:()=>Sn,AmqpQueue:()=>re,AmqpReplyTo:()=>Hn,AmqpRequeue:()=>Tn,AmqpRoutingKey:()=>ct,AmqpTag:()=>Me,AmqpType:()=>cr,AmqpUserId:()=>qn,ack:()=>In,bind:()=>Mn,cancel:()=>_n,consume:()=>Fo,declare:()=>jn,deleteMessage:()=>Fn,errorToHttpResponse:()=>Dn,getAmqpMethod:()=>gr,getNonAmqpHeaders:()=>Le,isAmqpError:()=>Oc,nack:()=>Vn,publish:()=>Bn,purge:()=>Nn,unbind:()=>Un});async function In({channel:t,request:e}){let r=O(e.headers,Me);for(let o of r){let s=await t.basicAck(Number(o),B(e.headers,fr,!0));return{protocol:"AMQP",name:"AMQP ack",statusCode:0,headers:{channelId:t.id,method:"ack"},request:e,body:k({tag:o,ack:!0,result:s})}}}function Le(t){if(t)return Object.fromEntries(Object.entries(t).filter(([e])=>!e.startsWith("amqp_")))}function Oc(t){let e=t;return e==null?void 0:e.isError}function Dn(t,e){return ce(t)?{protocol:"AMQP",statusCode:1,message:t.message,request:e,body:k({name:t.name,message:t.message,stack:t.stack})}:{protocol:"AMQP",statusCode:1,message:b(t),body:b(t)}}async function Mn({channel:t,request:e,onMessage:r}){let o=O(e.headers,ke),s=O(e.headers,re),n=O(e.headers,mr),i=j(e.headers,ct)||"";for(let a of o){for(let l of s){let d=await t.queueBind(l,a,i,Le(e.headers));r(l,{protocol:"AMQP",name:`AMQP bind ${i}`,statusCode:0,headers:{channelId:t.id,method:"bind",queue:l,exchange:a},request:e,message:`bind ${a} (${i}, ${l})`,body:k({bind:!0,routingKey:i,result:d,queue:l,exchange:a})})}for(let l of n){let d=await t.exchangeBind(l,a,i,Le(e.headers));r(a,{protocol:"AMQP",name:`AMQP bind ${i}`,statusCode:0,headers:{channelId:t.id,method:"bind",exchange:a},request:e,message:`bind ${a} (${i}, ${l})`,body:k({bind:!0,routingKey:i,result:d,exchange:a})})}}}async function _n({channel:t,request:e}){let r=O(e.headers,Me);for(let o of r){let s=await t.basicCancel(o);return{protocol:"AMQP",name:"AMQP cancel",statusCode:0,headers:{channelId:t.id,method:"cancel"},request:e,body:k({tag:o,cancel:!0,result:s},2)}}}async function Fo({channel:t,request:e,onMessage:r}){var n,i;let o=O(e.headers,re),s={tag:j(e.headers,Me),noAck:B(e.headers,yn,!1),exclusive:B(e.headers,bn,!1),args:Le(e.headers)};for(let a of o)t.basicConsume(a,s,async l=>{r(a,{protocol:"AMQP",name:`AMQP consume ${a}`,statusCode:0,headers:{channelId:t.id,method:"consume",queue:a,exchange:l.exchange,routingKey:l.routingKey,bodySize:l.bodySize,deliveryTag:l.deliveryTag,consumerTag:l.consumerTag,redelivered:l.redelivered,messageCount:l.messageCount,replyCode:l.replyCode,replyText:l.replyCode,options:s},request:e,message:`${l.bodyString()} (deliveryTag: ${l.deliveryTag}, channel: ${l.channel.id})`,body:l.bodyString(),rawBody:l.body?Buffer.from(l.body):void 0})});if(o.length===0){let a="no queues to consume";(i=(n=q).showWarnMessage)==null||i.call(n,a),p.warn(a)}}async function jn({channel:t,request:e,onMessage:r}){let o=O(e.headers,ke),s={passive:B(e.headers,On,!1),durable:B(e.headers,En,!0),autoDelete:B(e.headers,$n,!1),internal:B(e.headers,xn)};for(let i of o){let a=j(e.headers,cr)||"direct",l=await t.exchangeDeclare(i,a,s);r(i,{protocol:"AMQP",name:"AMQP declare",statusCode:0,headers:{channelId:t.id,exchange:i,method:"declare"},request:e,message:"declare",body:k({...s,declare:!0,type:a,result:l},2)})}let n=O(e.headers,re);for(let i of n){let a=await t.queueDeclare(i,s);r(i,{protocol:"AMQP",name:"AMQP declare",statusCode:0,headers:{channelId:t.id,queue:i,method:"declare"},request:e,message:"declare",body:k({...s,declare:!0,result:a},2)})}}async function Fn({channel:t,request:e,onMessage:r}){let o=O(e.headers,ke),s={ifUnused:B(e.headers,An,!0),ifEmpty:B(e.headers,Ln)};for(let i of o){let a=await t.exchangeDelete(i,s);r(i,{protocol:"AMQP",name:"AMQP delete",statusCode:0,headers:{channelId:t.id,exchange:i,method:"delete"},request:e,message:"delete",body:k({...s,delete:!0,result:a},2)})}let n=O(e.headers,re);for(let i of n){let a=await t.queueDelete(i,s);r(i,{protocol:"AMQP",name:"AMQP delete",statusCode:0,headers:{channelId:t.id,queue:i,method:"delete"},request:e,message:"delete",body:k({...s,delete:!0,result:a},2)})}}async function Vn({channel:t,request:e}){let r=O(e.headers,Me);for(let o of r){let s=await t.basicNack(Number(o),B(e.headers,Tn,!1),B(e.headers,fr,!1));return{protocol:"AMQP",name:"AMQP nack",statusCode:0,headers:{channelId:t.id,method:"nack"},request:e,body:k({tag:o,nack:!0,result:s},2)}}}async function Bn({channel:t,request:e,onMessage:r}){var o,s,n,i;if(e.body){let a={appId:"httpyac",timestamp:new Date,correlationId:j(e.headers,vn),contentType:j(e.headers,Rn)||j(e.headers,"content-type"),contentEncoding:j(e.headers,kn),deliveryMode:bt(e.headers,wn),expiration:j(e.headers,Pn),messageId:j(e.headers,Cn),priority:bt(e.headers,Sn),replyTo:j(e.headers,Hn),type:j(e.headers,cr),userId:j(e.headers,qn),headers:Le(e.headers)},l=O(e.headers,ke),d=j(e.headers,ct)||"";for(let c of l){let h=await t.basicPublish(c,d,e.body,a,B(e.headers,jo));r(c,{protocol:"AMQP",name:`AMQP publish ${d}`,statusCode:0,headers:{exchange:c,channelId:t.id},request:e,message:`publish ${d}`,body:k({published:!0,...a,routingKey:d,publish:h},2)})}let u=O(e.headers,re);for(let c of u){let h=await t.basicPublish("",c,e.body,a,B(e.headers,jo));r(c,{protocol:"AMQP",name:`AMQP publish ${d}`,statusCode:0,headers:{queue:c,channelId:t.id},request:e,message:`publish ${d}`,body:k({published:!0,routingKey:d,publish:h})})}if(u.length===0&&l.length===0){let c="no queues or exchanges to publish";(s=(o=q).showWarnMessage)==null||s.call(o,c),p.warn(c)}}else{let a="no body for publish";(i=(n=q).showWarnMessage)==null||i.call(n,a),p.warn(a)}}async function Nn({channel:t,request:e,onMessage:r}){let o=O(e.headers,re);for(let s of o){let n=await t.queuePurge(s);r(s,{protocol:"AMQP",name:"AMQP purge",statusCode:0,headers:{queue:s,channelId:t.id},request:e,message:"purge",body:k({purge:!0,result:n},2)})}}async function Un({channel:t,request:e,onMessage:r}){let o=O(e.headers,ke),s=O(e.headers,re),n=O(e.headers,mr),i=j(e.headers,ct)||"",a=Le(e.headers);for(let l of o){for(let d of s){let u=await t.queueUnbind(d,l,i,a);r(d,{protocol:"AMQP",name:`AMQP unbind ${i}`,statusCode:0,headers:{channelId:t.id,queue:d,exchange:l,method:"unbind"},request:e,message:`unbind ${l} (${i}, ${d})`,body:k({routingKey:i,unbind:!0,result:u,queue:d,exchange:l},2)})}for(let d of n){let u=await t.exchangeUnbind(d,l,i,a);r(l,{protocol:"AMQP",name:`AMQP unbind ${i}`,statusCode:0,headers:{channelId:t.id,exchange:l,method:"unbind"},request:e,message:`unbind ${l} (${i}, ${d})`,body:k({routingKey:i,destination:d,unbind:!0,result:u,exchange:l},2)})}}}var Vo=class extends te{constructor(r,o){super();this.request=r;this.context=o}get reportMessage(){return`perform AMQP Request (${this.request.url})`}get supportsStreaming(){return!0}getSessionId(){return tt(this.request.url)}get channel(){return this._channel}get nativeClient(){return this._nativeClient}async connect(r){if(ft(this.request)){r?this._nativeClient=r:(this._nativeClient=new tu.AMQPClient(this.request.url||""),await this._nativeClient.connect());let o=bt(this.request.headers,hn);return this._channel=await this._nativeClient.channel(o),await this.executeAmqpMethod(this.request),this._nativeClient}}async send(r){ft(this.request)&&this.channel&&r&&await this.executeAmqpMethod({...this.request,body:ae(r)})}async executeAmqpMethod(r){if(this.channel){let o={channel:this.channel,request:r,context:this.context,onMessage:(s,n)=>this.onMessage(s,n)};try{return await this.getMethod(gr(r)).exchange(o)}catch(s){return Dn(s,r)}}}disconnect(r){var o,s,n,i;r?((o=this.channel)==null||o.close(),(s=this._nativeClient)==null||s.close(r.message)):((n=this._channel)==null||n.close(),(i=this._nativeClient)==null||i.close()),this.onDisconnect()}getMethod(r="publish"){let o={ack:In,bind:Mn,cancel:_n,consume:Fo,declare:jn,delete:Fn,nack:Vn,publish:Bn,purge:Nn,subscribe:Fo,unbind:Un};if(r)return{method:r,exchange:o[r]};throw new Error(`Amqp Method ${r} not supported (supported: ${Object.entries(Gn).map(([s])=>s).join(", ")})`)}};var ru=ue({protocol:"AMQP",methodRegex:/^\s*(AMQP)\s+(?<url>.+?)\s*$/u,protocolRegex:/^\s*(?<url>amqp(s)?:\/\/.+?)\s*$/iu,requestClientFactory(t,e){return new Vo(t,e)},modifyRequest(t){t.supportsStreaming=!0,ft(t)&&(t.method=gr(t))},sessionStore:P});async function ou(t,e){return de(t,e,/^\s*AMQP\s*(?<statusCode>(-1|0))\s*(-)?\s*(?<statusMessage>.*)$/u)}I.emptyLineProvider.push(()=>[{name:"AMQP",description:"AMQP request"}]);I.requestHeaderProvider.push(t=>{let e=[];if(ft(t)){e.push({name:"amqp_exchange",description:"Exchange"},{name:"amqp_queue",description:"Queue"},{name:"amqp_method",description:"Method (default if no body, consume, with body publish. Valid Values: bind, unbind, declare, delete, consume, publish, purge, ack, nack, cancel"},{name:"amqp_routing_key",description:"Routing Key"});let r=E(t==null?void 0:t.headers,"amqp_method")||"";if(m(r))switch(r.toLowerCase()){case"bind":case"unbind":e.push({name:"amqp_exchange_destination",description:"Exchange destination for Bind/ Unbind"});break;case"declare":e.push({name:"amqp_passive",description:"if the exchange name doesn't exists the channel will be closed with an error, fulfilled if the exchange name does exists"},{name:"amqp_durable",description:"if the exchange should survive server restarts"},{name:"amqp_auto_delete",description:"if the exchange should be deleted when the last binding from it is deleted"},{name:"amqp_internal",description:"if exchange is internal to the server. Client's can't publish to internal exchanges."});break;case"delete":e.push({name:"amqp_if_unused",description:"only delete if the queue doesn't have any consumers"},{name:"amqp_if_empty",description:"only delete if the queue is empty"});break;case"nack":e.push({name:"amqp_tag",description:"tag of the consumer, will be server generated if left empty"},{name:"amqp_requeue",description:"if the message should be requeued or removed"},{name:"amqp_multiple",description:"batch confirm all messages up to this delivery tag"});break;case"ack":e.push({name:"amqp_tag",description:"tag of the consumer, will be server generated if left empty"},{name:"amqp_multiple",description:"batch confirm all messages up to this delivery tag"});break;case"cancel":e.push({name:"amqp_tag",description:"tag of the consumer, will be server generated if left empty"});break;case"consume":case"publish":case"":e.push({name:"amqp_tag",description:"tag of the consumer, will be server generated if left empty"},{name:"amqp_no_ack",description:"if messages are removed from the server upon delivery, or have to be acknowledged (default: false)"},{name:"amqp_exclusive",description:"if this can be the only consumer of the queue, will return an Error if there are other consumers to the queue already"},{name:"amqp_correlation_id",description:"for RPC requests"},{name:"amqp_content_type",description:"content type of body, eg. application/json"},{name:"amqp_content_encoding",description:"content encoding of body, eg. gzip"},{name:"amqp_deliveryMode",description:"1 for transient messages, 2 for persistent messages"},{name:"amqp_expiration",description:"Exchange"},{name:"amqp_messageId",description:"Message TTL, in milliseconds, as string"},{name:"amqp_priority",description:"between 0 and 255"},{name:"amqp_replyTo",description:"for RPC requests"},{name:"amqp_type",description:"type"},{name:"amqp_userId",description:"user id"},{name:"amqp_mandatory",description:"if the message should be returned if there's no queue to be delivered to"});break;default:break}}return e});var Ec=T(require("@cloudamqp/amqp-client"));function su(t){t.hooks.parse.addHook("amqp",ru,{before:["request"]}),t.hooks.parse.addHook("amqpResponse",ou,{before:["requestBody"]}),H.require["@cloudamqp/amqp-client"]=Ec}I.emptyLineProvider.push(()=>[{name:"WSS",description:"WSS request"}]);var Dc=T(require("ws"));function hr(t){let e=!(t!=null&&t.body)||m(t.body)||Buffer.isBuffer(t.body);return(t==null?void 0:t.protocol)==="WS"&&e}async function nu(t,{variables:e}){if(hr(t)&&e&&typeof e.request_rejectUnauthorized<"u"){let r=G(e.request_rejectUnauthorized);t.options=Object.assign({},t.options,{rejectUnauthorized:r})}}var iu=require("http-proxy-agent"),au=require("https-proxy-agent"),lu=require("socks-proxy-agent"),du=T(require("ws"));var $c=1e3,Ic=1001,Bo=class extends te{constructor(r,o){super();this.request=r;this.context=o;this.responseTemplate={protocol:"WS"}}get reportMessage(){return`perform WebSocket Request (${this.request.url})`}get supportsStreaming(){return!0}get nativeClient(){return this._nativeClient}getSessionId(){return tt(this.request.url)}async connect(r){return r?(this._nativeClient=r,r):(hr(this.request)&&(this._nativeClient=new du.default(this.request.url||"",this.getClientOptions(this.request)),this.registerEvents(this._nativeClient),await new Promise(o=>{var n,i;let s=()=>{var a,l;o(),(a=this.nativeClient)==null||a.off("open",s),(l=this.nativeClient)==null||l.off("close",s)};(n=this._nativeClient)==null||n.on("open",s),(i=this._nativeClient)==null||i.on("close",s)})),this._nativeClient)}async send(r){var o;if(hr(this.request)){let s=ae(r||this.request.body);s&&((o=this.nativeClient)==null||o.send(s,n=>{n&&this.onMessage("error",{...this.responseTemplate,statusCode:400,request:this.request,body:Ie(n)})}))}}disconnect(r){var o,s;r?(o=this._nativeClient)==null||o.close(Ic,r.message):(s=this._nativeClient)==null||s.close($c,"CLOSE_NORMAL"),this.onDisconnect()}registerEvents(r){r.on("error",s=>{this.onMessage("error",{...this.responseTemplate,statusCode:400,request:this.request,body:b(s)})}),r.on("message",s=>{this.onMessage("message",{...this.responseTemplate,statusCode:0,name:`${r.protocol} (${this.request.url})`,message:b(s),headers:{date:new Date},request:this.request,body:b(s),rawBody:Buffer.isBuffer(s)?s:void 0})}),r.on("close",(s,n)=>{this.onMessage("message",{...this.responseTemplate,statusCode:s,name:`${r.protocol} (${this.request.url})`,message:b(n),headers:{date:new Date},request:this.request,body:b(n)||"close",rawBody:Buffer.isBuffer(n)?n:void 0})});let o=["upgrade","unexpected-response","ping","pong","closing","close"];for(let s of o)m(s)&&r.on(s,n=>{this.onMetaData(s,{...this.responseTemplate,statusCode:(n==null?void 0:n.statusCode)||0,statusMessage:n==null?void 0:n.statusMessage,headers:n==null?void 0:n.headers,httpVersion:n==null?void 0:n.httpVersion,message:n?`${s}: ${b(n)}`:s,body:{event:s,message:n,date:new Date}})})}getClientOptions(r){let{config:o}=this.context,s={};o!=null&&o.request&&(s.handshakeTimeout=r.timeout||S(o.request.timeout),s.sessionTimeout=s.handshakeTimeout,be(o.request.rejectUnauthorized)||(s.rejectUnauthorized=G(o.request.rejectUnauthorized,!0)),be(o.request.followRedirects)||(s.followRedirects=G(o.request.followRedirects,!0)));let n={headers:r.headers};return r.noRedirect&&(n.followRedirects=!1),r.noRejectUnauthorized&&(n.rejectUnauthorized=!1),r.proxy&&this.initProxy(s,r.proxy),Object.assign({},o==null?void 0:o.request,r.options,n)}initProxy(r,o){if(o)if(o.startsWith("socks://")){let s=new lu.SocksProxyAgent(o);r.agent=s}else o.startsWith("http://")?r.agent=new iu.HttpProxyAgent(o):r.agent=new au.HttpsProxyAgent(o)}};var uu=ue({protocol:"WS",methodRegex:/^\s*(WS|WSS|WEBSOCKET)\s+(?<url>.+?)\s*$/u,protocolRegex:/^\s*(?<url>ws(s)?:\/\/.+?)\s*$/iu,requestClientFactory(t,e){return new Bo(t,e)},modifyRequest(t){t.supportsStreaming=!0},sessionStore:P});async function pu(t,e){return de(t,e,/^\s*WS\s*(?<statusCode>([0-9]{4}|0))\s*(-)?\s*(?<statusMessage>.*)$/u)}function mu(t){t.hooks.onRequest.addHook("setWebsocketEnvRejectUnauthorized",nu),t.hooks.parse.addHook("websocket",uu,{before:["request"]}),t.hooks.parse.addHook("websocketResponse",pu,{before:["requestBody"]}),H.require.ws=Dc}var cu=require("@xmldom/xmldom");function fu(t,e){let r;if(t){let o=e[t];if(m(o))r=o;else if(xt(o)&&m(o.body))r=o.body;else if(Kn(o))return o}else if(e.response&&xt(e.response)){let o=e.response;m(o.body)&&Xe(o.contentType)&&(r=o.body)}if(r)return yr(r)}function Kn(t){let e=t;return e&&m(e.nodeName)&&Number.isInteger(e.nodeType)&&typeof e.cloneNode=="function"}function yr(t,e){return new cu.DOMParser({errorHandler(r,o){p.debug(r,o)}}).parseFromString(t,e)}var No=require("xpath");async function gu(t,e,r,o){if(t==="xpath"&&e&&r.body){let s=b(r.body);if(!s)return"";try{let n=yr(s),i=No.select;o.options.xpath_namespaces&&(i=(0,No.useNamespaces)(o.options.xpath_namespaces));let a=i(e,n);return Qn(a)}catch(n){return p.warn(`xpath ${e} throws error`,n),e}}return!1}function Qn(t){if(t!==null&&Array.isArray(t)){if(t.length===0)return;if(t.length===1){let e=t[0];return Wn(e)}return t.map(e=>Wn(e))}return Wn(t)}function Wn(t){return Kn(t)?t.textContent:t}var Mc=T(require("@xmldom/xmldom")),_c=T(require("xpath"));var hu=require("os"),yu=require("xmldom-format");var bu={id:"xmlResponseBody",beforeLoop:async function(e){var o;let[r]=e.args;if(r&&Xe(r.contentType)&&!r.prettyPrintBody&&m(r.body)&&r.body.length>0){let s=yr(r.body,(o=r.contentType)==null?void 0:o.mimeType);r.parsedBody=s;try{r.prettyPrintBody=(0,yu.formatXml)(s,{eol:hu.EOL,indentation:"  ",useWhitespaceInAutoClosingNode:!0})}catch(n){p.warn("xml format error",r.body,n)}}return!0}};async function xu(t,{httpRegion:e}){let o=t().next();if(!o.done){let s=o.value.textLine,n=/^\s*@xpath_ns\s+(?<key>[^\s=:]*)\s*=\s*"?(?<value>.*)"?\s*$/u.exec(s);if(n&&n.groups&&n.groups.key&&n.groups.value){let i=n.groups.key,a=n.groups.value;return e.hooks.execute.addHook(`xpath_ns_${i}`,async l=>{l.options.xpath_namespaces||(l.options.xpath_namespaces={});let d=await M(a,"Variable",l);return m(d)&&(l.options.xpath_namespaces[i]=d),!0}),{nextParserLine:o.value.line,symbols:[new v({name:n.groups.key,description:n.groups.value,kind:"variableDefinition",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length,children:[new v({name:n.groups.key,description:"key",kind:"key",startLine:o.value.line,startOffset:o.value.textLine.indexOf(n.groups.key),endLine:o.value.line,endOffset:o.value.textLine.indexOf(n.groups.key)+n.groups.key.length}),new v({name:n.groups.value,description:"value",kind:"value",startLine:o.value.line,startOffset:o.value.textLine.indexOf(n.groups.value),endLine:o.value.line,endOffset:o.value.textLine.indexOf(n.groups.value)+n.groups.value.length})]})]}}}return!1}var Uo=require("xpath");async function vu(t,e,{variables:r,scriptConsole:o,options:s}){return K(t,async n=>{var a;let i=/^\s*\$xpath(:(?<variable>[^\s]*))?\s*(?<xpath>.*)\s*$/iu.exec(n);if((a=i==null?void 0:i.groups)!=null&&a.xpath){try{let l=fu(i.groups.variable,r);if(l){let d=Uo.select;s.xpath_namespaces&&(d=(0,Uo.useNamespaces)(s.xpath_namespaces));let u=d(i.groups.xpath,l);return Qn(u)}}catch(l){(o||p).warn(`xpath ${i.groups.xpath} throws error`,l)}return""}})}function Ru(t){t.hooks.parse.addHook("xpath_ns",xu,{before:["variable"]}),t.hooks.onResponse.addInterceptor(bu),t.hooks.provideAssertValue.addHook("xpath",gu),t.hooks.replaceVariable.addHook("xpath",vu,{before:["javascript"]}),H.require.xpath=_c,H.require["@xmldom/xmldom"]=Mc}W.core=tl;W.dotenv=il;W.eventSource=ul;W.graphql=fl;W.grpc=Ll;W.http=Zl;W.intellij=Md;W.injection=ed;W.javascript=zd;W.mqtt=Zd;W.oauth2=Cd;W.rabbitMQ=su;W.assert=_i;W.websocket=mu;W.xml=Ru;var zn=require("hookpoint");async function Jn(t){let e=!1;return Rs(t)?e=await Fc(t):ks(t)?e=await ku(t):e=await Vc(t),e}async function Fc(t){let e=await br(t);return await kt(e)?await t.httpRegion.execute(e,!0):!1}async function ku(t){let e=await br(t);if(await kt(e)){t.progress&&(t.progress.divider=t.httpRegions.length);for(let r of t.httpRegions)await r.execute(e,!0);return!0}return!1}async function Vc(t){let e=[];for(let r of t.httpFile.httpRegions)t.httpRegionPredicate&&!t.httpRegionPredicate(r)?p.debug(`${r.symbol.name} disabled by predicate`):r.isGlobal()||e.push(r);return await ku({...t,httpRegions:e})}async function br(t){return Object.assign(t,{variables:await wu(t),options:{}})}async function wu(t){t.config=await Ht(t.config,t.httpFile);let e=await t.httpFile.hooks.provideVariables.trigger(t.activeEnvironment,t);if(e===zn.HookCancel)return t.variables||{};let r=Object.assign(t.variables||{},...e.map(o=>qr(o)),t.variables);return p.debug("current environment variables",r),r}async function Bc(t){t.config=await Ht(t.config,t.httpFile);let e=await t.httpFile.hooks.provideEnvironments.trigger(t);return e!==zn.HookCancel&&e.length>0?e.reduce((r,o)=>{for(let s of o)r.indexOf(s)<0&&r.push(s);return r},[]).sort():[]}function Cu(){return new Pu.Command("oauth2").description("generate oauth2 token").option("-f, --flow <flow>","flow used for oauth2 token generation","client_credentials").option("--prefix <prefix>","variable prefix used for variables").option("-e, --env  <env...>","list of environments").option("-o, --output <output>","output format of response (access_token, refresh_token, response)","access_token").option("--var  <variables...>",'list of variables (e.g foo="bar")').action(Nc)}async function Nc(t){let e=new at,r=await br({activeEnvironment:t.env,httpFile:await e.initHttpFile("oauth2.http",{workingDir:process.cwd()}),variables:t.var?Object.fromEntries(t.var.map(s=>{let n=s.split("=");return[n[0],n.slice(1).join("=")]})):void 0}),o=await mt(t.flow,t.prefix,r);if(o)switch(t.output){case"response":console.info(JSON.stringify({access_token:o.accessToken,expires_in:o.expiresIn,refresh_token:o.refreshToken,refresh_expires_in:o.refreshExpiresIn},null,2));break;case"refresh_token":console.info(o.refreshToken);break;default:console.info(o.accessToken);break}else process.exitCode=1,console.info("no valid auth response")}var Et=T(require("chalk")),_u=require("commander"),ju=require("fs"),Fu=require("path");function Xn(t){if(t.json||t.junit)return 1e3;if(t.silent)return 100;if(t.verbose)return 1}function xr(t,e){return t+e}function Su(t,e){var s,n,i,a,l,d,u,c,h,R,w,$,Q,C;let r=[];for(let y of t){let L=e.output;e.outputFailed&&((n=(s=y.testResults)==null?void 0:s.some)!=null&&n.call(s,ye=>!ye.status))&&(L=e.outputFailed);let Z={fileName:g.fsPath(y.filename)||g.toString(y.filename),response:Kc(y.response,L),name:b((i=y.metaData)==null?void 0:i.name)||y.symbol.name,line:y.symbol.startLine,title:b((a=y.metaData)==null?void 0:a.title),description:b((l=y.metaData)==null?void 0:l.description),testResults:y.testResults,timestamp:new Date(performance.timeOrigin+y.start).toISOString(),duration:y.duration,summary:{totalTests:((d=y.testResults)==null?void 0:d.length)||0,failedTests:((c=(u=y.testResults)==null?void 0:u.filter)==null?void 0:c.call(u,ye=>ye.status==="FAILED").length)||0,successTests:((R=(h=y.testResults)==null?void 0:h.filter)==null?void 0:R.call(h,ye=>ye.status==="SUCCESS").length)||0,erroredTests:(($=(w=y.testResults)==null?void 0:w.filter)==null?void 0:$.call(w,ye=>ye.status==="ERROR").length)||0,skippedTests:((C=(Q=y.testResults)==null?void 0:Q.filter)==null?void 0:C.call(Q,ye=>ye.status==="SKIPPED").length)||0}};r.push(Z)}let o=r;return e.filter==="only-failed"&&(o=r.filter(y=>y.summary.failedTests>0)),{_meta:{version:"1.1.0"},requests:o,summary:Gc(r)}}function Gc(t){return{totalRequests:t.length,skippedRequests:t.filter(e=>e.summary.skippedTests>0).length,failedRequests:t.filter(e=>e.summary.failedTests>0).length,successRequests:t.filter(e=>e.summary.failedTests+e.summary.erroredTests+e.summary.skippedTests===0).length,erroredRequests:t.filter(e=>e.summary.erroredTests>0).length,totalTests:t.map(e=>e.summary.totalTests).reduce(xr,0),failedTests:t.map(e=>e.summary.failedTests).reduce(xr,0),successTests:t.map(e=>e.summary.successTests).reduce(xr,0),erroredTests:t.map(e=>e.summary.erroredTests).reduce(xr,0),skippedTests:t.map(e=>e.summary.skippedTests).reduce(xr,0)}}function Kc(t,e){var r;if(t)switch(delete t.rawHeaders,delete t.rawBody,delete t.prettyPrintBody,delete t.parsedBody,delete t.contentType,delete t.tags,e){case"body":case"response":return delete t.request,t;case"short":return delete t.body,delete t.request,t;case"none":return;case"headers":return delete t.body,(r=t.request)==null||delete r.body,t;case"exchange":default:return t}}var Yn=!1,Hu={id:"bailOnFailed",beforeLoop:async function(e){if(Yn){let[r]=e.args;return qe(r.httpRegion,"request skipped because of bail"),!1}return!0},onError:async function(){return Yn=!0,!0},afterTrigger:async function(e){var s,n;return((n=(s=e.args[0].httpRegion.testResults)==null?void 0:s.find)==null?void 0:n.call(s,i=>["FAILED"].includes(i.status)))&&(Yn=!0),!0}};var qu={id:"loggerFlush",afterLoop:async function(e){var o,s;let r=e.args[0];return(s=(o=r==null?void 0:r.scriptConsole)==null?void 0:o.flush)==null||s.call(o),!0}};var Tu={id:"testExitCode",onError:async function(){return process.exitCode=10,!0},afterTrigger:async function(e){var s,n;return((n=(s=e.args[0].httpRegion.testResults)==null?void 0:s.some)==null?void 0:n.call(s,i=>i.status==="FAILED"))&&(process.exitCode=20),!0}};function Au(t){return function(r){r.hooks.execute.addInterceptor(qu),r.hooks.execute.addInterceptor(Tu),t&&r.hooks.execute.addInterceptor(Hu)}}var Lu=require("@xmldom/xmldom"),Ou=require("os"),Eu=require("xmldom-format");function $u(t){let r=new Lu.DOMImplementation().createDocument("",""),o=r.createProcessingInstruction("xml",'version="1.0" encoding="UTF-8"');r.appendChild(o);let s=r.createElement("testsuites");r.appendChild(s),s.setAttribute("name","httpyac"),s.setAttribute("tests",`${t.summary.totalTests}`),s.setAttribute("errors",`${t.summary.erroredTests}`),s.setAttribute("disabled",`${t.summary.skippedTests}`),s.setAttribute("failures",`${t.summary.failedTests}`),s.setAttribute("time",`${Zn(t.requests.reduce(zc,0))}`);for(let n of t.requests)s.appendChild(Wc(r,n));return(0,Eu.formatXml)(r,{indentation:"  ",eol:Ou.EOL})}function Wc(t,e){var i,a,l,d;let r=t.createElement("testsuite");he(r,"name",e.name),he(r,"tests",((i=e.summary)==null?void 0:i.totalTests)||0),he(r,"errors",((a=e.summary)==null?void 0:a.erroredTests)||0),he(r,"failures",((l=e.summary)==null?void 0:l.failedTests)||0),he(r,"skipped",((d=e.summary)==null?void 0:d.skippedTests)||0);let o=e.fileName.replace(process.cwd(),"");o=o.startsWith("/")?o.slice(1):o,he(r,"package",o);let s=e.duration||0;he(r,"time",Zn(s));let n=Iu(t,{title:e.title,description:e.description,line:e.line,timestamp:e.timestamp,file:o});if(n&&r.appendChild(n),e.testResults){let u=s/(e.testResults.length===0?1:e.testResults.length);for(let c of e.testResults){let h=Qc(t,c,{classname:e.name,time:Zn(u)});r.appendChild(h)}}return r}function Qc(t,e,r){var s,n,i,a,l,d,u,c;let o=t.createElement("testcase");he(o,"name",e.message);for(let[h,R]of Object.entries(r))he(o,h,R);if(he(o,"assertions",1),e.error){let h=Iu(t,{displayMessage:(s=e.error)==null?void 0:s.displayMessage,file:(n=e.error)==null?void 0:n.file,line:(i=e.error)==null?void 0:i.line,offset:(a=e.error)==null?void 0:a.offset,errorType:(l=e.error)==null?void 0:l.errorType,message:(d=e.error)==null?void 0:d.message});h&&o.appendChild(h)}if(["ERROR","FAILED"].includes(e.status)){let h=t.createElement("failure");o.appendChild(h),he(h,"message",e.message),he(h,"type",((u=e.error)==null?void 0:u.errorType)??"unknown"),h.textContent=Ie((c=e.error)==null?void 0:c.error)||""}else e.status==="SKIPPED"&&o.appendChild(t.createElement("skipped"));return o}function Iu(t,e){let r=!1,o=t.createElement("properties");for(let[s,n]of Object.entries(e))if(n){r=!0;let i=t.createElement("property");i.setAttribute("name",s),i.setAttribute("value",b(n)||""),o.appendChild(i)}if(r)return o}function zc(t,e){return t+(e.duration||0)}function Zn(t){return(t/1e3).toFixed(3)}function he(t,e,r){(r||r===0)&&t.setAttribute(e,`${r}`)}async function Du(t,e){if(e.all)return t.map(o=>({httpFile:o}));let r=Jc(t,e);return r.length>0?r:await ef(t)}function Jc(t,e){let r=[];for(let o of t){let s=o.httpRegions.filter(n=>!!(Xc(n,e.name)||Zc(n,e.tag)||Yc(n,e.line)));s.length>0&&r.push({httpFile:o,httpRegions:s})}return r}function Xc(t,e){var r;return e?((r=t.metaData)==null?void 0:r.name)===e:!1}function Yc(t,e){return e!==void 0?e&&t.symbol.startLine<=e&&t.symbol.endLine>=e:!1}function Zc(t,e){var r,o;if(e&&m((r=t.metaData)==null?void 0:r.tag)){let s=(o=t.metaData.tag)==null?void 0:o.split(",").map(n=>n.trim());return e.some(n=>s.includes(n))}return!1}async function ef(t){var i;let e={},r=t.length>1,o=`${process.cwd()}`;for(let a of t){let l=(i=xe(a.fileName))==null?void 0:i.replace(o,".");e[r?`${l}: all`:"all"]=[{httpFile:a}];for(let d of a.httpRegions)if(!d.isGlobal()){let u=d.symbol.name;e[r?`${l}: ${u}`:u]=[{httpRegions:[d],httpFile:a}]}}let n=await(await import("inquirer")).default.prompt([{type:"list",name:"region",message:"please choose which region to use",choices:Object.entries(e).map(([a])=>a)}]);return n.region&&e[n.region]?e[n.region]:[]}function Vu(){return new _u.Command("send").description("send/ execute http files").usage("<fileName...> [options]").argument("<fileName...>","path to file or glob pattern").option("-a, --all","execute all http requests in a http file").option("--bail","stops when a test case fails").option("-e, --env  <env...>","list of environments").option("--filter <filter>"," filter requests output (only-failed)").option("--insecure","allow insecure server connections when using ssl").option("-i --interactive","do not exit the program after request, go back to selection").option("--json","use json output").option("--junit","use junit xml output").option("-l, --line <line>","line of the http requests").option("-n, --name <name>","name of the http requests").option("--no-color","disable color support").option("-o, --output <output>","output format of response (short, body, headers, response, exchange, none)").option("--output-failed <output>","output format of failed response (short, body, headers, response, exchange, none)").option("--raw","prevent formatting of response body").option("--quiet","").option("--repeat <count>","repeat count for requests",S).option("--repeat-mode <mode>","repeat mode: sequential, parallel (default)").option("--parallel <count>","send parallel requests",S).option("-s, --silent","log only request").option("-t, --tag  <tag...>","list of tags to execute").option("--timeout <timeout>","maximum time allowed for connections",S).option("--var  <variables...>",'list of variables (e.g foo="bar")').option("-v, --verbose","make the operation more talkative").action(tf)}async function tf(t,e){var n,i;let r=of(e),{httpFiles:o,config:s}=await nf(t,e,r.config||{});r.config=s,sf(e,r);try{if(o.length>0){let a=!0;for(;e.interactive||a;){a=!1;let l=await Du(o,e);r.processedHttpRegions=[];let d=l.map(({httpFile:u,httpRegions:c})=>async function(){!e.junit&&!e.json&&r.scriptConsole&&l.length>1&&r.scriptConsole.info(`--------------------- ${u.fileName}  --`),await Jn(Object.assign({},r,{httpFile:u,httpRegions:c}))});await ws(e.parallel||1,...d),rf(r,e)}}else console.error(`httpYac cannot find the specified file ${t.join(", ")}.`)}finally{(i=(n=r.scriptConsole)==null?void 0:n.flush)==null||i.call(n)}}function rf(t,e){let r=t.processedHttpRegions||[],o=Su(r,e);if(e.json)console.info(k(o,2));else if(e.junit)console.info($u(o));else if(t.scriptConsole){t.scriptConsole.info("");let s=[];o.summary.successRequests>0&&s.push(Et.default`{green ${o.summary.successRequests} succeeded}`),o.summary.failedRequests>0&&s.push(Et.default`{red ${o.summary.failedRequests} failed}`),o.summary.erroredRequests>0&&s.push(Et.default`{red ${o.summary.erroredRequests} errored}`),o.summary.skippedRequests>0&&s.push(Et.default`{yellow ${o.summary.skippedRequests} skipped}`),t.scriptConsole.info(Et.default`{bold ${o.summary.totalRequests}} requests processed (${s.join(", ")})`)}}function of(t){return{activeEnvironment:t.env,repeat:t.repeat?{count:t.repeat,type:t.repeatMode==="sequential"?0:1}:void 0,config:{log:{level:Xn(t)},request:{timeout:t.timeout,https:t.insecure?{rejectUnauthorized:!1}:void 0}},variables:t.var?Object.fromEntries(t.var.map(r=>{let o=r.split("=");return[o[0],o.slice(1).join("=")]})):void 0}}function sf(t,e){let r=new yt({level:Xn(t),onlyFailedTests:t.filter==="only-failed"});if(r.collectMessages(),e.scriptConsole=r,!t.json&&!t.junit){e.logStream=lf(t);let o=df(t,e.config,r);e.logResponse=async(s,n)=>{o&&await o(s,n),r.flush()}}}async function nf(t,e,r){let o=[],s=new at({cli:Au(!!e.bail)}),n={workingDir:process.cwd(),config:r},i=[];for(let a of t)i.push(...await af(a));for(let a of i){let l=await s.getOrCreate(a,async()=>await ju.promises.readFile(a,"utf8"),0,n);o.push(l)}return{httpFiles:o,config:n.config}}async function af(t){let e={gitignore:!0},{globby:r}=await import("globby"),o=await r(t,e);return o&&o.length>0||Fu.sep==="/"?o:await r(t.replace(/\\/gu,"/"),e)}function lf(t){if(t.output!=="none")return async function(r,o){let s=Buffer.isBuffer(o.body)?o.body.toString("utf-8"):o.body;console.info(`${new Date().toLocaleTimeString()} - ${r}: `,s)}}function df(t,e,r){var i,a;let o={onlyFailed:t.filter==="only-failed",responseBodyPrettyPrint:!t.raw},s=Mu(t.output,o,(i=e==null?void 0:e.log)==null?void 0:i.options),n=Mu(t.outputFailed,o,(a=e==null?void 0:e.log)==null?void 0:a.options);if(s||n)return Xo(l=>r.logPriority(l),s,n)}function Mu(t,...e){let r;switch(t){case"body":r={responseBodyLength:0};break;case"headers":r={requestOutput:!0,requestHeaders:!0,responseHeaders:!0};break;case"response":r={responseHeaders:!0,responseBodyLength:0};break;case"none":return;case"short":r={useShort:!0};break;case"timings":r={timings:!0};break;case"exchange":r={requestOutput:!0,requestHeaders:!0,requestBodyLength:0,responseHeaders:!0,responseBodyLength:0,timings:!0};break;default:r={requestOutput:!0,requestHeaders:!0,requestBodyLength:0,responseHeaders:!0,responseBodyLength:0};break}return Object.assign({},...e,r)}async function Uu(){let t=new Bu.Command,e=await Kt((0,Nu.join)(__dirname,"../package.json"));return t.version((e==null?void 0:e.version)||"0.0.1").description("httpYac - Quickly and easily send REST, SOAP, GraphQL and gRPC requests").addCommand(Cu()).addCommand(Vu(),{isDefault:!0}),t}async function uf(t){try{await Ss(),await(await Uu()).parseAsync(t)}catch(e){throw console.error(e),process.exitCode||(process.exitCode=1),e}finally{process.exit()}}0&&(module.exports={AbstractRequestClient,ExecuteHook,HookCancel,HttpSymbol,HttpSymbolKind,LogLevel,OnRequestHook,OnResponseHook,OnStreaming,ParseEndRegionHook,ParseHook,ParseMetaDataHook,ProtoDefinition,ProvideAssertValue,ProvideEnvironmentsHook,ProvideVariablesHook,RepeatOrder,ReplaceVariableHook,RequestClientEvent,ResponseLoggingHook,TestResultStatus,VariableType,cli,createEmptyProcessorContext,getEnvironments,getVariables,io,send,store,testSymbols,utils});
//# sourceMappingURL=index.js.map
